(function(){var n,t,l,v,r,h,o,y,f,a,i,b,k,d,u;window.$jit=function(n){n=n||window;for(var t in $jit)$jit[t].$extend&&(n[t]=$jit[t])};$jit.version="2.0.1";n=function(n){return document.getElementById(n)};n.empty=function(){};n.extend=function(n,t){for(var i in t||{})n[i]=t[i];return n};n.lambda=function(n){return typeof n=="function"?n:function(){return n}};n.time=Date.now||function(){return+new Date};n.splat=function(t){var i=n.type(t);return i?i!="array"?[t]:t:[]};n.type=function(t){var i=n.type.s.call(t).match(/^\[object\s(.*)\]$/)[1].toLowerCase();return i!="object"?i:t&&t.$$family?t.$$family:t&&t.nodeName&&t.nodeType==1?"element":i};n.type.s=Object.prototype.toString;n.each=function(t,i){var e=n.type(t),u,r,f;if(e=="object")for(u in t)i(t[u],u);else for(r=0,f=t.length;r<f;r++)i(t[r],r)};n.indexOf=function(n,t){if(Array.indexOf)return n.indexOf(t);for(var i=0,r=n.length;i<r;i++)if(n[i]===t)return i;return-1};n.map=function(t,i){var r=[];return n.each(t,function(n,t){r.push(i(n,t))}),r};n.reduce=function(n,t,i){var r=n.length,u;if(r==0)return i;for(u=arguments.length==3?i:n[--r];r--;)u=t(u,n[r]);return u};n.merge=function(){for(var t,i,r,u,f={},e=0,o=arguments.length;e<o;e++)if(t=arguments[e],n.type(t)=="object")for(i in t)r=t[i],u=f[i],f[i]=u&&n.type(r)=="object"&&n.type(u)=="object"?n.merge(u,r):n.unlink(r);return f};n.unlink=function(t){var i,u,r,f;switch(n.type(t)){case"object":i={};for(u in t)i[u]=n.unlink(t[u]);break;case"array":for(i=[],r=0,f=t.length;r<f;r++)i[r]=n.unlink(t[r]);break;default:return t}return i};n.zip=function(){var n,i;if(arguments.length===0)return[];for(var t=0,r=[],u=arguments.length,f=arguments[0].length;t<f;t++){for(n=0,i=[];n<u;n++)i.push(arguments[n][t]);r.push(i)}return r};n.rgbToHex=function(n,t){var i,r,u;if(n.length<3)return null;if(n.length==4&&n[3]==0&&!t)return"transparent";for(i=[],r=0;r<3;r++)u=(n[r]-0).toString(16),i.push(u.length==1?"0"+u:u);return t?i:"#"+i.join("")};n.hexToRgb=function(n){var r,i,t;if(n.length!=7){if(n=n.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/),n.shift(),n.length!=3)return null;for(r=[],i=0;i<3;i++)t=n[i],t.length==1&&(t+=t),r.push(parseInt(t,16));return r}return n=parseInt(n.slice(1),16),[n>>16,n>>8&255,n&255]};n.destroy=function(t){n.clean(t);t.parentNode&&t.parentNode.removeChild(t);t.clearAttributes&&t.clearAttributes()};n.clean=function(t){for(var r=t.childNodes,i=0,u=r.length;i<u;i++)n.destroy(r[i])};n.addEvent=function(n,t,i){n.addEventListener?n.addEventListener(t,i,!1):n.attachEvent("on"+t,i)};n.addEvents=function(t,i){for(var r in i)n.addEvent(t,r,i[r])};n.hasClass=function(n,t){return(" "+n.className+" ").indexOf(" "+t+" ")>-1};n.addClass=function(t,i){n.hasClass(t,i)||(t.className=t.className+" "+i)};n.removeClass=function(n,t){n.className=n.className.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)"),"$1")};n.getPos=function(n){function u(n){for(var t={x:0,y:0};n&&!r(n);)t.x+=n.offsetLeft,t.y+=n.offsetTop,n=n.offsetParent;return t}function f(n){for(var t={x:0,y:0};n&&!r(n);)t.x+=n.scrollLeft,t.y+=n.scrollTop,n=n.parentNode;return t}function r(n){return/^(?:body|html)$/i.test(n.tagName)}var t=u(n),i=f(n);return{x:t.x-i.x,y:t.y-i.y}};n.event={get:function(n,t){return t=t||window,n||t.event},getWheel:function(n){return n.wheelDelta?n.wheelDelta/120:-(n.detail||0)/3},isRightClick:function(n){return n.which==3||n.button==2},getPos:function(n,t){var i;return t=t||window,n=n||t.event,i=t.document,i=i.documentElement||i.body,n.touches&&n.touches.length&&(n=n.touches[0]),{x:n.pageX||n.clientX+i.scrollLeft,y:n.pageY||n.clientY+i.scrollTop}},stop:function(n){n.stopPropagation&&n.stopPropagation();n.cancelBubble=!0;n.preventDefault?n.preventDefault():n.returnValue=!1}};$jit.util=$jit.id=n;t=function(i){var r,u;i=i||{};r=function(){var i,u;for(i in this)typeof this[i]!="function"&&(this[i]=n.unlink(this[i]));return(this.constructor=r,t.prototyping)?this:(u=this.initialize?this.initialize.apply(this,arguments):this,this.$$family="class",u)};for(u in t.Mutators)i[u]&&(i=t.Mutators[u](i,i[u]),delete i[u]);return n.extend(r,this),r.constructor=t,r.prototype=i,r};t.Mutators={Implements:function(i,r){return n.each(n.splat(r),function(n){var u,r;t.prototyping=n;u=typeof n=="function"?new n:n;for(r in u)r in i||(i[r]=u[r]);delete t.prototyping}),i}};n.extend(t,{inherit:function(i,r){for(var f in r){var u=r[f],e=i[f],o=n.type(u);e&&o=="function"?u!=e&&t.override(i,f,u):i[f]=o=="object"?n.merge(e,u):u}return i},override:function(n,i,r){var u=t.prototyping,f;u&&n[i]!=u[i]&&(u=null);f=function(){var f=this.parent,t;return this.parent=u?u[i]:n[i],t=r.apply(this,arguments),this.parent=f,t};n[i]=f}});t.prototype.implement=function(){var i=this.prototype;return n.each(Array.prototype.slice.call(arguments||[]),function(n){t.inherit(i,n)}),this};$jit.Class=t;$jit.json={prune:function(n,t){this.each(n,function(n,i){i==t&&n.children&&(delete n.children,n.children=[])})},getParent:function(n,t){var i,r,u;if(n.id==t)return!1;if(i=n.children,i&&i.length>0)for(r=0;r<i.length;r++){if(i[r].id==t)return n;if(u=this.getParent(i[r],t),u)return u}return!1},getSubtree:function(n,t){var i,r,u;if(n.id==t)return n;for(i=0,r=n.children;r&&i<r.length;i++)if(u=this.getSubtree(r[i],t),u!=null)return u;return null},eachLevel:function(n,t,i,r){if(t<=i){if(r(n,t),!n.children)return;for(var u=0,f=n.children;u<f.length;u++)this.eachLevel(f[u],t+1,i,r)}},each:function(n,t){this.eachLevel(n,0,Number.MAX_VALUE,t)}};$jit.Trans={$extend:!0,linear:function(n){return n}};l=$jit.Trans,function(){var t=function(t,i){return i=n.splat(i),n.extend(t,{easeIn:function(n){return t(n,i)},easeOut:function(n){return 1-t(1-n,i)},easeInOut:function(n){return n<=.5?t(2*n,i)/2:(2-t(2*(1-n),i))/2}})},i={Pow:function(n,t){return Math.pow(n,t[0]||6)},Expo:function(n){return Math.pow(2,8*(n-1))},Circ:function(n){return 1-Math.sin(Math.acos(n))},Sine:function(n){return 1-Math.sin((1-n)*Math.PI/2)},Back:function(n,t){return t=t[0]||1.618,Math.pow(n,2)*((t+1)*n-t)},Bounce:function(n){for(var r,i=0,t=1;;i+=t,t/=2)if(n>=(7-4*i)/11){r=t*t-Math.pow((11-6*i-11*n)/4,2);break}return r},Elastic:function(n,t){return Math.pow(2,10*--n)*Math.cos(20*n*Math.PI*(t[0]||1)/3)}};n.each(i,function(n,i){l[i]=t(n)});n.each(["Quad","Cubic","Quart","Quint"],function(n,i){l[n]=t(function(n){return Math.pow(n,[i+2])})})}();v=new t({initialize:function(n){this.setOptions(n)},setOptions:function(t){var i={duration:2500,fps:40,transition:l.Quart.easeInOut,compute:n.empty,complete:n.empty,link:"ignore"};return this.opt=n.merge(i,t||{}),this},step:function(){var i=n.time(),t=this.opt,r;i<this.time+t.duration?(r=t.transition((i-this.time)/t.duration),t.compute(r)):(this.timer=clearInterval(this.timer),t.compute(1),t.complete())},start:function(){return this.check()?(this.time=0,this.startTimer(),this):this},startTimer:function(){var t=this,i=this.opt.fps;return this.timer?!1:(this.time=n.time()-this.time,this.timer=setInterval(function(){t.step()},Math.round(1e3/i)),!0)},pause:function(){return this.stopTimer(),this},resume:function(){return this.startTimer(),this},stopTimer:function(){return this.timer?(this.time=n.time()-this.time,this.timer=clearInterval(this.timer),!0):!1},check:function(){return this.timer?this.opt.link=="cancel"?(this.stopTimer(),!0):!1:!0}});r=function(){for(var i,u=arguments,t=0,e=u.length,f={};t<e;t++)i=r[u[t]],i.$extend?n.extend(f,i):f[u[t]]=i;return f};r.AreaChart={$extend:!0,animate:!0,labelOffset:3,type:"stacked",Tips:{enable:!1,onShow:n.empty,onHide:n.empty},Events:{enable:!1,onClick:n.empty},selectOnHover:!0,showAggregates:!0,showLabels:!0,filterOnClick:!1,restoreOnRightClick:!1};r.Margin={$extend:!1,top:0,left:0,right:0,bottom:0};r.Canvas={$extend:!0,injectInto:"id",type:"2D",width:!1,height:!1,useCanvas:!1,withLabels:!0,background:!1,Scene:{Lighting:{enable:!1,ambient:[1,1,1],directional:{direction:{x:-100,y:-100,z:-100},color:[.5,.3,.1]}}}};r.Tree={$extend:!0,orientation:"left",subtreeOffset:8,siblingOffset:5,indent:10,multitree:!1,align:"center"};r.Node={$extend:!1,overridable:!1,type:"circle",color:"#ccb",alpha:1,dim:3,height:20,width:90,autoHeight:!1,autoWidth:!1,lineWidth:1,transform:!0,align:"center",angularWidth:1,span:1,CanvasStyles:{}};r.Edge={$extend:!1,overridable:!1,type:"line",color:"#ccb",lineWidth:1,dim:15,alpha:1,epsilon:7,CanvasStyles:{}};r.Fx={$extend:!0,fps:40,duration:2500,transition:$jit.Trans.Quart.easeInOut,clearCanvas:!0};r.Label={$extend:!1,overridable:!1,type:"HTML",style:" ",size:10,family:"sans-serif",textAlign:"center",textBaseline:"alphabetic",color:"#fff"};r.Tips={$extend:!1,enable:!1,type:"auto",offsetX:20,offsetY:20,force:!1,onShow:n.empty,onHide:n.empty};r.NodeStyles={$extend:!1,enable:!1,type:"auto",stylesHover:!1,stylesClick:!1};r.Events={$extend:!1,enable:!1,enableForEdges:!1,type:"auto",onClick:n.empty,onRightClick:n.empty,onMouseMove:n.empty,onMouseEnter:n.empty,onMouseLeave:n.empty,onDragStart:n.empty,onDragMove:n.empty,onDragCancel:n.empty,onDragEnd:n.empty,onTouchStart:n.empty,onTouchMove:n.empty,onTouchEnd:n.empty,onMouseWheel:n.empty};r.Navigation={$extend:!1,enable:!1,type:"auto",panning:!1,zooming:!1};r.Controller={$extend:!0,onBeforeCompute:n.empty,onAfterCompute:n.empty,onCreateLabel:n.empty,onPlaceLabel:n.empty,onComplete:n.empty,onBeforePlotLine:n.empty,onAfterPlotLine:n.empty,onBeforePlotNode:n.empty,onAfterPlotNode:n.empty,request:!1};var p={initialize:function(n,t){this.viz=t;this.canvas=t.canvas;this.config=t.config[n];this.nodeTypes=t.fx.nodeTypes;var i=this.config.type;this.dom=i=="auto"?t.config.Label.type!="Native":i!="Native";this.labelContainer=this.dom&&t.labels.getLabelContainer();this.isEnabled()&&this.initializePost()},initializePost:n.empty,setAsProperty:n.lambda(!1),isEnabled:function(){return this.config.enable},isLabel:function(t,i,r){t=n.event.get(t,i);var f=this.labelContainer,u=t.target||t.srcElement,e=t.relatedTarget;return r?e&&e==this.viz.canvas.getCtx().canvas&&!!u&&this.isDescendantOf(u,f):this.isDescendantOf(u,f)},isDescendantOf:function(n,t){while(n&&n.parentNode){if(n.parentNode==t)return n;n=n.parentNode}return!1}},w={onMouseUp:n.empty,onMouseDown:n.empty,onMouseMove:n.empty,onMouseOver:n.empty,onMouseOut:n.empty,onMouseWheel:n.empty,onTouchStart:n.empty,onTouchMove:n.empty,onTouchEnd:n.empty,onTouchCancel:n.empty},nt=new t({initialize:function(n){this.viz=n;this.canvas=n.canvas;this.node=!1;this.edge=!1;this.registeredObjects=[];this.attachEvents()},attachEvents:function(){var i=this.canvas.getElement(),t=this,r;i.oncontextmenu=n.lambda(!1);n.addEvents(i,{mouseup:function(i,r){var u=n.event.get(i,r);t.handleEvent("MouseUp",i,r,t.makeEventObject(i,r),n.event.isRightClick(u))},mousedown:function(i,r){var u=n.event.get(i,r);t.handleEvent("MouseDown",i,r,t.makeEventObject(i,r),n.event.isRightClick(u))},mousemove:function(n,i){t.handleEvent("MouseMove",n,i,t.makeEventObject(n,i))},mouseover:function(n,i){t.handleEvent("MouseOver",n,i,t.makeEventObject(n,i))},mouseout:function(n,i){t.handleEvent("MouseOut",n,i,t.makeEventObject(n,i))},touchstart:function(n,i){t.handleEvent("TouchStart",n,i,t.makeEventObject(n,i))},touchmove:function(n,i){t.handleEvent("TouchMove",n,i,t.makeEventObject(n,i))},touchend:function(n,i){t.handleEvent("TouchEnd",n,i,t.makeEventObject(n,i))}});r=function(i,r){var u=n.event.get(i,r),f=n.event.getWheel(u);t.handleEvent("MouseWheel",i,r,f)};document.getBoxObjectFor||window.mozInnerScreenX!=null?i.addEventListener("DOMMouseScroll",r,!1):n.addEvent(i,"mousewheel",r)},register:function(n){this.registeredObjects.push(n)},handleEvent:function(){for(var i=Array.prototype.slice.call(arguments),r=i.shift(),n=0,t=this.registeredObjects,u=t.length;n<u;n++)t[n]["on"+r].apply(t[n],i)},makeEventObject:function(t,i){var r=this,u=this.viz.graph,f=this.viz.fx,e=f.nodeTypes,o=f.edgeTypes;return{pos:!1,node:!1,edge:!1,contains:!1,getNodeCalled:!1,getEdgeCalled:!1,getPos:function(){var u=r.viz.canvas,f=u.getSize(),e=u.getPos(),s=u.translateOffsetX,h=u.translateOffsetY,c=u.scaleOffsetX,l=u.scaleOffsetY,o=n.event.getPos(t,i);return this.pos={x:(o.x-e.x-f.width/2-s)*1/c,y:(o.y-e.y-f.height/2-h)*1/l},this.pos},getNode:function(){var i;if(this.getNodeCalled)return this.node;this.getNodeCalled=!0;for(i in u.nodes){var n=u.nodes[i],t=n&&e[n.getData("type")],o=t&&t.contains&&t.contains.call(f,n,this.getPos());if(o)return this.contains=o,r.node=this.node=n}return r.node=this.node=!1},getEdge:function(){var t,i,e,s;if(this.getEdgeCalled)return this.edge;this.getEdgeCalled=!0;t={};for(i in u.edges){e=u.edges[i];t[i]=!0;for(s in e)if(!(s in t)){var n=e[s],h=n&&o[n.getData("type")],c=h&&h.contains&&h.contains.call(f,n,this.getPos());if(c)return this.contains=c,r.edge=this.edge=n}}return r.edge=this.edge=!1},getContains:function(){return this.getNodeCalled?this.contains:(this.getNode(),this.contains)}}}}),s={initializeExtras:function(){var i=new nt(this),t=this;n.each(["NodeStyles","Tips","Navigation","Events"],function(n){var r=new s.Classes[n](n,t);r.isEnabled()&&i.register(r);r.setAsProperty()&&(t[n.toLowerCase()]=r)})}};s.Classes={};s.Classes.Events=new t({Implements:[p,w],initializePost:function(){this.fx=this.viz.fx;this.ntypes=this.viz.fx.nodeTypes;this.etypes=this.viz.fx.edgeTypes;this.hovered=!1;this.pressed=!1;this.touched=!1;this.touchMoved=!1;this.moved=!1},setAsProperty:n.lambda(!0),onMouseUp:function(t,i,r,u){var f=n.event.get(t,i);if(!this.moved)if(u)this.config.onRightClick(this.hovered,r,f);else this.config.onClick(this.pressed,r,f);if(this.pressed){if(this.moved)this.config.onDragEnd(this.pressed,r,f);else this.config.onDragCancel(this.pressed,r,f);this.pressed=this.moved=!1}},onMouseOut:function(t,i,r){var f=n.event.get(t,i),e,u,o;if(this.dom&&(e=this.isLabel(t,i,!0))){this.config.onMouseLeave(this.viz.graph.getNode(e.id),r,f);this.hovered=!1;return}for(u=f.relatedTarget,o=this.canvas.getElement();u&&u.parentNode;){if(o==u.parentNode)return;u=u.parentNode}if(this.hovered){this.config.onMouseLeave(this.hovered,r,f);this.hovered=!1}},onMouseOver:function(t,i,r){var f=n.event.get(t,i),u;if(this.dom&&(u=this.isLabel(t,i,!0))){this.hovered=this.viz.graph.getNode(u.id);this.config.onMouseEnter(this.hovered,r,f)}},onMouseMove:function(t,i,r){var u=n.event.get(t,i);if(this.pressed){this.moved=!0;this.config.onDragMove(this.pressed,r,u);return}if(this.dom)this.config.onMouseMove(this.hovered,r,u);else{if(this.hovered){var f=this.hovered,e=f.nodeFrom?this.etypes[f.getData("type")]:this.ntypes[f.getData("type")],o=e&&e.contains&&e.contains.call(this.fx,f,r.getPos());if(o){this.config.onMouseMove(f,r,u);return}this.config.onMouseLeave(f,r,u);this.hovered=!1}if(this.hovered=r.getNode()||this.config.enableForEdges&&r.getEdge())this.config.onMouseEnter(this.hovered,r,u);else this.config.onMouseMove(!1,r,u)}},onMouseWheel:function(t,i,r){this.config.onMouseWheel(r,n.event.get(t,i))},onMouseDown:function(t,i,r){var f=n.event.get(t,i),u;this.dom?(u=this.isLabel(t,i))&&(this.pressed=this.viz.graph.getNode(u.id)):this.pressed=r.getNode()||this.config.enableForEdges&&r.getEdge();this.pressed&&this.config.onDragStart(this.pressed,r,f)},onTouchStart:function(t,i,r){var f=n.event.get(t,i),u;this.touched=this.dom&&(u=this.isLabel(t,i))?this.viz.graph.getNode(u.id):r.getNode()||this.config.enableForEdges&&r.getEdge();this.touched&&this.config.onTouchStart(this.touched,r,f)},onTouchMove:function(t,i,r){var u=n.event.get(t,i);if(this.touched){this.touchMoved=!0;this.config.onTouchMove(this.touched,r,u)}},onTouchEnd:function(t,i,r){var u=n.event.get(t,i);if(this.touched){if(this.touchMoved)this.config.onTouchEnd(this.touched,r,u);else this.config.onTouchCancel(this.touched,r,u);this.touched=this.touchMoved=!1}}});s.Classes.Tips=new t({Implements:[p,w],initializePost:function(){if(document.body){var t=n("_tooltip")||document.createElement("div");t.id="_tooltip";t.className="tip";n.extend(t.style,{position:"absolute",display:"none",zIndex:13e3});document.body.appendChild(t);this.tip=t;this.node=!1}},setAsProperty:n.lambda(!0),onMouseOut:function(t,i){var f=n.event.get(t,i),r,u;if(this.dom&&this.isLabel(t,i,!0)){this.hide(!0);return}for(r=t.relatedTarget,u=this.canvas.getElement();r&&r.parentNode;){if(u==r.parentNode)return;r=r.parentNode}this.hide(!1)},onMouseOver:function(n,t){var i;if(this.dom&&(i=this.isLabel(n,t,!1))){this.node=this.viz.graph.getNode(i.id);this.config.onShow(this.tip,this.node,i)}},onMouseMove:function(t,i,r){if(this.dom&&this.isLabel(t,i)&&this.setTooltipPosition(n.event.getPos(t,i)),!this.dom){var u=r.getNode();if(!u){this.hide(!0);return}if(this.config.force||!this.node||this.node.id!=u.id){this.node=u;this.config.onShow(this.tip,u,r.getContains())}this.setTooltipPosition(n.event.getPos(t,i))}},setTooltipPosition:function(n){var i=this.tip,r=i.style,e=this.config;r.display="";var o={height:document.body.clientHeight,width:document.body.clientWidth},t={width:i.offsetWidth,height:i.offsetHeight},u=e.offsetX,f=e.offsetY;r.top=(n.y+f+t.height>o.height?n.y-t.height-f:n.y+f)+"px";r.left=(n.x+t.width+u>o.width?n.x-t.width-u:n.x+u)+"px"},hide:function(n){this.tip.style.display="none";n&&this.config.onHide()}});s.Classes.NodeStyles=new t({Implements:[p,w],initializePost:function(){this.fx=this.viz.fx;this.types=this.viz.fx.nodeTypes;this.nStyles=this.config;this.nodeStylesOnHover=this.nStyles.stylesHover;this.nodeStylesOnClick=this.nStyles.stylesClick;this.hoveredNode=!1;this.fx.nodeFxAnimation=new v;this.down=!1;this.move=!1},onMouseOut:function(n,t){if(this.down=this.move=!1,this.hoveredNode){this.dom&&this.isLabel(n,t,!0)&&this.toggleStylesOnHover(this.hoveredNode,!1);for(var i=n.relatedTarget,r=this.canvas.getElement();i&&i.parentNode;){if(r==i.parentNode)return;i=i.parentNode}this.toggleStylesOnHover(this.hoveredNode,!1);this.hoveredNode=!1}},onMouseOver:function(n,t){var r,i;if(this.dom&&(r=this.isLabel(n,t,!0))){if(i=this.viz.graph.getNode(r.id),i.selected)return;this.hoveredNode=i;this.toggleStylesOnHover(this.hoveredNode,!0)}},onMouseDown:function(n,t,i,r){if(!r){var u;this.dom&&(u=this.isLabel(n,t))?this.down=this.viz.graph.getNode(u.id):this.dom||(this.down=i.getNode());this.move=!1}},onMouseUp:function(n,t,i,r){if(!r){if(!this.move)this.onClick(i.getNode());this.down=this.move=!1}},getRestoredStyles:function(n,t){var i={},u=this["nodeStylesOn"+t];for(var r in u)i[r]=n.styles["$"+r];return i},toggleStylesOnHover:function(n,t){this.nodeStylesOnHover&&this.toggleStylesOn("Hover",n,t)},toggleStylesOnClick:function(n,t){this.nodeStylesOnClick&&this.toggleStylesOn("Click",n,t)},toggleStylesOn:function(t,i,r){var e=this.viz,h=this.nStyles,o,u,f,s;if(r){o=this;i.styles||(i.styles=n.merge(i.data,{}));for(u in this["nodeStylesOn"+t])f="$"+u,f in i.styles||(i.styles[f]=i.getData(u));e.fx.nodeFx(n.extend({elements:{id:i.id,properties:o["nodeStylesOn"+t]},transition:l.Quart.easeOut,duration:300,fps:40},this.config))}else s=this.getRestoredStyles(i,t),e.fx.nodeFx(n.extend({elements:{id:i.id,properties:s},transition:l.Quart.easeOut,duration:300,fps:40},this.config))},onClick:function(n){if(n){var t=this.nodeStylesOnClick;t&&(n.selected?(this.toggleStylesOnClick(n,!1),delete n.selected):(this.viz.graph.eachNode(function(n){if(n.selected){for(var i in t)n.setData(i,n.styles["$"+i],"end");delete n.selected}}),this.toggleStylesOnClick(n,!0),n.selected=!0,delete n.hovered,this.hoveredNode=!1))}},onMouseMove:function(n,t,i){var f,u,e,r;if((this.down&&(this.move=!0),!this.dom||!this.isLabel(n,t))&&(f=this.nodeStylesOnHover,f)&&!this.dom){if(this.hoveredNode&&(u=this.types[this.hoveredNode.getData("type")],e=u&&u.contains&&u.contains.call(this.fx,this.hoveredNode,i.getPos()),e))return;if(r=i.getNode(),!this.hoveredNode&&!r)return;if(r.hovered)return;r&&!r.selected?(this.fx.nodeFxAnimation.stopTimer(),this.viz.graph.eachNode(function(n){if(n.hovered&&!n.selected){for(var t in f)n.setData(t,n.styles["$"+t],"end");delete n.hovered}}),r.hovered=!0,this.hoveredNode=r,this.toggleStylesOnHover(r,!0)):this.hoveredNode&&!this.hoveredNode.selected&&(this.fx.nodeFxAnimation.stopTimer(),this.toggleStylesOnHover(this.hoveredNode,!1),delete this.hoveredNode.hovered,this.hoveredNode=!1)}}});s.Classes.Navigation=new t({Implements:[p,w],initializePost:function(){this.pos=!1;this.pressed=!1},onMouseWheel:function(t,i,r){if(this.config.zooming){n.event.stop(n.event.get(t,i));var f=this.config.zooming/1e3,u=1+r*f;this.canvas.scale(u,u)}},onMouseDown:function(n,t,i){if(this.config.panning&&(this.config.panning!="avoid nodes"||!(this.dom?this.isLabel(n,t):i.getNode()))){this.pressed=!0;this.pos=i.getPos();var r=this.canvas,u=r.translateOffsetX,f=r.translateOffsetY,e=r.scaleOffsetX,o=r.scaleOffsetY;this.pos.x*=e;this.pos.x+=u;this.pos.y*=o;this.pos.y+=f}},onMouseMove:function(n,t,i){var s,h;if(this.config.panning&&this.pressed&&(this.config.panning!="avoid nodes"||!(this.dom?this.isLabel(n,t):i.getNode()))){var f=this.pos,r=i.getPos(),u=this.canvas,c=u.translateOffsetX,l=u.translateOffsetY,e=u.scaleOffsetX,o=u.scaleOffsetY;r.x*=e;r.y*=o;r.x+=c;r.y+=l;s=r.x-f.x;h=r.y-f.y;this.pos=r;this.canvas.translate(s*1/e,h*1/o)}},onMouseUp:function(){this.config.panning&&(this.pressed=!1)}}),function(){function i(t,i){var r=document.createElement(t);for(var f in i)typeof i[f]=="object"?n.extend(r[f],i[f]):r[f]=i[f];return t=="canvas"&&!u&&G_vmlCanvasManager&&(r=G_vmlCanvasManager.initElement(document.body.appendChild(r))),r}var r=typeof HTMLCanvasElement,u=r=="object"||r=="function";$jit.Canvas=h=new t({canvases:[],pos:!1,element:!1,labelContainer:!1,translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(t,r){var e,o,y,f,c,p;this.viz=t;this.opt=this.config=r;var u=n.type(r.injectInto)=="string"?r.injectInto:r.injectInto.id,l=r.type,w=u+"-label",s=n(u),a=r.width||s.offsetWidth,v=r.height||s.offsetHeight;for(this.id=u,e={injectInto:u,width:a,height:v},this.element=i("div",{id:u+"-canvaswidget",style:{position:"relative",width:a+"px",height:v+"px"}}),this.labelContainer=this.createLabelContainer(r.Label.type,w,e),this.canvases.push(new h.Base[l]({config:n.extend({idSuffix:"-canvas"},e),plot:function(){t.fx.plot()},resize:function(){t.refresh()}})),o=r.background,o&&(y=new h.Background[o.type](t,n.extend(o,e)),this.canvases.push(new h.Base[l](y))),f=this.canvases.length;f--;)this.element.appendChild(this.canvases[f].canvas),f>0&&this.canvases[f].plot();this.element.appendChild(this.labelContainer);s.appendChild(this.element);c=null;p=this;n.addEvent(window,"scroll",function(){clearTimeout(c);c=setTimeout(function(){p.getPos(!0)},500)})},getCtx:function(n){return this.canvases[n||0].getCtx()},getConfig:function(){return this.opt},getElement:function(){return this.element},getSize:function(n){return this.canvases[n||0].getSize()},resize:function(n,t){var i,u,r;for(this.getPos(!0),this.translateOffsetX=this.translateOffsetY=0,this.scaleOffsetX=this.scaleOffsetY=1,i=0,u=this.canvases.length;i<u;i++)this.canvases[i].resize(n,t);r=this.element.style;r.width=n+"px";r.height=t+"px";this.labelContainer&&(this.labelContainer.style.width=n+"px")},translate:function(n,t,i){this.translateOffsetX+=n*this.scaleOffsetX;this.translateOffsetY+=t*this.scaleOffsetY;for(var r=0,u=this.canvases.length;r<u;r++)this.canvases[r].translate(n,t,i)},scale:function(n,t){var r=this.scaleOffsetX*n,u=this.scaleOffsetY*t,e=this.translateOffsetX*(n-1)/r,o=this.translateOffsetY*(t-1)/u,i,f;for(this.scaleOffsetX=r,this.scaleOffsetY=u,i=0,f=this.canvases.length;i<f;i++)this.canvases[i].scale(n,t,!0);this.translate(e,o,!1)},getPos:function(t){return t||!this.pos?this.pos=n.getPos(this.getElement()):this.pos},clear:function(n){this.canvases[n||0].clear()},path:function(n,t){var i=this.canvases[0].getCtx();i.beginPath();t(i);i[n]();i.closePath()},createLabelContainer:function(n,t,r){var o="http://www.w3.org/2000/svg",f,e,u;return n=="HTML"||n=="Native"?i("div",{id:t,style:{overflow:"visible",position:"absolute",top:0,left:0,width:r.width+"px",height:0}}):n=="SVG"?(f=document.createElementNS(o,"svg:svg"),f.setAttribute("width",r.width),f.setAttribute("height",r.height),e=f.style,e.position="absolute",e.left=e.top="0px",u=document.createElementNS(o,"svg:g"),u.setAttribute("width",r.width),u.setAttribute("height",r.height),u.setAttribute("x",0),u.setAttribute("y",0),u.setAttribute("id",t),f.appendChild(u),f):void 0}});h.Base={};h.Base["2D"]=new t({translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(n){this.viz=n;this.opt=n.config;this.size=!1;this.createCanvas();this.translateToCenter()},createCanvas:function(){var n=this.opt,t=n.width,r=n.height;this.canvas=i("canvas",{id:n.injectInto+n.idSuffix,width:t,height:r,style:{position:"absolute",top:0,left:0,width:t+"px",height:r+"px"}})},getCtx:function(){return this.ctx?this.ctx:this.ctx=this.canvas.getContext("2d")},getSize:function(){if(this.size)return this.size;var n=this.canvas;return this.size={width:n.width,height:n.height}},translateToCenter:function(n){var t=this.getSize(),r=n?t.width-n.width-this.translateOffsetX*2:t.width,i;height=n?t.height-n.height-this.translateOffsetY*2:t.height;i=this.getCtx();n&&i.scale(1/this.scaleOffsetX,1/this.scaleOffsetY);i.translate(r/2,height/2)},resize:function(n,t){var f=this.getSize(),i=this.canvas,r=i.style;this.size=!1;i.width=n;i.height=t;r.width=n+"px";r.height=t+"px";u?this.translateToCenter():this.translateToCenter(f);this.translateOffsetX=this.translateOffsetY=0;this.scaleOffsetX=this.scaleOffsetY=1;this.clear();this.viz.resize(n,t,this)},translate:function(n,t,i){var r=this.scaleOffsetX,u=this.scaleOffsetY;this.translateOffsetX+=n*r;this.translateOffsetY+=t*u;this.getCtx().translate(n,t);i||this.plot()},scale:function(n,t,i){this.scaleOffsetX*=n;this.scaleOffsetY*=t;this.getCtx().scale(n,t);i||this.plot()},clear:function(){var n=this.getSize(),r=this.translateOffsetX,u=this.translateOffsetY,t=this.scaleOffsetX,i=this.scaleOffsetY;this.getCtx().clearRect((-n.width/2-r)*1/t,(-n.height/2-u)*1/i,n.width*1/t,n.height*1/i)},plot:function(){this.clear();this.viz.plot(this)}});h.Background={};h.Background.Circles=new t({initialize:function(t,i){this.viz=t;this.config=n.merge({idSuffix:"-bkcanvas",levelDistance:100,numberOfCircles:6,CanvasStyles:{},offset:0},i)},resize:function(n,t,i){this.plot(i)},plot:function(n){var s=n.canvas,t=n.getCtx(),r=this.config,f=r.CanvasStyles,u,e,o,i;for(u in f)t[u]=f[u];for(e=r.numberOfCircles,o=r.levelDistance,i=1;i<=e;i++)t.beginPath(),t.arc(0,0,o*i,0,2*Math.PI,!1),t.stroke(),t.closePath()}})}();o=function(n,t){this.theta=n||0;this.rho=t||0};$jit.Polar=o;o.prototype={getc:function(n){return this.toComplex(n)},getp:function(){return this},set:function(n){n=n.getp();this.theta=n.theta;this.rho=n.rho},setc:function(n,t){this.rho=Math.sqrt(n*n+t*t);this.theta=Math.atan2(t,n);this.theta<0&&(this.theta+=Math.PI*2)},setp:function(n,t){this.theta=n;this.rho=t},clone:function(){return new o(this.theta,this.rho)},toComplex:function(n){var t=Math.cos(this.theta)*this.rho,i=Math.sin(this.theta)*this.rho;return n?{x:t,y:i}:new f(t,i)},add:function(n){return new o(this.theta+n.theta,this.rho+n.rho)},scale:function(n){return new o(this.theta,this.rho*n)},equals:function(n){return this.theta==n.theta&&this.rho==n.rho},$add:function(n){return this.theta=this.theta+n.theta,this.rho+=n.rho,this},$madd:function(n){return this.theta=(this.theta+n.theta)%(Math.PI*2),this.rho+=n.rho,this},$scale:function(n){return this.rho*=n,this},isZero:function(){var n=.0001,t=Math.abs;return t(this.theta)<n&&t(this.rho)<n},interpolate:function(n,t){var e=Math.PI,r=e*2,f=function(n){return n<0?n%r+r:n%r},u=this.theta,i=n.theta,o,s=Math.abs(u-i),h;return o=s==e?u>i?f(i+(u-r-i)*t):f(i-r+(u-i)*t):s>=e?u>i?f(i+(u-r-i)*t):f(i-r+(u-(i-r))*t):f(i+(u-i)*t),h=(this.rho-n.rho)*t+n.rho,{theta:o,rho:h}}};y=function(n,t){return new o(n,t)};o.KER=y(0,0);f=function(n,t){this.x=n||0;this.y=t||0};$jit.Complex=f;f.prototype={getc:function(){return this},getp:function(n){return this.toPolar(n)},set:function(n){n=n.getc(!0);this.x=n.x;this.y=n.y},setc:function(n,t){this.x=n;this.y=t},setp:function(n,t){this.x=Math.cos(n)*t;this.y=Math.sin(n)*t},clone:function(){return new f(this.x,this.y)},toPolar:function(n){var i=this.norm(),t=Math.atan2(this.y,this.x);return(t<0&&(t+=Math.PI*2),n)?{theta:t,rho:i}:new o(t,i)},norm:function(){return Math.sqrt(this.squaredNorm())},squaredNorm:function(){return this.x*this.x+this.y*this.y},add:function(n){return new f(this.x+n.x,this.y+n.y)},prod:function(n){return new f(this.x*n.x-this.y*n.y,this.y*n.x+this.x*n.y)},conjugate:function(){return new f(this.x,-this.y)},scale:function(n){return new f(this.x*n,this.y*n)},equals:function(n){return this.x==n.x&&this.y==n.y},$add:function(n){return this.x+=n.x,this.y+=n.y,this},$prod:function(n){var t=this.x,i=this.y;return this.x=t*n.x-i*n.y,this.y=i*n.x+t*n.y,this},$conjugate:function(){return this.y=-this.y,this},$scale:function(n){return this.x*=n,this.y*=n,this},$div:function(n){var t=this.x,i=this.y,r=n.squaredNorm();return this.x=t*n.x+i*n.y,this.y=i*n.x-t*n.y,this.$scale(1/r)},isZero:function(){var n=.0001,t=Math.abs;return t(this.x)<n&&t(this.y)<n}};a=function(n,t){return new f(n,t)};f.KER=a(0,0);$jit.Graph=new t({initialize:function(t,i,r,u){var s={klass:f,Node:{}},e,o;this.Node=i;this.Edge=r;this.Label=u;this.opt=n.merge(s,t||{});this.nodes={};this.edges={};e=this;this.nodeList={};for(o in b)e.nodeList[o]=function(n){return function(){var t=Array.prototype.slice.call(arguments);e.eachNode(function(i){i[n].apply(i,t)})}}(o)},getNode:function(n){return this.hasNode(n)?this.nodes[n]:!1},get:function(n){return this.getNode(n)},getByName:function(n){var i,t;for(i in this.nodes)if(t=this.nodes[i],t.name==n)return t;return!1},getAdjacence:function(n,t){return n in this.edges?this.edges[n][t]:!1},addNode:function(t){if(!this.nodes[t.id]){var r=this.edges[t.id]={};this.nodes[t.id]=new i.Node(n.extend({id:t.id,name:t.name,data:n.merge(t.data||{},{}),adjacencies:r},this.opt.Node),this.opt.klass,this.Node,this.Edge,this.Label)}return this.nodes[t.id]},addAdjacence:function(n,t,r){if(this.hasNode(n.id)||this.addNode(n),this.hasNode(t.id)||this.addNode(t),n=this.nodes[n.id],t=this.nodes[t.id],!n.adjacentTo(t)){var u=this.edges[n.id]=this.edges[n.id]||{},f=this.edges[t.id]=this.edges[t.id]||{};return u[t.id]=f[n.id]=new i.Adjacence(n,t,r,this.Edge,this.Label),u[t.id]}return this.edges[n.id][t.id]},removeNode:function(n){var t,i;if(this.hasNode(n)){delete this.nodes[n];t=this.edges[n];for(i in t)delete this.edges[i][n];delete this.edges[n]}},removeAdjacence:function(n,t){delete this.edges[n][t];delete this.edges[t][n]},hasNode:function(n){return n in this.nodes},empty:function(){this.nodes={};this.edges={}}});i=$jit.Graph,function(){var t=function(n,t,i,r,u){var f,e;return(i=i||"current",n="$"+(n?n+"-":""),i=="current"?f=this.data:i=="start"?f=this.startData:i=="end"&&(f=this.endData),e=n+t,r)?f[e]:this.Config.overridable?e in f?f[e]:e in this.data?this.data[e]:u[t]||0:u[t]||0},i=function(n,t,i,r){r=r||"current";n="$"+(n?n+"-":"");var u;r=="current"?u=this.data:r=="start"?u=this.startData:r=="end"&&(u=this.endData);u[n+t]=i},r=function(t,i){t="$"+(t?t+"-":"");var r=this;n.each(i,function(n){var i=t+n;delete r.data[i];delete r.endData[i];delete r.startData[i]})};b={getData:function(n,i,r){return t.call(this,"",n,i,r,this.Config)},setData:function(n,t,r){i.call(this,"",n,t,r)},setDataset:function(t,i){var u;t=n.splat(t);for(u in i)for(var r=0,f=n.splat(i[u]),e=t.length;r<e;r++)this.setData(u,f[r],t[r])},removeData:function(){r.call(this,"",Array.prototype.slice.call(arguments))},getCanvasStyle:function(n,i,r){return t.call(this,"canvas",n,i,r,this.Config.CanvasStyles)},setCanvasStyle:function(n,t,r){i.call(this,"canvas",n,t,r)},setCanvasStyles:function(t,i){var u;t=n.splat(t);for(u in i)for(var r=0,f=n.splat(i[u]),e=t.length;r<e;r++)this.setCanvasStyle(u,f[r],t[r])},removeCanvasStyle:function(){r.call(this,"canvas",Array.prototype.slice.call(arguments))},getLabelData:function(n,i,r){return t.call(this,"label",n,i,r,this.Label)},setLabelData:function(n,t,r){i.call(this,"label",n,t,r)},setLabelDataset:function(t,i){var u;t=n.splat(t);for(u in i)for(var r=0,f=n.splat(i[u]),e=t.length;r<e;r++)this.setLabelData(u,f[r],t[r])},removeLabelData:function(){r.call(this,"label",Array.prototype.slice.call(arguments))}}}();i.Node=new t({initialize:function(t,i,r,u,f){var e={id:"",name:"",data:{},startData:{},endData:{},adjacencies:{},selected:!1,drawn:!1,exist:!1,angleSpan:{begin:0,end:0},pos:new i,startPos:new i,endPos:new i};n.extend(this,n.extend(e,t));this.Config=this.Node=r;this.Edge=u;this.Label=f},adjacentTo:function(n){return n.id in this.adjacencies},getAdjacency:function(n){return this.adjacencies[n]},getPos:function(n){return(n=n||"current",n=="current")?this.pos:n=="end"?this.endPos:n=="start"?this.startPos:void 0},setPos:function(n,t){t=t||"current";var i;t=="current"?i=this.pos:t=="end"?i=this.endPos:t=="start"&&(i=this.startPos);i.set(n)}});i.Node.implement(b);i.Adjacence=new t({initialize:function(n,t,i,r,u){this.nodeFrom=n;this.nodeTo=t;this.data=i||{};this.startData={};this.endData={};this.Config=this.Edge=r;this.Label=u}});i.Adjacence.implement(b);i.Util={filter:function(t){if(!t||!(n.type(t)=="string"))return function(){return!0};var i=t.split(" ");return function(n){for(var t=0;t<i.length;t++)if(n[i[t]])return!1;return!0}},getNode:function(n,t){return n.nodes[t]},eachNode:function(n,t,i){var u=this.filter(i);for(var r in n.nodes)u(n.nodes[r])&&t(n.nodes[r])},each:function(n,t,i){this.eachNode(n,t,i)},eachAdjacency:function(n,t,i){var f=n.adjacencies,o=this.filter(i),u,r,e;for(u in f)r=f[u],o(r)&&(r.nodeFrom!=n&&(e=r.nodeFrom,r.nodeFrom=r.nodeTo,r.nodeTo=e),t(r,u))},computeLevels:function(n,t,i,r){var o,e,u,f;for(i=i||0,o=this.filter(r),this.eachNode(n,function(n){n._flag=!1;n._depth=-1},r),e=n.getNode(t),e._depth=i,u=[e];u.length!=0;)f=u.pop(),f._flag=!0,this.eachAdjacency(f,function(n){var t=n.nodeTo;t._flag==!1&&o(t)&&(t._depth<0&&(t._depth=f._depth+1+i),u.unshift(t))},r)},eachBFS:function(n,t,i,r){var e=this.filter(r),f,u;for(this.clean(n),f=[n.getNode(t)];f.length!=0;)u=f.pop(),u._flag=!0,i(u,u._depth),this.eachAdjacency(u,function(n){var t=n.nodeTo;t._flag==!1&&e(t)&&(t._flag=!0,f.unshift(t))},r)},eachLevel:function(n,t,i,r,u){var f=n._depth,e=this.filter(u),o=this;i=i===!1?Number.MAX_VALUE-f:i,function s(n,t,i){var u=n._depth;u>=t&&u<=i&&e(n)&&r(n,u);u<i&&o.eachAdjacency(n,function(n){var r=n.nodeTo;r._depth>u&&s(r,t,i)})}(n,t+f,i+f)},eachSubgraph:function(n,t,i){this.eachLevel(n,0,!1,t,i)},eachSubnode:function(n,t,i){this.eachLevel(n,1,1,t,i)},anySubnode:function(t,i,r){var u=!1,f;return i=i||n.lambda(!0),f=n.type(i)=="string"?function(n){return n[i]}:i,this.eachSubnode(t,function(n){f(n)&&(u=!0)},r),u},getSubnodes:function(t,i,r){var e=[],o=this,u,f;return i=i||0,n.type(i)=="array"?(u=i[0],f=i[1]):(u=i,f=Number.MAX_VALUE-t._depth),this.eachLevel(t,u,f,function(n){e.push(n)},r),e},getParents:function(n){var t=[];return this.eachAdjacency(n,function(i){var r=i.nodeTo;r._depth<n._depth&&t.push(r)}),t},isDescendantOf:function(n,t){var u,i,r;if(n.id==t)return!0;for(u=this.getParents(n),i=!1,r=0;!i&&r<u.length;r++)i=i||this.isDescendantOf(u[r],t);return i},clean:function(n){this.eachNode(n,function(n){n._flag=!1})},getClosestNodeToOrigin:function(n,t,i){return this.getClosestNodeToPos(n,o.KER,t,i)},getClosestNodeToPos:function(n,t,i,r){var u=null,e;return i=i||"current",t=t&&t.getc(!0)||f.KER,e=function(n,t){var i=n.x-t.x,r=n.y-t.y;return i*i+r*r},this.eachNode(n,function(n){u=u==null||e(n.getPos(i).getc(!0),t)<e(u.getPos(i).getc(!0),t)?n:u},r),u}};n.each(["get","getNode","each","eachNode","computeLevels","eachBFS","clean","getClosestNodeToPos","getClosestNodeToOrigin"],function(n){i.prototype[n]=function(){return i.Util[n].apply(i.Util,[this].concat(Array.prototype.slice.call(arguments)))}});n.each(["eachAdjacency","eachLevel","eachSubgraph","eachSubnode","anySubnode","getSubnodes","getParents","isDescendantOf"],function(n){i.Node.prototype[n]=function(){return i.Util[n].apply(i.Util,[this].concat(Array.prototype.slice.call(arguments)))}});i.Op={options:{type:"nothing",duration:2e3,hideLabels:!0,fps:30},initialize:function(n){this.viz=n},removeNode:function(t,i){var r=this.viz,e=n.merge(this.options,r.controller,i),u=n.splat(t),f,o,s;switch(e.type){case"nothing":for(f=0;f<u.length;f++)r.graph.removeNode(u[f]);break;case"replot":this.removeNode(u,{type:"nothing"});r.labels.clearLabels();r.refresh(!0);break;case"fade:seq":case"fade":for(o=this,f=0;f<u.length;f++)s=r.graph.getNode(u[f]),s.setData("alpha",0,"end");r.fx.animate(n.merge(e,{modes:["node-property:alpha"],onComplete:function(){o.removeNode(u,{type:"nothing"});r.labels.clearLabels();r.reposition();r.fx.animate(n.merge(e,{modes:["linear"]}))}}));break;case"fade:con":for(o=this,f=0;f<u.length;f++)s=r.graph.getNode(u[f]),s.setData("alpha",0,"end"),s.ignore=!0;r.reposition();r.fx.animate(n.merge(e,{modes:["node-property:alpha","linear"],onComplete:function(){o.removeNode(u,{type:"nothing"});e.onComplete&&e.onComplete()}}));break;case"iter":o=this;r.fx.sequence({condition:function(){return u.length!=0},step:function(){o.removeNode(u.shift(),{type:"nothing"});r.labels.clearLabels()},onComplete:function(){e.onComplete&&e.onComplete()},duration:Math.ceil(e.duration/u.length)});break;default:this.doError()}},removeEdge:function(t,i){var f=this.viz,e=n.merge(this.options,f.controller,i),r=n.type(t[0])=="string"?[t]:t,u,s,o;switch(e.type){case"nothing":for(u=0;u<r.length;u++)f.graph.removeAdjacence(r[u][0],r[u][1]);break;case"replot":this.removeEdge(r,{type:"nothing"});f.refresh(!0);break;case"fade:seq":case"fade":for(s=this,u=0;u<r.length;u++)o=f.graph.getAdjacence(r[u][0],r[u][1]),o&&o.setData("alpha",0,"end");f.fx.animate(n.merge(e,{modes:["edge-property:alpha"],onComplete:function(){s.removeEdge(r,{type:"nothing"});f.reposition();f.fx.animate(n.merge(e,{modes:["linear"]}))}}));break;case"fade:con":for(s=this,u=0;u<r.length;u++)o=f.graph.getAdjacence(r[u][0],r[u][1]),o&&(o.setData("alpha",0,"end"),o.ignore=!0);f.reposition();f.fx.animate(n.merge(e,{modes:["edge-property:alpha","linear"],onComplete:function(){s.removeEdge(r,{type:"nothing"});e.onComplete&&e.onComplete()}}));break;case"iter":s=this;f.fx.sequence({condition:function(){return r.length!=0},step:function(){s.removeEdge(r.shift(),{type:"nothing"});f.labels.clearLabels()},onComplete:function(){e.onComplete()},duration:Math.ceil(e.duration/r.length)});break;default:this.doError()}},sum:function(t,i){var r=this.viz,u=n.merge(this.options,r.controller,i),s=r.root,f,o,e;r.root=i.id||r.root;switch(u.type){case"nothing":f=r.construct(t);f.eachNode(function(n){n.eachAdjacency(function(n){r.graph.addAdjacence(n.nodeFrom,n.nodeTo,n.data)})});break;case"replot":r.refresh(!0);this.sum(t,{type:"nothing"});r.refresh(!0);break;case"fade:seq":case"fade":case"fade:con":that=this;f=r.construct(t);o=this.preprocessSum(f);e=o?["node-property:alpha","edge-property:alpha"]:["node-property:alpha"];r.reposition();u.type!="fade:con"?r.fx.animate(n.merge(u,{modes:["linear"],onComplete:function(){r.fx.animate(n.merge(u,{modes:e,onComplete:function(){u.onComplete()}}))}})):(r.graph.eachNode(function(n){n.id!=s&&n.pos.isZero()&&(n.pos.set(n.endPos),n.startPos.set(n.endPos))}),r.fx.animate(n.merge(u,{modes:["linear"].concat(e)})));break;default:this.doError()}},morph:function(t,i,r){var h,c,e;r=r||{};var u=this.viz,s=n.merge(this.options,u.controller,i),l=u.root,f;u.root=i.id||u.root;switch(s.type){case"nothing":f=u.construct(t);f.eachNode(function(n){var r=u.graph.hasNode(n.id),i,t;if(n.eachAdjacency(function(n){var r=!!u.graph.getAdjacence(n.nodeFrom.id,n.nodeTo.id),i,t;if(u.graph.addAdjacence(n.nodeFrom,n.nodeTo,n.data),r){i=u.graph.getAdjacence(n.nodeFrom.id,n.nodeTo.id);for(t in n.data||{})i.data[t]=n.data[t]}}),r){i=u.graph.getNode(n.id);for(t in n.data||{})i.data[t]=n.data[t]}});u.graph.eachNode(function(n){n.eachAdjacency(function(n){f.getAdjacence(n.nodeFrom.id,n.nodeTo.id)||u.graph.removeAdjacence(n.nodeFrom.id,n.nodeTo.id)});f.hasNode(n.id)||u.graph.removeNode(n.id)});break;case"replot":u.labels.clearLabels(!0);this.morph(t,{type:"nothing"});u.refresh(!0);u.refresh(!0);break;case"fade:seq":case"fade":case"fade:con":that=this;f=u.construct(t);h="node-property"in r&&n.map(n.splat(r["node-property"]),function(n){return"$"+n});u.graph.eachNode(function(t){var u=f.getNode(t.id),r,i;if(u){r=u.data;for(i in r)h&&n.indexOf(h,i)>-1?t.endData[i]=r[i]:t.data[i]=r[i]}else t.setData("alpha",1),t.setData("alpha",1,"start"),t.setData("alpha",0,"end"),t.ignore=!0});u.graph.eachNode(function(n){n.ignore||n.eachAdjacency(function(n){var t,i,n;n.nodeFrom.ignore||n.nodeTo.ignore||(t=f.getNode(n.nodeFrom.id),i=f.getNode(n.nodeTo.id),t.adjacentTo(i)||(n=u.graph.getAdjacence(t.id,i.id),c=!0,n.setData("alpha",1),n.setData("alpha",1,"start"),n.setData("alpha",0,"end")))})});c=this.preprocessSum(f);e=c?["node-property:alpha","edge-property:alpha"]:["node-property:alpha"];e[0]=e[0]+("node-property"in r?":"+n.splat(r["node-property"]).join(":"):"");e[1]=(e[1]||"edge-property:alpha")+("edge-property"in r?":"+n.splat(r["edge-property"]).join(":"):"");"label-property"in r&&e.push("label-property:"+n.splat(r["label-property"]).join(":"));u.reposition?u.reposition():u.compute("end");u.graph.eachNode(function(n){n.id!=l&&n.pos.getp().equals(o.KER)&&(n.pos.set(n.endPos),n.startPos.set(n.endPos))});u.fx.animate(n.merge(s,{modes:[r.position||"polar"].concat(e),onComplete:function(){u.graph.eachNode(function(n){n.ignore&&u.graph.removeNode(n.id)});u.graph.eachNode(function(n){n.eachAdjacency(function(n){n.ignore&&u.graph.removeAdjacence(n.nodeFrom.id,n.nodeTo.id)})});s.onComplete()}}))}},contract:function(t,i){var r=this.viz;!t.collapsed&&t.anySubnode(n.lambda(!0))&&(i=n.merge(this.options,r.config,i||{},{modes:["node-property:alpha:span","linear"]}),t.collapsed=!0,function u(n){n.eachSubnode(function(n){n.ignore=!0;n.setData("alpha",0,i.type=="animate"?"end":"current");u(n)})}(t),i.type=="animate"?(r.compute("end"),r.rotated&&r.rotate(r.rotated,"none",{property:"end"}),function u(n){n.eachSubnode(function(n){n.setPos(t.getPos("end"),"end");u(n)})}(t),r.fx.animate(i)):i.type=="replot"&&r.refresh())},expand:function(t,i){if("collapsed"in t){var r=this.viz;i=n.merge(this.options,r.config,i||{},{modes:["node-property:alpha:span","linear"]});delete t.collapsed,function u(n){n.eachSubnode(function(n){delete n.ignore;n.setData("alpha",1,i.type=="animate"?"end":"current");u(n)})}(t);i.type=="animate"?(r.compute("end"),r.rotated&&r.rotate(r.rotated,"none",{property:"end"}),r.fx.animate(i)):i.type=="replot"&&r.refresh()}},preprocessSum:function(n){var t=this.viz,i;return n.eachNode(function(n){if(!t.graph.hasNode(n.id)){t.graph.addNode(n);var i=t.graph.getNode(n.id);i.setData("alpha",0);i.setData("alpha",0,"start");i.setData("alpha",1,"end")}}),i=!1,n.eachNode(function(n){n.eachAdjacency(function(n){var r=t.graph.getNode(n.nodeFrom.id),u=t.graph.getNode(n.nodeTo.id),n;r.adjacentTo(u)||(n=t.graph.addAdjacence(r,u,n.data),r.startAlpha==r.endAlpha&&u.startAlpha==u.endAlpha&&(i=!0,n.setData("alpha",0),n.setData("alpha",0,"start"),n.setData("alpha",1,"end")))})}),i}};k={none:{render:n.empty,contains:n.lambda(!1)},circle:{render:function(n,t,i,r){var u=r.getCtx();u.beginPath();u.arc(t.x,t.y,i,0,Math.PI*2,!0);u.closePath();u[n]()},contains:function(n,t,i){var r=n.x-t.x,u=n.y-t.y,f=r*r+u*u;return f<=i*i}},ellipse:{render:function(n,t,i,r,u){var f=u.getCtx(),o=1,s=1,h=1,c=1,e=0;i>r?(e=i/2,s=r/i,c=i/r):(e=r/2,o=i/r,h=r/i);f.save();f.scale(o,s);f.beginPath();f.arc(t.x*h,t.y*c,e,0,Math.PI*2,!0);f.closePath();f[n]();f.restore()},contains:function(n,t,i,r){var u=0,o=1,s=1,f=0,e=0,h=0;return i>r?(u=i/2,s=r/i):(u=r/2,o=i/r),f=(n.x-t.x)*(1/o),e=(n.y-t.y)*(1/s),h=f*f+e*e,h<=u*u}},square:{render:function(n,t,i,r){r.getCtx()[n+"Rect"](t.x-i,t.y-i,2*i,2*i)},contains:function(n,t,i){return Math.abs(t.x-n.x)<=i&&Math.abs(t.y-n.y)<=i}},rectangle:{render:function(n,t,i,r,u){u.getCtx()[n+"Rect"](t.x-i/2,t.y-r/2,i,r)},contains:function(n,t,i,r){return Math.abs(t.x-n.x)<=i/2&&Math.abs(t.y-n.y)<=r/2}},triangle:{render:function(n,t,i,r){var u=r.getCtx(),f=t.x,o=t.y-i,s=f-i,e=t.y+i,h=f+i,c=e;u.beginPath();u.moveTo(f,o);u.lineTo(s,e);u.lineTo(h,c);u.closePath();u[n]()},contains:function(n,t,i){return k.circle.contains(n,t,i)}},star:{render:function(n,t,i,r){var u=r.getCtx(),e=Math.PI/5,f;for(u.save(),u.translate(t.x,t.y),u.beginPath(),u.moveTo(i,0),f=0;f<9;f++)u.rotate(e),f%2==0?u.lineTo(i/.525731*.200811,0):u.lineTo(i,0);u.closePath();u[n]();u.restore()},contains:function(n,t,i){return k.circle.contains(n,t,i)}}};d={line:{render:function(n,t,i){var r=i.getCtx();r.beginPath();r.moveTo(n.x,n.y);r.lineTo(t.x,t.y);r.stroke()},contains:function(n,t,i,r){var u=Math.min,f=Math.max,o=u(n.x,t.x),s=f(n.x,t.x),h=u(n.y,t.y),c=f(n.y,t.y),e;return i.x>=o&&i.x<=s&&i.y>=h&&i.y<=c?Math.abs(t.x-n.x)<=r?!0:(e=(t.y-n.y)/(t.x-n.x)*(i.x-n.x)+n.y,Math.abs(e-i.y)<=r):!1}},arrow:{render:function(n,t,i,r,u){var e=u.getCtx(),s,o;r&&(s=n,n=t,t=s);o=new f(t.x-n.x,t.y-n.y);o.$scale(i/o.norm());var h=new f(t.x-o.x,t.y-o.y),c=new f(-o.y/2,o.x/2),l=h.add(c),a=h.$add(c.$scale(-1));e.beginPath();e.moveTo(n.x,n.y);e.lineTo(t.x,t.y);e.stroke();e.beginPath();e.moveTo(l.x,l.y);e.lineTo(a.x,a.y);e.lineTo(t.x,t.y);e.closePath();e.fill()},contains:function(n,t,i,r){return d.line.contains(n,t,i,r)}},hyperline:{render:function(n,t,i,r){function h(n,t){var u=n.x*t.y-n.y*t.x,c=u,e=n.squaredNorm(),o=t.squaredNorm(),f,h;if(u==0)return{x:0,y:0,ratio:-1};var i=(n.y*o-t.y*e+n.y-t.y)/u,r=(t.x*e-n.x*o+t.x-n.x)/c,l=-i/2,a=-r/2,s=(i*i+r*r)/4-1;return s<0?{x:0,y:0,ratio:-1}:(f=Math.sqrt(s),h={x:l,y:a,ratio:f>1e3?-1:f,a:i,b:r},h)}function s(n,t){return n<t?n+Math.PI>t?!1:!0:t+Math.PI>n?!0:!1}var f=r.getCtx(),u=h(n,t);if(u.a>1e3||u.b>1e3||u.ratio<0)f.beginPath(),f.moveTo(n.x*i,n.y*i),f.lineTo(t.x*i,t.y*i),f.stroke();else{var e=Math.atan2(t.y-u.y,t.x-u.x),o=Math.atan2(n.y-u.y,n.x-u.x),s=s(e,o);f.beginPath();f.arc(u.x*i,u.y*i,u.ratio*i,e,o,s);f.stroke()}},contains:n.lambda(!1)}};i.Plot={initialize:function(n,t){this.viz=n;this.config=n.config;this.node=n.config.Node;this.edge=n.config.Edge;this.animation=new v;this.nodeTypes=new t.Plot.NodeTypes;this.edgeTypes=new t.Plot.EdgeTypes;this.labels=n.labels},nodeHelper:k,edgeHelper:d,Interpolator:{map:{border:"color",color:"color",width:"number",height:"number",dim:"number",alpha:"number",lineWidth:"number",angularWidth:"number",span:"number",valueArray:"array-number",dimArray:"array-number"},canvas:{globalAlpha:"number",fillStyle:"color",strokeStyle:"color",lineWidth:"number",shadowBlur:"number",shadowColor:"color",shadowOffsetX:"number",shadowOffsetY:"number",miterLimit:"number"},label:{size:"number",color:"color"},compute:function(n,t,i){return n+(t-n)*i},moebius:function(n,t,i,r){var u=r.scale(-i);if(u.norm()<1){var e=u.x,o=u.y,f=n.startPos.getc().moebiusTransformation(u);n.pos.setc(f.x,f.y);u.x=e;u.y=o}},linear:function(n,t,i){var r=n.startPos.getc(!0),u=n.endPos.getc(!0);n.pos.setc(this.compute(r.x,u.x,i),this.compute(r.y,u.y,i))},polar:function(n,t,i){var u=n.startPos.getp(!0),f=n.endPos.getp(),r=f.interpolate(u,i);n.pos.setp(r.theta,r.rho)},number:function(n,t,i,r,u){var f=n[r](t,"start"),e=n[r](t,"end");n[u](t,this.compute(f,e,i))},color:function(t,i,r,u,f){var e=n.hexToRgb(t[u](i,"start")),o=n.hexToRgb(t[u](i,"end")),s=this.compute,h=n.rgbToHex([parseInt(s(e[0],o[0],r)),parseInt(s(e[1],o[1],r)),parseInt(s(e[2],o[2],r))]);t[f](i,h)},"array-number":function(n,t,i,r,u){for(var f,h,c=n[r](t,"start"),a=n[r](t,"end"),s=[],e=0,v=c.length;e<v;e++)if(f=c[e],h=a[e],f.length){for(var o=0,y=f.length,l=[];o<y;o++)l.push(this.compute(f[o],h[o],i));s.push(l)}else s.push(this.compute(f,h,i));n[u](t,s)},node:function(n,t,i,r,u,f){var s,o,e;if(r=this[r],t)for(s=t.length,o=0;o<s;o++)e=t[o],this[r[e]](n,e,i,u,f);else for(e in r)this[r[e]](n,e,i,u,f)},edge:function(n,t,i,r,u,f){var e=n.adjacencies;for(var o in e)this.node(e[o],t,i,r,u,f)},"node-property":function(n,t,i){this.node(n,t,i,"map","getData","setData")},"edge-property":function(n,t,i){this.edge(n,t,i,"map","getData","setData")},"label-property":function(n,t,i){this.node(n,t,i,"label","getLabelData","setLabelData")},"node-style":function(n,t,i){this.node(n,t,i,"canvas","getCanvasStyle","setCanvasStyle")},"edge-style":function(n,t,i){this.edge(n,t,i,"canvas","getCanvasStyle","setCanvasStyle")}},sequence:function(t){var r=this,i;t=n.merge({condition:n.lambda(!1),step:n.empty,onComplete:n.empty,duration:200},t||{});i=setInterval(function(){t.condition()?t.step():(clearInterval(i),t.onComplete());r.viz.refresh(!0)},t.duration)},prepare:function(t){var s=this.viz.graph,r={"node-property":{getter:"getData",setter:"setData"},"edge-property":{getter:"getData",setter:"setData"},"node-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"},"edge-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"}},i={},u,o,e,f;if(n.type(t)=="array")for(u=0,o=t.length;u<o;u++)e=t[u].split(":"),i[e.shift()]=e;else for(f in t)f=="position"?i[t.position]=[]:i[f]=n.splat(t[f]);return s.eachNode(function(t){t.startPos.set(t.pos);n.each(["node-property","node-style"],function(n){var f,u,e;if(n in i)for(f=i[n],u=0,e=f.length;u<e;u++)t[r[n].setter](f[u],t[r[n].getter](f[u]),"start")});n.each(["edge-property","edge-style"],function(n){if(n in i){var u=i[n];t.eachAdjacency(function(t){for(var i=0,f=u.length;i<f;i++)t[r[n].setter](u[i],t[r[n].getter](u[i]),"start")})}})}),i},animate:function(t,i){t=n.merge(this.viz.config,t||{});var r=this,f=this.viz,e=f.graph,o=this.Interpolator,s=t.type==="nodefx"?this.nodeFxAnimation:this.animation,u=this.prepare(t.modes);t.hideLabels&&this.labels.hideLabels(!0);s.setOptions(n.extend(t,{$animating:!1,compute:function(n){e.eachNode(function(t){for(var r in u)o[r](t,u[r],n,i)});r.plot(t,this.$animating,n);this.$animating=!0},complete:function(){t.hideLabels&&r.labels.hideLabels(!1);r.plot(t);t.onComplete()}})).start()},nodeFx:function(t){var f=this.viz,e=f.graph,h=this.nodeFxAnimation,c=n.merge(this.viz.config,{elements:{id:!1,properties:{}},reposition:!1}),i,o,r,s,u;t=n.merge(c,t||{},{onBeforeCompute:n.empty,onAfterCompute:n.empty});h.stopTimer();i=t.elements.properties;t.elements.id?(o=n.splat(t.elements.id),n.each(o,function(n){var r=e.getNode(n),t;if(r)for(t in i)r.setData(t,i[t],"end")})):e.eachNode(function(n){for(var t in i)n.setData(t,i[t],"end")});r=[];for(s in i)r.push(s);u=["node-property:"+r.join(":")];t.reposition&&(u.push("linear"),f.compute("end"));this.animate(n.merge(t,{modes:u,type:"nodefx"}))},plot:function(n,t){var u=this.viz,o=u.graph,i=u.canvas,s=u.root,r=this,h=i.getCtx(),c=Math.min,n=n||this.viz.controller,f,e;(n.clearCanvas&&i.clear(),f=o.getNode(s),f)&&(e=!!f.visited,o.eachNode(function(u){var f=u.getData("alpha");u.eachAdjacency(function(f){var o=f.nodeTo;!!o.visited===e&&u.drawn&&o.drawn&&(t||n.onBeforePlotLine(f),r.plotLine(f,i,t),t||n.onAfterPlotLine(f))});u.drawn&&(t||n.onBeforePlotNode(u),r.plotNode(u,i,t),t||n.onAfterPlotNode(u));!r.labelsHidden&&n.withLabels&&(u.drawn&&f>=.95?r.labels.plotLabel(i,u,n):r.labels.hideLabel(u,!1));u.visited=!e}))},plotTree:function(n,t,i){var u=this,f=this.viz,r=f.canvas,o=this.config,s=r.getCtx(),e=n.getData("alpha");n.eachSubnode(function(f){if(t.plotSubtree(n,f)&&f.exist&&f.drawn){var e=n.getAdjacency(f.id);i||t.onBeforePlotLine(e);u.plotLine(e,r,i);i||t.onAfterPlotLine(e);u.plotTree(f,t,i)}});n.drawn?(i||t.onBeforePlotNode(n),this.plotNode(n,r,i),i||t.onAfterPlotNode(n),!t.hideLabels&&t.withLabels&&e>=.95?this.labels.plotLabel(r,n,t):this.labels.hideLabel(n,!1)):this.labels.hideLabel(n,!0)},plotNode:function(n,t,i){var f=n.getData("type"),e=this.node.CanvasStyles,u;if(f!="none"){var o=n.getData("lineWidth"),s=n.getData("color"),h=n.getData("alpha"),r=t.getCtx();r.save();r.lineWidth=o;r.fillStyle=r.strokeStyle=s;r.globalAlpha=h;for(u in e)r[u]=n.getCanvasStyle(u);this.nodeTypes[f].render.call(this,n,t,i);r.restore()}},plotLine:function(n,t,i){var f=n.getData("type"),e=this.edge.CanvasStyles,u;if(f!="none"){var o=n.getData("lineWidth"),s=n.getData("color"),r=t.getCtx(),h=n.nodeFrom,c=n.nodeTo;r.save();r.lineWidth=o;r.fillStyle=r.strokeStyle=s;r.globalAlpha=Math.min(h.getData("alpha"),c.getData("alpha"),n.getData("alpha"));for(u in e)r[u]=n.getCanvasStyle(u);this.edgeTypes[f].render.call(this,n,t,i);r.restore()}}};i.Plot3D=n.merge(i.Plot,{Interpolator:{linear:function(n,t,i){var r=n.startPos.getc(!0),u=n.endPos.getc(!0);n.pos.setc(this.compute(r.x,u.x,i),this.compute(r.y,u.y,i),this.compute(r.z,u.z,i))}},plotNode:function(n,t){n.getData("type")!="none"&&this.plotElement(n,t,{getAlpha:function(){return n.getData("alpha")}})},plotLine:function(n,t){n.getData("type")!="none"&&this.plotElement(n,t,{getAlpha:function(){return Math.min(n.nodeFrom.getData("alpha"),n.nodeTo.getData("alpha"),n.getData("alpha"))}})},plotElement:function(t,i,r){var u=i.getCtx(),b=new Matrix4,h=i.config.Scene.Lighting,ut=i.canvases[0],e=ut.program,ft=ut.camera,tt,o,w;if(t.geometry||(t.geometry=new O3D[t.getData("type")]),t.geometry.update(t),!t.webGLVertexBuffer){for(var a=[],y=[],v=[],s=0,et=t.geometry,k=0,p=et.vertices,ot=et.faces,ht=ot.length;k<ht;k++){var c=ot[k],d=p[c.a],g=p[c.b],nt=p[c.c],l=c.d?p[c.d]:!1,f=c.normal;a.push(d.x,d.y,d.z);a.push(g.x,g.y,g.z);a.push(nt.x,nt.y,nt.z);l&&a.push(l.x,l.y,l.z);v.push(f.x,f.y,f.z);v.push(f.x,f.y,f.z);v.push(f.x,f.y,f.z);l&&v.push(f.x,f.y,f.z);y.push(s,s+1,s+2);l?(y.push(s,s+2,s+3),s+=4):s+=3}t.webGLVertexBuffer=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,t.webGLVertexBuffer);u.bufferData(u.ARRAY_BUFFER,new Float32Array(a),u.STATIC_DRAW);t.webGLFaceBuffer=u.createBuffer();u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,t.webGLFaceBuffer);u.bufferData(u.ELEMENT_ARRAY_BUFFER,new Uint16Array(y),u.STATIC_DRAW);t.webGLFaceCount=y.length;t.webGLNormalBuffer=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,t.webGLNormalBuffer);u.bufferData(u.ARRAY_BUFFER,new Float32Array(v),u.STATIC_DRAW)}if(b.multiply(ft.matrix,t.geometry.matrix),u.uniformMatrix4fv(e.viewMatrix,!1,b.flatten()),u.uniformMatrix4fv(e.projectionMatrix,!1,ft.projectionMatrix.flatten()),tt=Matrix4.makeInvert(b),tt.$transpose(),u.uniformMatrix4fv(e.normalMatrix,!1,tt.flatten()),o=n.hexToRgb(t.getData("color")),o.push(r.getAlpha()),u.uniform4f(e.color,o[0]/255,o[1]/255,o[2]/255,o[3]),u.uniform1i(e.enableLighting,h.enable),h.enable&&(h.ambient&&(w=h.ambient,u.uniform3f(e.ambientColor,w[0],w[1],w[2])),h.directional)){var st=h.directional,o=st.color,it=st.direction,rt=new Vector3(it.x,it.y,it.z).normalize().$scale(-1);u.uniform3f(e.lightingDirection,rt.x,rt.y,rt.z);u.uniform3f(e.directionalColor,o[0],o[1],o[2])}u.bindBuffer(u.ARRAY_BUFFER,t.webGLVertexBuffer);u.vertexAttribPointer(e.position,3,u.FLOAT,!1,0,0);u.bindBuffer(u.ARRAY_BUFFER,t.webGLNormalBuffer);u.vertexAttribPointer(e.normal,3,u.FLOAT,!1,0,0);u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,t.webGLFaceBuffer);u.drawElements(u.TRIANGLES,t.webGLFaceCount,u.UNSIGNED_SHORT,0)}});i.Label={};i.Label.Native=new t({initialize:function(n){this.viz=n},plotLabel:function(n,t,i){var r=n.getCtx(),u=t.pos.getc(!0);r.font=t.getLabelData("style")+" "+t.getLabelData("size")+"px "+t.getLabelData("family");r.textAlign=t.getLabelData("textAlign");r.fillStyle=r.strokeStyle=t.getLabelData("color");r.textBaseline=t.getLabelData("textBaseline");this.renderLabel(n,t,i)},renderLabel:function(n,t){var r=n.getCtx(),i=t.pos.getc(!0);r.fillText(t.name,i.x,i.y+t.getData("height")/2)},hideLabel:n.empty,hideLabels:n.empty});i.Label.DOM=new t({labelsHidden:!1,labelContainer:!1,labels:{},getLabelContainer:function(){return this.labelContainer?this.labelContainer:this.labelContainer=document.getElementById(this.viz.config.labelContainer)},getLabel:function(n){return n in this.labels&&this.labels[n]!=null?this.labels[n]:this.labels[n]=document.getElementById(n)},hideLabels:function(n){var t=this.getLabelContainer();t.style.display=n?"none":"";this.labelsHidden=n},clearLabels:function(n){for(var t in this.labels)(n||!this.viz.graph.hasNode(t))&&(this.disposeLabel(t),delete this.labels[t])},disposeLabel:function(n){var t=this.getLabel(n);t&&t.parentNode&&t.parentNode.removeChild(t)},hideLabel:function(t,i){t=n.splat(t);var r=i?"":"none",u=this;n.each(t,function(n){var t=u.getLabel(n.id);t&&(t.style.display=r)})},fitsInCanvas:function(n,t){var i=t.getSize();return n.x>=i.width||n.x<0||n.y>=i.height||n.y<0?!1:!0}});i.Label.HTML=new t({Implements:i.Label.DOM,plotLabel:function(n,t,i){var u=t.id,r=this.getLabel(u),f;if(!r&&!(r=document.getElementById(u))){r=document.createElement("div");f=this.getLabelContainer();r.id=u;r.className="node";r.style.position="absolute";i.onCreateLabel(r,t);f.appendChild(r);this.labels[t.id]=r}this.placeLabel(r,t,i)}});i.Label.SVG=new t({Implements:i.Label.DOM,plotLabel:function(n,t,i){var u=t.id,r=this.getLabel(u),f,e,o;if(!r&&!(r=document.getElementById(u))){f="http://www.w3.org/2000/svg";r=document.createElementNS(f,"svg:text");e=document.createElementNS(f,"svg:tspan");r.appendChild(e);o=this.getLabelContainer();r.setAttribute("id",u);r.setAttribute("class","node");o.appendChild(r);i.onCreateLabel(r,t);this.labels[t.id]=r}this.placeLabel(r,t,i)}});i.Geom=new t({initialize:function(n){this.viz=n;this.config=n.config;this.node=n.config.Node;this.edge=n.config.Edge},translate:function(t,i){i=n.splat(i);this.viz.graph.eachNode(function(r){n.each(i,function(n){r.getPos(n).$add(t)})})},setRightLevelToShow:function(t,i,r){var f=this.getRightLevelToShow(t,i),e=this.viz.labels,u=n.merge({execShow:!0,execHide:!0,onHide:n.empty,onShow:n.empty},r||{});t.eachLevel(0,this.config.levelsToShow,function(n){var i=n._depth-t._depth;if(i>f){u.onHide(n);u.execHide&&(n.drawn=!1,n.exist=!1,e.hideLabel(n,!1))}else{u.onShow(n);u.execShow&&(n.exist=!0)}});t.drawn=!0},getRightLevelToShow:function(n,t){var r=this.config,i=r.levelsToShow,u=r.constrained;if(!u)return i;while(!this.treeFitsInCanvas(n,t,i)&&i>1)i--;return i}});var c={construct:function(t){var u=n.type(t)=="array",r=new i(this.graphOptions,this.config.Node,this.config.Edge,this.config.Label);return u?function(t,i){for(var u,f,s,e,o,h=function(n){for(var f,r=0,u=i.length;r<u;r++)if(i[r].id==n)return i[r];return f={id:n,name:n},t.addNode(f)},r=0,c=i.length;r<c;r++)if(t.addNode(i[r]),u=i[r].adjacencies,u)for(f=0,s=u.length;f<s;f++)e=u[f],o={},typeof u[f]!="string"&&(o=n.merge(e.data,{}),e=e.nodeTo),t.addAdjacence(i[r],h(e),o)}(r,t):function(n,t){if(n.addNode(t),t.children)for(var i=0,r=t.children;i<r.length;i++)n.addAdjacence(t,r[i]),arguments.callee(n,r[i])}(r,t),r},loadJSON:function(t,i){this.json=t;this.labels&&this.labels.clearLabels&&this.labels.clearLabels(!0);this.graph=this.construct(t);this.root=n.type(t)!="array"?t.id:t[i?i:0].id},toJSON:function(n){var t,i;if(n=n||"tree",n=="tree"){var t={},r=this.graph.getNode(this.root),t=function u(n){var t={},i;return t.id=n.id,t.name=n.name,t.data=n.data,i=[],n.eachSubnode(function(n){i.push(u(n))}),t.children=i,t}(r);return t}return t=[],i=!!this.graph.getNode(this.root).visited,this.graph.eachNode(function(n){var r={},u;r.id=n.id;r.name=n.name;r.data=n.data;u=[];n.eachAdjacency(function(n){var r=n.nodeTo,t;!!r.visited===i&&(t={},t.nodeTo=r.id,t.data=n.data,u.push(t))});r.adjacencies=u;t.push(r);n.visited=!i}),t}},e=$jit.Layouts={},g={label:null,compute:function(t,i,r){this.initializeLabel(r);var u=this.label,f=u.style;t.eachNode(function(t){var o=t.getData("autoWidth"),s=t.getData("autoHeight"),h,c,i;if(o||s){delete t.data.$width;delete t.data.$height;delete t.data.$dim;h=t.getData("width");c=t.getData("height");f.width=o?"auto":h+"px";f.height=s?"auto":c+"px";u.innerHTML=t.name;var r=u.offsetWidth,e=u.offsetHeight,l=t.getData("type");n.indexOf(["circle","square","triangle","star"],l)===-1?(t.setData("width",r),t.setData("height",e)):(i=r>e?r:e,t.setData("width",i),t.setData("height",i),t.setData("dim",i))}})},initializeLabel:function(n){this.label||(this.label=document.createElement("div"),document.body.appendChild(this.label));this.setLabelStyles(n)},setLabelStyles:function(){n.extend(this.label.style,{visibility:"hidden",position:"absolute",width:"auto",height:"auto"});this.label.className="jit-autoadjust-label"}};e.Tree=function(){function o(n,t,i,r,u){var o=t.Node,s=t.multitree,f,e;return o.overridable?(f=-1,e=-1,n.eachNode(function(n){if(n._depth==i&&(!s||"$orn"in n.data&&n.data.$orn==r)){var t=n.getData("width",u),o=n.getData("height",u);f=f<t?t:f;e=e<o?o:e}}),{width:f<0?o.width:f,height:e<0?o.height:e}):o}function s(n,t,i,r){var u=r=="left"||r=="right"?"y":"x";n.getPos(t)[u]+=i}function r(t,i){var r=[];return n.each(t,function(n){n=f.call(n);n[0]+=i;n[1]+=i;r.push(n)}),r}function i(n,t){if(n.length==0)return t;if(t.length==0)return n;var r=n.shift(),u=t.shift();return[[r[0],u[1]]].concat(i(n,t))}function e(n,t){if(t=t||[],n.length==0)return t;var r=n.pop();return e(n,i(r,t))}function u(n,t,i,r,f){if(n.length<=f||t.length<=f)return 0;var e=n[f][1],o=t[f][0];return Math.max(u(n,t,i,r,++f)+i,e-o+r)}function h(n,t,f){function e(n,o,s){if(o.length<=s)return[];var h=o[s],c=u(n,h,t,f,0);return[c].concat(e(i(n,r(h,c)),o,++s))}return e([],n,0)}function c(n,t,e){function o(n,f,s){if(f.length<=s)return[];var h=f[s],c=-u(h,n,t,e,0);return[c].concat(o(i(r(h,c),n),f,++s))}n=f.call(n);var s=o([],n.reverse(),0);return s.reverse()}function l(n,t,i,r){var f=h(n,t,i),e=c(n,t,i),u,o;for(r=="left"?e=f:r=="right"&&(f=e),u=0,o=[];u<f.length;u++)o[u]=(f[u]+e[u])/2;return o}function a(n,t,i,u,f){function p(t,h,c){var ft=t.getData(k,i),st=h||t.getData(y,i),tt=[],it=[],rt=!1,ht=st+u.levelDistance,ut,ot;t.eachSubnode(function(t){if(t.exist&&(!w||"$orn"in t.data&&t.data.$orn==f)){rt||(rt=o(n,u,t._depth,f,i));var r=p(t,rt[y],c+ht);tt.push(r.tree);it.push(r.extent)}});ut=l(it,g,d,nt);for(var a=0,et=[];a<tt.length;a++)s(tt[a],i,ut[a],f),et.push(r(it[a],ut[a]));return ot=[[-ft/2,ft/2]].concat(e(et)),t.getPos(i)[b]=0,t.getPos(i)[v]=f=="top"||f=="left"?c:-c,{tree:t,extent:ot}}var w=u.multitree,c=["x","y"],a=["width","height"],h=+(f=="left"||f=="right"),b=c[h],v=c[1-h],tt=u.Node,k=a[h],y=a[1-h],d=u.siblingOffset,g=u.subtreeOffset,nt=u.align;p(t,!1,0)}var f=Array.prototype.slice;return new t({compute:function(t,i){var u=t||"start",r=this.graph.getNode(this.root);n.extend(r,{drawn:!0,exist:!0,selected:!0});g.compute(this.graph,u,this.config);!i&&"_depth"in r||this.graph.computeLevels(this.root,0,"ignore");this.computePositions(r,u)},computePositions:function(t,i){var r=this.config,f=r.multitree,e=r.align,u=e!=="center"&&r.indent,s=r.orientation,h=f?["top","right","bottom","left"]:[s],o=this;n.each(h,function(n){a(o.graph,t,i,o.config,n,i);var r=["x","y"][+(n=="left"||n=="right")];(function s(t){t.eachSubnode(function(o){o.exist&&(!f||"$orn"in o.data&&o.data.$orn==n)&&(o.getPos(i)[r]+=t.getPos(i)[r],u&&(o.getPos(i)[r]+=e=="left"?u:-u),s(o))})})(t)})}})}();$jit.ST=function(){function o(n){var r,i,f;if(n=n||this.clickedNode,!this.config.constrained)return[];var e=this.geom,o=this.graph,s=this.canvas,h=n._depth,t=[];for(o.eachNode(function(i){i.exist&&!i.selected&&(i.isDescendantOf(n.id)?i._depth<=h&&t.push(i):t.push(i))}),r=e.getRightLevelToShow(n,s),n.eachLevel(r,r,function(n){n.exist&&!n.selected&&t.push(n)}),i=0;i<u.length;i++)f=this.graph.getNode(u[i]),f.isDescendantOf(n.id)||t.push(f);return t}function l(n){var t=[],i=this.config;return n=n||this.clickedNode,this.clickedNode.eachLevel(0,i.levelsToShow,function(n){!i.multitree||"$orn"in n.data||!n.anySubnode(function(n){return n.exist&&!n.drawn})?n.drawn&&!n.anySubnode("drawn")&&t.push(n):t.push(n)}),t}var u=[];return new t({Implements:[c,s,e.Tree],initialize:function(t){var e=$jit.ST,u;this.controller=this.config=n.merge(r("Canvas","Fx","Tree","Node","Edge","Controller","Tips","NodeStyles","Events","Navigation","Label"),{levelsToShow:2,levelDistance:30,constrained:!0,Node:{type:"rectangle"},duration:700,offsetX:0,offsetY:0},t);u=this.config;u.useCanvas?(this.canvas=u.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(u.background&&(u.background=n.merge({type:"Circles"},u.background)),this.canvas=new h(this,u),this.config.labelContainer=(typeof u.injectInto=="string"?u.injectInto:u.injectInto.id)+"-label");this.graphOptions={klass:f};this.graph=new i(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new e.Label[u.Label.type](this);this.fx=new e.Plot(this,e);this.op=new e.Op(this);this.group=new e.Group(this);this.geom=new e.Geom(this);this.clickedNode=null;this.initializeExtras()},plot:function(){this.fx.plot(this.controller)},switchPosition:function(n,t,i){var f=this.geom,u=this.fx,r=this;u.busy||(u.busy=!0,this.contract({onComplete:function(){if(f.switchOrientation(n),r.compute("end",!1),u.busy=!1,t=="animate")r.onClick(r.clickedNode.id,i);else t=="replot"&&r.select(r.clickedNode.id,i)}},n))},switchAlignment:function(n,t,i){if(this.config.align=n,t=="animate")this.select(this.clickedNode.id,i);else if(t=="replot")this.onClick(this.clickedNode.id,i)},addNodeInPath:function(n){u.push(n);this.select(this.clickedNode&&this.clickedNode.id||this.root)},clearNodesInPath:function(){u.length=0;this.select(this.clickedNode&&this.clickedNode.id||this.root)},refresh:function(){this.reposition();this.select(this.clickedNode&&this.clickedNode.id||this.root)},reposition:function(){this.graph.computeLevels(this.root,0,"ignore");this.geom.setRightLevelToShow(this.clickedNode,this.canvas);this.graph.eachNode(function(n){n.exist&&(n.drawn=!0)});this.compute("end")},requestNodes:function(t,i){var r=n.merge(this.controller,i),f=this.config.levelsToShow,u,e;r.request?(u=[],e=t._depth,t.eachLevel(0,f,function(n){n.drawn&&!n.anySubnode()&&(u.push(n),n._level=f-(n._depth-e))}),this.group.requestNodes(u,r)):r.onComplete()},contract:function(t,i){var f=this.config.orientation,r=this.geom,e=this.group,u;i&&r.switchOrientation(i);u=o.call(this);i&&r.switchOrientation(f);e.contract(u,n.merge(this.controller,t))},move:function(t,i){this.compute("end",!1);var r=i.Move,u={x:r.offsetX,y:r.offsetY};r.enable&&this.geom.translate(t.endPos.add(u).$scale(-1),"end");this.fx.animate(n.merge(this.controller,{modes:["linear"]},i))},expand:function(t,i){var r=l.call(this,t);this.group.expand(r,n.merge(this.controller,i))},selectPath:function(t){function f(t){if(t!=null&&!t.selected){t.selected=!0;n.each(e.group.getSiblings([t])[t.id],function(n){n.exist=!0;n.drawn=!0});var i=t.getParents();i=i.length>0?i[0]:null;f(i)}}var e=this,i,r;for(this.graph.eachNode(function(n){n.selected=!1}),i=0,r=[t.id].concat(u);i<r.length;i++)f(this.graph.getNode(r[i]))},setRoot:function(n,t,i){function e(){if(this.config.multitree&&r.data.$orn){var e=r.data.$orn,t={left:"right",right:"left",top:"bottom",bottom:"top"}[e];f.data.$orn=t,function s(i){i.eachSubnode(function(i){i.id!=n&&(i.data.$orn=t,s(i))})}(f);delete r.data.$orn}this.root=n;this.clickedNode=r;this.graph.computeLevels(this.root,0,"ignore");this.geom.setRightLevelToShow(r,o,{execHide:!1,onShow:function(n){n.drawn||(n.drawn=!0,n.setData("alpha",1,"end"),n.setData("alpha",0),n.pos.setc(r.pos.x,r.pos.y))}});this.compute("end");this.busy=!0;this.fx.animate({modes:["linear","node-property:alpha"],onComplete:function(){u.busy=!1;u.onClick(n,{onComplete:function(){i&&i.onComplete()}})}})}if(!this.busy){this.busy=!0;var u=this,o=this.canvas,f=this.graph.getNode(this.root),r=this.graph.getNode(n);delete f.data.$orns;t=="animate"?(e.call(this),u.selectPath(r)):t=="replot"&&(e.call(this),this.select(this.root))}},addSubtree:function(t,i,r){i=="replot"?this.op.sum(t,n.extend({type:"replot"},r||{})):i=="animate"&&this.op.sum(t,n.extend({type:"fade:seq"},r||{}))},removeSubtree:function(t,i,r,u){var e=this.graph.getNode(t),f=[];e.eachLevel(+!i,!1,function(n){f.push(n.id)});r=="replot"?this.op.removeNode(f,n.extend({type:"replot"},u||{})):r=="animate"&&this.op.removeNode(f,n.extend({type:"fade:seq"},u||{}))},select:function(t,i){var e=this.group,s=this.geom,u=this.graph.getNode(t),h=this.canvas,c=this.graph.getNode(this.root),f=n.merge(this.controller,i),r=this;f.onBeforeCompute(u);this.selectPath(u);this.clickedNode=u;this.requestNodes(u,{onComplete:function(){e.hide(e.prepare(o.call(r)),f);s.setRightLevelToShow(u,h);r.compute("current");r.graph.eachNode(function(n){var t=n.pos.getc(!0);n.startPos.setc(t.x,t.y);n.endPos.setc(t.x,t.y);n.visited=!1});var n={x:f.offsetX,y:f.offsetY};r.geom.translate(u.endPos.add(n).$scale(-1),["start","current","end"]);e.show(l.call(r));r.plot();f.onAfterCompute(r.clickedNode);f.onComplete()}})},onClick:function(t,i){var o=this.canvas,f=this,s=this.geom,e=this.config,h={Move:{enable:!0,offsetX:e.offsetX||0,offsetY:e.offsetY||0},setRightLevelToShowConfig:!1,onBeforeRequest:n.empty,onBeforeContract:n.empty,onBeforeMove:n.empty,onBeforeExpand:n.empty},u=n.merge(this.controller,h,i),r;if(!this.busy){this.busy=!0;r=this.graph.getNode(t);this.selectPath(r,this.clickedNode);this.clickedNode=r;u.onBeforeCompute(r);u.onBeforeRequest(r);this.requestNodes(r,{onComplete:function(){u.onBeforeContract(r);f.contract({onComplete:function(){s.setRightLevelToShow(r,o,u.setRightLevelToShowConfig);u.onBeforeMove(r);f.move(r,{Move:u.Move,onComplete:function(){u.onBeforeExpand(r);f.expand(r,{onComplete:function(){f.busy=!1;u.onAfterCompute(t);u.onComplete()}})}})}})}})}}})}();$jit.ST.$extend=!0;$jit.ST.Op=new t({Implements:i.Op});$jit.ST.Group=new t({initialize:function(n){this.viz=n;this.canvas=n.canvas;this.config=n.config;this.animation=new v;this.nodes=null},requestNodes:function(n,t){var e=0,r=n.length,o={},f=function(){t.onComplete()},u=this.viz,i;for(r==0&&f(),i=0;i<r;i++)o[n[i].id]=n[i],t.request(n[i].id,n[i]._level,{onComplete:function(n,t){t&&t.children&&(t.id=n,u.op.sum(t,{type:"nothing"}));++e==r&&(u.graph.computeLevels(u.root,0),f())}})},contract:function(t,i){var u=this.viz,r=this;t=this.prepare(t);this.animation.setOptions(n.merge(i,{$animating:!1,compute:function(n){n==1&&(n=.99);r.plotStep(1-n,i,this.$animating);this.$animating="contract"},complete:function(){r.hide(t,i)}})).start()},hide:function(t,i){for(var u,f=this.viz,r=0;r<t.length;r++)!1&&i&&i.request?(u=[],t[r].eachLevel(1,!1,function(n){u.push(n.id)}),f.op.removeNode(u,{type:"nothing"}),f.labels.clearLabels()):t[r].eachLevel(1,!1,function(t){t.exist&&n.extend(t,{drawn:!1,exist:!1})});i.onComplete()},expand:function(t,i){var r=this;this.show(t);this.animation.setOptions(n.merge(i,{$animating:!1,compute:function(n){r.plotStep(n,i,this.$animating);this.$animating="expand"},complete:function(){r.plotStep(undefined,i,!1);i.onComplete()}})).start()},show:function(t){var i=this.config;this.prepare(t);n.each(t,function(n){if(i.multitree&&!("$orn"in n.data)){delete n.data.$orns;var t=" ";n.eachSubnode(function(n){"$orn"in n.data&&t.indexOf(n.data.$orn)<0&&n.exist&&!n.drawn&&(t+=n.data.$orn+" ")});n.data.$orns=t}n.eachLevel(0,i.levelsToShow,function(n){n.exist&&(n.drawn=!0)})})},prepare:function(n){return this.nodes=this.getNodesWithChildren(n),this.nodes},getNodesWithChildren:function(n){var u=[],f=this.config,e=this.viz.root,t,i,r;for(n.sort(function(n,t){return(n._depth<=t._depth)-(n._depth>=t._depth)}),t=0;t<n.length;t++)if(n[t].anySubnode("exist")){for(i=t+1,r=!1;!r&&i<n.length;i++)(!f.multitree||"$orn"in n[i].data)&&(r=r||n[t].isDescendantOf(n[i].id));r||u.push(n[t])}return u},plotStep:function(t,i,r){for(var c=this.viz,a=this.config,v=c.canvas,l=v.getCtx(),e=this.nodes,f,o={},s,h,u=0;u<e.length;u++)f=e[u],o[f.id]=[],s=a.multitree&&!("$orn"in f.data),h=s&&f.data.$orns,f.eachSubgraph(function(n){s&&h&&h.indexOf(n.data.$orn)>0&&n.drawn?(n.drawn=!1,o[f.id].push(n)):s&&h||!n.drawn||(n.drawn=!1,o[f.id].push(n))}),f.drawn=!0;e.length>0&&c.fx.plot();for(u in o)n.each(o[u],function(n){n.drawn=!0});for(u=0;u<e.length;u++)f=e[u],l.save(),c.fx.plotSubtree(f,i,t,r),l.restore()},getSiblings:function(t){var i={};return n.each(t,function(n){var r=n.getParents(),t;r.length==0?i[n.id]=[n]:(t=[],r[0].eachSubnode(function(n){t.push(n)}),i[n.id]=t)}),i}});$jit.ST.Geom=new t({Implements:i.Geom,switchOrientation:function(n){this.config.orientation=n},dispatch:function(){var n=Array.prototype.slice.call(arguments),i=n.shift(),r=n.length,t=function(n){return typeof n=="function"?n():n};if(r==2)return i=="top"||i=="bottom"?t(n[0]):t(n[1]);if(r==4)switch(i){case"top":return t(n[0]);case"right":return t(n[1]);case"bottom":return t(n[2]);case"left":return t(n[3])}return undefined},getSize:function(n,t){var r=n.data,i=this.config,u=i.siblingOffset,f=i.multitree&&"$orn"in r&&r.$orn||i.orientation,e=n.getData("width")+u,o=n.getData("height")+u;return t?this.dispatch(f,e,o):this.dispatch(f,o,e)},getTreeBaseSize:function(n,t,i){var r=this.getSize(n,!0),u=0,f=this;return i(t,n)?r:t===0?0:(n.eachSubnode(function(n){u+=f.getTreeBaseSize(n,t-1,i)}),(r>u?r:u)+this.config.subtreeOffset)},getEdge:function(n,t,i){var r=function(t,i){return function(){return n.pos.add(new f(t,i))}},o=this.node,u=n.getData("width"),e=n.getData("height");if(t=="begin"){if(o.align=="center")return this.dispatch(i,r(0,e/2),r(-u/2,0),r(0,-e/2),r(u/2,0));if(o.align=="left")return this.dispatch(i,r(0,e),r(0,0),r(0,0),r(u,0));if(o.align=="right")return this.dispatch(i,r(0,0),r(-u,0),r(0,-e),r(0,0));throw"align: not implemented";}else if(t=="end"){if(o.align=="center")return this.dispatch(i,r(0,-e/2),r(u/2,0),r(0,e/2),r(-u/2,0));if(o.align=="left")return this.dispatch(i,r(0,0),r(u,0),r(0,e),r(0,0));if(o.align=="right")return this.dispatch(i,r(0,-e),r(0,0),r(0,0),r(-u,0));throw"align: not implemented";}},getScaledTreePosition:function(n,t){var e=this.node,r=n.getData("width"),u=n.getData("height"),o=this.config.multitree&&"$orn"in n.data&&n.data.$orn||this.config.orientation,i=function(i,r){return function(){return n.pos.add(new f(i,r)).$scale(1-t)}};if(e.align=="left")return this.dispatch(o,i(0,u),i(0,0),i(0,0),i(r,0));if(e.align=="center")return this.dispatch(o,i(0,u/2),i(-r/2,0),i(0,-u/2),i(r/2,0));if(e.align=="right")return this.dispatch(o,i(0,0),i(-r,0),i(0,-u),i(0,0));throw"align: not implemented";},treeFitsInCanvas:function(n,t,i){var r=t.getSize(),u=this.config.multitree&&"$orn"in n.data&&n.data.$orn||this.config.orientation,f=this.dispatch(u,r.width,r.height),e=this.getTreeBaseSize(n,i,function(n,t){return n===0||!t.anySubnode()});return e<f}});$jit.ST.Plot=new t({Implements:i.Plot,plotSubtree:function(t,i,r,u){var f=this.viz,s=f.canvas,h=f.config,e,o;r=Math.min(Math.max(.001,r),1);r>=0&&(t.drawn=!1,e=s.getCtx(),o=f.geom.getScaledTreePosition(t,r),e.translate(o.x,o.y),e.scale(r,r));this.plotTree(t,n.merge(i,{withLabels:!0,hideLabels:!!r,plotSubtree:function(){var n=h.multitree&&!("$orn"in t.data),i=n&&t.getData("orns");return!n||i.indexOf(t.getData("orn"))>-1}}),u);r>=0&&(t.drawn=!0)},getAlignedPos:function(n,t,i){var f=this.node,u,r;if(f.align=="center")u={x:n.x-t/2,y:n.y-i/2};else if(f.align=="left")r=this.config.orientation,u=r=="bottom"||r=="top"?{x:n.x-t/2,y:n.y}:{x:n.x,y:n.y-i/2};else if(f.align=="right")r=this.config.orientation,u=r=="bottom"||r=="top"?{x:n.x-t/2,y:n.y-i}:{x:n.x-t,y:n.y-i/2};else throw"align: not implemented";return u},getOrientation:function(n){var r=this.config,u=r.orientation,t,i;return r.multitree&&(t=n.nodeFrom,i=n.nodeTo,u="$orn"in t.data&&t.data.$orn||"$orn"in i.data&&i.data.$orn),u}});$jit.ST.Label={};$jit.ST.Label.Native=new t({Implements:i.Label.Native,renderLabel:function(n,t){var f=n.getCtx(),e=t.pos.getc(!0),i=t.getData("width"),r=t.getData("height"),u=this.viz.fx.getAlignedPos(e,i,r);f.fillText(t.name,u.x+i/2,u.y+r/2)}});$jit.ST.Label.DOM=new t({Implements:i.Label.DOM,placeLabel:function(n,t,i){var y=t.pos.getc(!0),a=this.viz.config,v=a.Node,u=this.viz.canvas,h=t.getData("width"),c=t.getData("height"),r=u.getSize(),f,e,p=u.translateOffsetX,w=u.translateOffsetY,b=u.scaleOffsetX,k=u.scaleOffsetY,o=y.x*b+p,s=y.y*k+w,l;if(v.align=="center")f={x:Math.round(o-h/2+r.width/2),y:Math.round(s-c/2+r.height/2)};else if(v.align=="left")e=a.orientation,f=e=="bottom"||e=="top"?{x:Math.round(o-h/2+r.width/2),y:Math.round(s+r.height/2)}:{x:Math.round(o+r.width/2),y:Math.round(s-c/2+r.height/2)};else if(v.align=="right")e=a.orientation,f=e=="bottom"||e=="top"?{x:Math.round(o-h/2+r.width/2),y:Math.round(s-c+r.height/2)}:{x:Math.round(o-h+r.width/2),y:Math.round(s-c/2+r.height/2)};else throw"align: not implemented";l=n.style;l.left=f.x+"px";l.top=f.y+"px";l.display=this.fitsInCanvas(f,u)?"":"none";i.onPlaceLabel(n,t)}});$jit.ST.Label.SVG=new t({Implements:[$jit.ST.Label.DOM,i.Label.SVG],initialize:function(n){this.viz=n}});$jit.ST.Label.HTML=new t({Implements:[$jit.ST.Label.DOM,i.Label.HTML],initialize:function(n){this.viz=n}});$jit.ST.Plot.NodeTypes=new t({none:{render:n.empty,contains:n.lambda(!1)},circle:{render:function(n,t){var i=n.getData("dim"),u=this.getAlignedPos(n.pos.getc(!0),i,i),r=i/2;this.nodeHelper.circle.render("fill",{x:u.x+r,y:u.y+r},r,t)},contains:function(n,t){var i=n.getData("dim"),u=this.getAlignedPos(n.pos.getc(!0),i,i),r=i/2;this.nodeHelper.circle.contains({x:u.x+r,y:u.y+r},t,r)}},square:{render:function(n,t){var i=n.getData("dim"),r=i/2,u=this.getAlignedPos(n.pos.getc(!0),i,i);this.nodeHelper.square.render("fill",{x:u.x+r,y:u.y+r},r,t)},contains:function(n,t){var i=n.getData("dim"),u=this.getAlignedPos(n.pos.getc(!0),i,i),r=i/2;this.nodeHelper.square.contains({x:u.x+r,y:u.y+r},t,r)}},ellipse:{render:function(n,t){var i=n.getData("width"),r=n.getData("height"),u=this.getAlignedPos(n.pos.getc(!0),i,r);this.nodeHelper.ellipse.render("fill",{x:u.x+i/2,y:u.y+r/2},i,r,t)},contains:function(n,t){var i=n.getData("width"),r=n.getData("height"),u=this.getAlignedPos(n.pos.getc(!0),i,r);this.nodeHelper.ellipse.contains({x:u.x+i/2,y:u.y+r/2},t,i,r)}},rectangle:{render:function(n,t){var i=n.getData("width"),r=n.getData("height"),u=this.getAlignedPos(n.pos.getc(!0),i,r);this.nodeHelper.rectangle.render("fill",{x:u.x+i/2,y:u.y+r/2},i,r,t)},contains:function(n,t){var i=n.getData("width"),r=n.getData("height"),u=this.getAlignedPos(n.pos.getc(!0),i,r);this.nodeHelper.rectangle.contains({x:u.x+i/2,y:u.y+r/2},t,i,r)}}});$jit.ST.Plot.EdgeTypes=new t({none:n.empty,line:{render:function(n,t){var u=this.getOrientation(n),i=n.nodeFrom,r=n.nodeTo,f=i._depth<r._depth,e=this.viz.geom.getEdge(f?i:r,"begin",u),o=this.viz.geom.getEdge(f?r:i,"end",u);this.edgeHelper.line.render(e,o,t)},contains:function(n,t){var u=this.getOrientation(n),i=n.nodeFrom,r=n.nodeTo,f=i._depth<r._depth,e=this.viz.geom.getEdge(f?i:r,"begin",u),o=this.viz.geom.getEdge(f?r:i,"end",u);return this.edgeHelper.line.contains(e,o,t,this.edge.epsilon)}},arrow:{render:function(n,t){var r=this.getOrientation(n),u=n.nodeFrom,f=n.nodeTo,e=n.getData("dim"),o=this.viz.geom.getEdge(u,"begin",r),s=this.viz.geom.getEdge(f,"end",r),i=n.data.$direction,h=i&&i.length>1&&i[0]!=u.id;this.edgeHelper.arrow.render(o,s,e,h,t)},contains:function(n,t){var u=this.getOrientation(n),i=n.nodeFrom,r=n.nodeTo,f=i._depth<r._depth,e=this.viz.geom.getEdge(f?i:r,"begin",u),o=this.viz.geom.getEdge(f?r:i,"end",u);return this.edgeHelper.arrow.contains(e,o,t,this.edge.epsilon)}},"quadratic:begin":{render:function(n,t){var e=this.getOrientation(n),o=n.nodeFrom,s=n.nodeTo,h=o._depth<s._depth,i=this.viz.geom.getEdge(h?o:s,"begin",e),r=this.viz.geom.getEdge(h?s:o,"end",e),f=n.getData("dim"),u=t.getCtx();u.beginPath();u.moveTo(i.x,i.y);switch(e){case"left":u.quadraticCurveTo(i.x+f,i.y,r.x,r.y);break;case"right":u.quadraticCurveTo(i.x-f,i.y,r.x,r.y);break;case"top":u.quadraticCurveTo(i.x,i.y+f,r.x,r.y);break;case"bottom":u.quadraticCurveTo(i.x,i.y-f,r.x,r.y)}u.stroke()}},"quadratic:end":{render:function(n,t){var f=this.getOrientation(n),e=n.nodeFrom,o=n.nodeTo,s=e._depth<o._depth,h=this.viz.geom.getEdge(s?e:o,"begin",f),i=this.viz.geom.getEdge(s?o:e,"end",f),u=n.getData("dim"),r=t.getCtx();r.beginPath();r.moveTo(h.x,h.y);switch(f){case"left":r.quadraticCurveTo(i.x-u,i.y,i.x,i.y);break;case"right":r.quadraticCurveTo(i.x+u,i.y,i.x,i.y);break;case"top":r.quadraticCurveTo(i.x,i.y-u,i.x,i.y);break;case"bottom":r.quadraticCurveTo(i.x,i.y+u,i.x,i.y)}r.stroke()}},bezier:{render:function(n,t){var e=this.getOrientation(n),o=n.nodeFrom,s=n.nodeTo,h=o._depth<s._depth,r=this.viz.geom.getEdge(h?o:s,"begin",e),i=this.viz.geom.getEdge(h?s:o,"end",e),u=n.getData("dim"),f=t.getCtx();f.beginPath();f.moveTo(r.x,r.y);switch(e){case"left":f.bezierCurveTo(r.x+u,r.y,i.x-u,i.y,i.x,i.y);break;case"right":f.bezierCurveTo(r.x-u,r.y,i.x+u,i.y,i.x,i.y);break;case"top":f.bezierCurveTo(r.x,r.y+u,i.x,i.y-u,i.x,i.y);break;case"bottom":f.bezierCurveTo(r.x,r.y-u,i.x,i.y+u,i.x,i.y)}f.stroke()}}});$jit.ST.Plot.NodeTypes.implement({"areachart-stacked":{render:function(t,i){var ht=t.pos.getc(!0),s=t.getData("width"),ct=t.getData("height"),tt=this.getAlignedPos(ht,s,ct),f=tt.x,e=tt.y,it=t.getData("stringArray"),o=t.getData("dimArray"),w=t.getData("valueArray"),rt=n.reduce(w,function(n,t){return n+t[0]},0),ut=n.reduce(w,function(n,t){return n+t[1]},0),l=t.getData("colorArray"),y=l.length,v=t.getData("config"),lt=t.getData("gradient"),at=v.showLabels,vt=v.showAggregates,c=v.Label,yt=t.getData("prev"),r=i.getCtx(),b=t.getData("border"),p;if(l&&o&&it){for(var u=0,pt=o.length,h=0,a=0,k=0;u<pt;u++){if(r.fillStyle=r.strokeStyle=l[u%y],r.save(),lt&&(o[u][0]>0||o[u][1]>0)){var d=h+o[u][0],g=a+o[u][1],ft=Math.atan((g-d)/s),et=55,nt=r.createLinearGradient(f+s/2,e-(d+g)/2,f+s/2+et*Math.sin(ft),e-(d+g)/2+et*Math.cos(ft)),ot=n.rgbToHex(n.map(n.hexToRgb(l[u%y].slice(1)),function(n){return n*.85>>0}));nt.addColorStop(0,l[u%y]);nt.addColorStop(1,ot);r.fillStyle=nt}if(r.beginPath(),r.moveTo(f,e-h),r.lineTo(f+s,e-a),r.lineTo(f+s,e-a-o[u][1]),r.lineTo(f,e-h-o[u][0]),r.lineTo(f,e-h),r.fill(),r.restore(),b){var st=b.name==it[u],wt=st?.7:.8,ot=n.rgbToHex(n.map(n.hexToRgb(l[u%y].slice(1)),function(n){return n*wt>>0}));r.strokeStyle=ot;r.lineWidth=st?4:1;r.save();r.beginPath();b.index===0?(r.moveTo(f,e-h),r.lineTo(f,e-h-o[u][0])):(r.moveTo(f+s,e-a),r.lineTo(f+s,e-a-o[u][1]));r.stroke();r.restore()}h+=o[u][0]||0;a+=o[u][1]||0;o[u][0]>0&&(k+=w[u][0]||0)}yt&&c.type=="Native"&&(r.save(),r.beginPath(),r.fillStyle=r.strokeStyle=c.color,r.font=c.style+" "+c.size+"px "+c.family,r.textAlign="center",r.textBaseline="middle",p=vt(t.name,rt,ut,t,k),p!==!1&&r.fillText(p!==!0?p:k,f,e-h-v.labelOffset-c.size/2,s),at(t.name,rt,ut,t)&&r.fillText(t.name,f,e+c.size/2+v.labelOffset),r.restore())}},contains:function(n,t){var p=n.pos.getc(!0),r=n.getData("width"),h=n.getData("height"),c=this.getAlignedPos(p,r,h),f=c.x,u=c.y,l=n.getData("dimArray"),a=t.x-f,o,y,s;if(t.x<f||t.x>f+r||t.y>u||t.y<u-h)return!1;for(var i=0,w=l.length,e=u,v=u;i<w;i++)if(o=l[i],e-=o[0],v-=o[1],y=e+(v-e)*a/r,t.y>=y)return s=+(a>r/2),{name:n.getData("stringArray")[i],color:n.getData("colorArray")[i],value:n.getData("valueArray")[i][s],index:s};return!1}}});$jit.AreaChart=new t({st:null,colors:["#416D9C","#70A35E","#EBB056","#C74243","#83548B","#909291","#557EAA"],selected:{},busy:!1,initialize:function(t){this.controller=this.config=n.merge(r("Canvas","Margin","Label","AreaChart"),{Label:{type:"Native"}},t);var i=this.config.showLabels,f=n.type(i),u=this.config.showAggregates,e=n.type(u);this.config.showLabels=f=="function"?i:n.lambda(i);this.config.showAggregates=e=="function"?u:n.lambda(u);this.initializeViz()},initializeViz:function(){var t=this.config,i=this,e=t.type.split(":")[0],f={},r=new $jit.ST({injectInto:t.injectInto,width:t.width,height:t.height,orientation:"bottom",levelDistance:0,siblingOffset:0,subtreeOffset:0,withLabels:t.Label.type!="Native",useCanvas:t.useCanvas,Label:{type:t.Label.type},Node:{overridable:!0,type:"areachart-"+e,align:"left",width:1,height:1},Edge:{type:"none"},Tips:{enable:t.Tips.enable,type:"Native",force:!0,onShow:function(n,i,r){var u=r;t.Tips.onShow(n,u,i)}},Events:{enable:!0,type:"Native",onClick:function(n,r,u){if(t.filterOnClick||t.Events.enable){var f=r.getContains();f&&t.filterOnClick&&i.filter(f.name);t.Events.enable&&t.Events.onClick(f,r,u)}},onRightClick:function(){t.restoreOnRightClick&&i.restore()},onMouseMove:function(n,r){if(t.selectOnHover)if(n){var u=r.getContains();i.select(n.id,u.name,u.index)}else i.select(!1,!1,!1)}},onCreateLabel:function(i,r){var h=t.Label,l=r.getData("valueArray"),a=n.reduce(l,function(n,t){return n+t[0]},0),v=n.reduce(l,function(n,t){return n+t[1]},0);if(r.getData("prev")){var e={wrapper:document.createElement("div"),aggregate:document.createElement("div"),label:document.createElement("div")},o=e.wrapper,s=e.label,c=e.aggregate,u=o.style,y=s.style,p=c.style;f[r.id]=e;o.appendChild(s);o.appendChild(c);t.showLabels(r.name,a,v,r)||(s.style.display="none");t.showAggregates(r.name,a,v,r)||(c.style.display="none");u.position="relative";u.overflow="visible";u.fontSize=h.size+"px";u.fontFamily=h.family;u.color=h.color;u.textAlign="center";p.position=y.position="absolute";i.style.width=r.getData("width")+"px";i.style.height=r.getData("height")+"px";s.innerHTML=r.name;i.appendChild(o)}},onPlaceLabel:function(i,r){var c;if(r.getData("prev")){var o=f[r.id],a=o.wrapper.style,s=o.label.style,h=o.aggregate.style,y=r.getData("width"),g=r.getData("height"),v=r.getData("dimArray"),u=r.getData("valueArray"),p=n.reduce(u,function(n,t){return n+t[0]},0),w=n.reduce(u,function(n,t){return n+t[1]},0),k=parseInt(a.fontSize,10),nt=i.style;if(v&&u){s.display=t.showLabels(r.name,p,w,r)?"":"none";c=t.showAggregates(r.name,p,w,r);h.display=c!==!1?"":"none";a.width=h.width=s.width=i.style.width=y+"px";h.left=s.left=-y/2+"px";for(var e=0,d=u.length,b=0,l=0;e<d;e++)v[e][0]>0&&(b+=u[e][0],l+=v[e][0]);h.top=-k-t.labelOffset+"px";s.top=t.labelOffset+l+"px";i.style.top=parseInt(i.style.top,10)-l+"px";i.style.height=a.height=l+"px";o.aggregate.innerHTML=c!==!0?c:b}}}}),o=r.canvas.getSize(),u=t.Margin;r.config.offsetY=-o.height/2+u.bottom+(t.showLabels&&t.labelOffset+t.Label.size);r.config.offsetX=(u.right-u.left)/2;this.delegate=r;this.canvas=this.delegate.canvas},loadJSON:function(t){for(var l,e=n.time(),o=[],u=this.delegate,a=n.splat(t.label),v=n.splat(t.color||this.colors),f=this.config,y=!!f.type.split(":")[1],p=f.animate,i=0,r=t.values,w=r.length;i<w-1;i++){var s=r[i],h=r[i-1],b=r[i+1],k=n.splat(r[i].values),d=n.splat(r[i+1].values),c=n.zip(k,d);o.push({id:e+s.label,name:s.label,data:{value:c,$valueArray:c,$colorArray:v,$stringArray:a,$next:b.label,$prev:h?h.label:!1,$config:f,$gradient:y},children:[]})}l={id:e+"$root",name:"",data:{$type:"none",$width:1,$height:1},children:o};u.loadJSON(l);this.normalizeDims();u.compute();u.select(u.root);p&&u.fx.animate({modes:["node-property:height:dimArray"],duration:1500})},updateJSON:function(t,i){var u,s;if(!this.busy){this.busy=!0;var r=this.delegate,h=r.graph,o=t.label&&n.splat(t.label),f=t.values,c=this.config.animate,l=this,e={};for(u=0,s=f.length;u<s;u++)e[f[u].label]=f[u];h.eachNode(function(t){var i=e[t.name],f=t.getData("stringArray"),r=t.getData("valueArray"),u=t.getData("next");i&&(i.values=n.splat(i.values),n.each(r,function(n,t){n[0]=i.values[t];o&&(f[t]=o[t])}),t.setData("valueArray",r));u&&(i=e[u],i&&n.each(r,function(n,t){n[1]=i.values[t]}))});this.normalizeDims();r.compute();r.select(r.root);c&&r.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){l.busy=!1;i&&i.onComplete()}})}},filter:function(t,i){if(!this.busy){this.busy=!0;this.config.Tips.enable&&this.delegate.tips.hide();this.select(!1,!1,!1);var r=n.splat(t),u=this.delegate.graph.getNode(this.delegate.root),f=this;this.normalizeDims();u.eachAdjacency(function(t){var i=t.nodeTo,u=i.getData("dimArray","end"),f=i.getData("stringArray");i.setData("dimArray",n.map(u,function(t,i){return n.indexOf(r,f[i])>-1?t:[0,0]}),"end")});this.delegate.fx.animate({modes:["node-property:dimArray"],duration:1500,onComplete:function(){f.busy=!1;i&&i.onComplete()}})}},restore:function(n){if(!this.busy){this.busy=!0;this.config.Tips.enable&&this.delegate.tips.hide();this.select(!1,!1,!1);this.normalizeDims();var t=this;this.delegate.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){t.busy=!1;n&&n.onComplete()}})}},select:function(n,t,i){var r,u,f;this.config.selectOnHover&&(r=this.selected,(r.id!=n||r.name!=t||r.index!=i)&&(r.id=n,r.name=t,r.index=i,this.delegate.graph.eachNode(function(n){n.setData("border",!1)}),n&&(u=this.delegate.graph.getNode(n),u.setData("border",r),f=i===0?"prev":"next",f=u.getData(f),f&&(u=this.delegate.graph.getByName(f),u&&u.setData("border",{name:t,index:1-i}))),this.delegate.plot()))},getLegend:function(){var r={},t,i,u;return this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(n){t=n.nodeTo}),i=t.getData("colorArray"),u=i.length,n.each(t.getData("stringArray"),function(n,t){r[n]=i[t%u]}),r},getMaxValue:function(){var t=0;return this.delegate.graph.eachNode(function(i){var e=i.getData("valueArray"),r=0,u=0,f;n.each(e,function(n){r+=+n[0];u+=+n[1]});f=u>r?u:r;t=t>f?t:f}),t},normalizeDims:function(){var s=this.delegate.graph.getNode(this.delegate.root),f=0;s.eachAdjacency(function(){f++});var t=this.getMaxValue()||1,e=this.delegate.canvas.getSize(),i=this.config,u=i.Margin,o=i.labelOffset+i.Label.size,h=(e.width-(u.left+u.right))/f,c=i.animate,r=e.height-(u.top+u.bottom)-(i.showAggregates&&o)-(i.showLabels&&o);this.delegate.graph.eachNode(function(i){var u=0,f=0,o=[],e,s;n.each(i.getData("valueArray"),function(n){u+=+n[0];f+=+n[1];o.push([0,0])});e=f>u?f:u;i.setData("width",h);c?(i.setData("height",e*r/t,"end"),i.setData("dimArray",n.map(i.getData("valueArray"),function(n){return[n[0]*r/t,n[1]*r/t]}),"end"),s=i.getData("dimArray"),s||i.setData("dimArray",o)):(i.setData("height",e*r/t),i.setData("dimArray",n.map(i.getData("valueArray"),function(n){return[n[0]*r/t,n[1]*r/t]})))})}});r.BarChart={$extend:!0,animate:!0,type:"stacked",labelOffset:3,barsOffset:0,hoveredColor:"#9fd4ff",orientation:"horizontal",showAggregates:!0,showLabels:!0,Tips:{enable:!1,onShow:n.empty,onHide:n.empty},Events:{enable:!1,onClick:n.empty}};$jit.ST.Plot.NodeTypes.implement({"barchart-stacked":{render:function(t,i){var rt=t.pos.getc(!0),y=t.getData("width"),l=t.getData("height"),tt=this.getAlignedPos(rt,y,l),f=tt.x,e=tt.y,o=t.getData("dimArray"),ut=t.getData("valueArray"),p=t.getData("colorArray"),g=p.length,it=t.getData("stringArray"),r=i.getCtx(),a={},k=t.getData("border"),ft=t.getData("gradient"),h=t.getData("config"),w=h.orientation=="horizontal",et=h.showAggregates,ot=h.showLabels,c=h.Label,b,nt,v;if(p&&o&&it){for(var u=0,st=o.length,s=0,d=0;u<st;u++)r.fillStyle=r.strokeStyle=p[u%g],ft&&(b=w?r.createLinearGradient(f+s+o[u]/2,e,f+s+o[u]/2,e+l):r.createLinearGradient(f,e-s-o[u]/2,f+y,e-s-o[u]/2),nt=n.rgbToHex(n.map(n.hexToRgb(p[u%g].slice(1)),function(n){return n*.5>>0})),b.addColorStop(0,nt),b.addColorStop(.5,p[u%g]),b.addColorStop(1,nt),r.fillStyle=b),w?r.fillRect(f+s,e,o[u],l):r.fillRect(f,e-s-o[u],y,o[u]),k&&k.name==it[u]&&(a.acum=s,a.dimValue=o[u]),s+=o[u]||0,d+=ut[u]||0;k&&(r.save(),r.lineWidth=2,r.strokeStyle=k.color,w?r.strokeRect(f+a.acum+1,e+1,a.dimValue-2,l-2):r.strokeRect(f+1,e-a.acum-a.dimValue+1,y-2,a.dimValue-2),r.restore());c.type=="Native"&&(r.save(),r.fillStyle=r.strokeStyle=c.color,r.font=c.style+" "+c.size+"px "+c.family,r.textBaseline="middle",v=et(t.name,d,t),v!==!1&&(v=v!==!0?v:d,w?(r.textAlign="right",r.fillText(v,f+s-h.labelOffset,e+l/2)):(r.textAlign="center",r.fillText(v,f+y/2,e-l-c.size/2-h.labelOffset))),ot(t.name,d,t)&&(w?(r.textAlign="center",r.translate(f-h.labelOffset-c.size/2,e+l/2),r.rotate(Math.PI/2),r.fillText(t.name,0,0)):(r.textAlign="center",r.fillText(t.name,f+y/2,e+c.size/2+h.labelOffset))),r.restore())}},contains:function(n,t){var v=n.pos.getc(!0),o=n.getData("width"),s=n.getData("height"),l=this.getAlignedPos(v,o,s),r=l.x,u=l.y,a=n.getData("dimArray"),y=n.getData("config"),w=t.x-r,h=y.orientation=="horizontal",c,e;if(h){if(t.x<r||t.x>r+o||t.y>u+s||t.y<u)return!1}else if(t.x<r||t.x>r+o||t.y>u||t.y<u-s)return!1;for(var i=0,p=a.length,f=h?r:u;i<p;i++)if(c=a[i],h){if(f+=c,e=f,t.x<=e)return{name:n.getData("stringArray")[i],color:n.getData("colorArray")[i],value:n.getData("valueArray")[i],label:n.name}}else if(f-=c,e=f,t.y>=e)return{name:n.getData("stringArray")[i],color:n.getData("colorArray")[i],value:n.getData("valueArray")[i],label:n.name};return!1}},"barchart-grouped":{render:function(t,i){var ft=t.pos.getc(!0),w=t.getData("width"),b=t.getData("height"),tt=this.getAlignedPos(ft,w,b),f=tt.x,e=tt.y,o=t.getData("dimArray"),it=t.getData("valueArray"),rt=it.length,y=t.getData("colorArray"),g=y.length,ut=t.getData("stringArray"),r=i.getCtx(),l={},k=t.getData("border"),et=t.getData("gradient"),h=t.getData("config"),v=h.orientation=="horizontal",ot=h.showAggregates,st=h.showLabels,c=h.Label,s=(v?b:w)/rt,p,nt,a;if(y&&o&&ut){for(var u=0,ht=rt,ct=0,d=0;u<ht;u++)r.fillStyle=r.strokeStyle=y[u%g],et&&(p=v?r.createLinearGradient(f+o[u]/2,e+s*u,f+o[u]/2,e+s*(u+1)):r.createLinearGradient(f+s*u,e-o[u]/2,f+s*(u+1),e-o[u]/2),nt=n.rgbToHex(n.map(n.hexToRgb(y[u%g].slice(1)),function(n){return n*.5>>0})),p.addColorStop(0,nt),p.addColorStop(.5,y[u%g]),p.addColorStop(1,nt),r.fillStyle=p),v?r.fillRect(f,e+s*u,o[u],s):r.fillRect(f+s*u,e-o[u],s,o[u]),k&&k.name==ut[u]&&(l.acum=s*u,l.dimValue=o[u]),ct+=o[u]||0,d+=it[u]||0;k&&(r.save(),r.lineWidth=2,r.strokeStyle=k.color,v?r.strokeRect(f+1,e+l.acum+1,l.dimValue-2,s-2):r.strokeRect(f+l.acum+1,e-l.dimValue+1,s-2,l.dimValue-2),r.restore());c.type=="Native"&&(r.save(),r.fillStyle=r.strokeStyle=c.color,r.font=c.style+" "+c.size+"px "+c.family,r.textBaseline="middle",a=ot(t.name,d,t),a!==!1&&(a=a!==!0?a:d,v?(r.textAlign="right",r.fillText(a,f+Math.max.apply(null,o)-h.labelOffset,e+b/2)):(r.textAlign="center",r.fillText(a,f+w/2,e-Math.max.apply(null,o)-c.size/2-h.labelOffset))),st(t.name,d,t)&&(v?(r.textAlign="center",r.translate(f-h.labelOffset-c.size/2,e+b/2),r.rotate(Math.PI/2),r.fillText(t.name,0,0)):(r.textAlign="center",r.fillText(t.name,f+w/2,e+c.size/2+h.labelOffset))),r.restore())}},contains:function(n,t){var y=n.pos.getc(!0),e=n.getData("width"),o=n.getData("height"),a=this.getAlignedPos(y,e,o),r=a.x,u=a.y,h=n.getData("dimArray"),p=h.length,w=n.getData("config"),b=t.x-r,c=w.orientation=="horizontal",s=(c?o:e)/p,i,v,l,f;if(c){if(t.x<r||t.x>r+e||t.y>u+o||t.y<u)return!1}else if(t.x<r||t.x>r+e||t.y>u||t.y<u-o)return!1;for(i=0,v=h.length;i<v;i++)if(l=h[i],c){if(f=u+s*i,t.x<=r+l&&t.y>=f&&t.y<=f+s)return{name:n.getData("stringArray")[i],color:n.getData("colorArray")[i],value:n.getData("valueArray")[i],label:n.name}}else if(f=r+s*i,t.x>=f&&t.x<=f+s&&t.y>=u-l)return{name:n.getData("stringArray")[i],color:n.getData("colorArray")[i],value:n.getData("valueArray")[i],label:n.name};return!1}}});$jit.BarChart=new t({st:null,colors:["#416D9C","#70A35E","#EBB056","#C74243","#83548B","#909291","#557EAA"],selected:{},busy:!1,initialize:function(t){this.controller=this.config=n.merge(r("Canvas","Margin","Label","BarChart"),{Label:{type:"Native"}},t);var i=this.config.showLabels,f=n.type(i),u=this.config.showAggregates,e=n.type(u);this.config.showLabels=f=="function"?i:n.lambda(i);this.config.showAggregates=e=="function"?u:n.lambda(u);this.initializeViz()},initializeViz:function(){var t=this.config,f=this,s=t.type.split(":")[0],e=t.orientation=="horizontal",u={},i=new $jit.ST({injectInto:t.injectInto,width:t.width,height:t.height,orientation:e?"left":"bottom",levelDistance:0,siblingOffset:t.barsOffset,subtreeOffset:0,withLabels:t.Label.type!="Native",useCanvas:t.useCanvas,Label:{type:t.Label.type},Node:{overridable:!0,type:"barchart-"+s,align:"left",width:1,height:1},Edge:{type:"none"},Tips:{enable:t.Tips.enable,type:"Native",force:!0,onShow:function(n,i,r){var u=r;t.Tips.onShow(n,u,i)}},Events:{enable:!0,type:"Native",onClick:function(n,i,r){if(t.Events.enable){var u=i.getContains();t.Events.onClick(u,i,r)}},onMouseMove:function(n,i){if(t.hoveredColor)if(n){var r=i.getContains();f.select(n.id,r.name,r.index)}else f.select(!1,!1,!1)}},onCreateLabel:function(i,r){var s=t.Label,y=r.getData("valueArray"),a=n.reduce(y,function(n,t){return n+t},0),e={wrapper:document.createElement("div"),aggregate:document.createElement("div"),label:document.createElement("div")},o=e.wrapper,h=e.label,v=e.aggregate,f=o.style,c=h.style,l=v.style;u[r.id]=e;o.appendChild(h);o.appendChild(v);t.showLabels(r.name,a,r)||(c.display="none");t.showAggregates(r.name,a,r)||(l.display="none");f.position="relative";f.overflow="visible";f.fontSize=s.size+"px";f.fontFamily=s.family;f.color=s.color;f.textAlign="center";l.position=c.position="absolute";i.style.width=r.getData("width")+"px";i.style.height=r.getData("height")+"px";l.left=c.left="0px";h.innerHTML=r.name;i.appendChild(o)},onPlaceLabel:function(n,i){var a;if(u[i.id]){var o=u[i.id],s=o.wrapper.style,r=o.label.style,f=o.aggregate.style,y=t.type.split(":")[0]=="grouped",p=t.orientation=="horizontal",h=i.getData("dimArray"),v=i.getData("valueArray"),b=y&&p?Math.max.apply(null,h):i.getData("width"),e=y&&!p?Math.max.apply(null,h):i.getData("height"),w=parseInt(s.fontSize,10),d=n.style;if(h&&v){s.width=f.width=r.width=n.style.width=b+"px";for(var c=0,k=v.length,l=0;c<k;c++)h[c]>0&&(l+=v[c]);r.display=t.showLabels(i.name,l,i)?"":"none";a=t.showAggregates(i.name,l,i);f.display=a!==!1?"":"none";t.orientation=="horizontal"?(f.textAlign="right",r.textAlign="left",r.textIndex=f.textIndent=t.labelOffset+"px",f.top=r.top=(e-w)/2+"px",n.style.height=s.height=e+"px"):(f.top=-w-t.labelOffset+"px",r.top=t.labelOffset+e+"px",n.style.top=parseInt(n.style.top,10)-e+"px",n.style.height=s.height=e+"px");o.aggregate.innerHTML=a!==!0?a:l}}}}),o=i.canvas.getSize(),r=t.Margin;e?(i.config.offsetX=o.width/2-r.left-(t.showLabels&&t.labelOffset+t.Label.size),i.config.offsetY=(r.bottom-r.top)/2):(i.config.offsetY=-o.height/2+r.bottom+(t.showLabels&&t.labelOffset+t.Label.size),i.config.offsetX=(r.right-r.left)/2);this.delegate=i;this.canvas=this.delegate.canvas},loadJSON:function(t){var l;if(!this.busy){this.busy=!0;for(var e=n.time(),o=[],i=this.delegate,a=n.splat(t.label),v=n.splat(t.color||this.colors),r=this.config,y=!!r.type.split(":")[1],p=r.animate,w=r.orientation=="horizontal",s=this,u=0,f=t.values,b=f.length;u<b;u++){var h=f[u],c=n.splat(f[u].values);o.push({id:e+h.label,name:h.label,data:{value:c,$valueArray:c,$colorArray:v,$stringArray:a,$gradient:y,$config:r},children:[]})}l={id:e+"$root",name:"",data:{$type:"none",$width:1,$height:1},children:o};i.loadJSON(l);this.normalizeDims();i.compute();i.select(i.root);p?w?i.fx.animate({modes:["node-property:width:dimArray"],duration:1500,onComplete:function(){s.busy=!1}}):i.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){s.busy=!1}}):this.busy=!1}},updateJSON:function(t,i){if(!this.busy){this.busy=!0;this.select(!1,!1,!1);var r=this.delegate,f=r.graph,e=t.values,o=this.config.animate,u=this,s=this.config.orientation=="horizontal";n.each(e,function(i){var r=f.getByName(i.label);r&&(r.setData("valueArray",n.splat(i.values)),t.label&&r.setData("stringArray",n.splat(t.label)))});this.normalizeDims();r.compute();r.select(r.root);o&&(s?r.fx.animate({modes:["node-property:width:dimArray"],duration:1500,onComplete:function(){u.busy=!1;i&&i.onComplete()}}):r.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){u.busy=!1;i&&i.onComplete()}}))}},select:function(n,t){if(this.config.hoveredColor){var i=this.selected;(i.id!=n||i.name!=t)&&(i.id=n,i.name=t,i.color=this.config.hoveredColor,this.delegate.graph.eachNode(function(t){n==t.id?t.setData("border",i):t.setData("border",!1)}),this.delegate.plot())}},getLegend:function(){var r={},t,i,u;return this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(n){t=n.nodeTo}),i=t.getData("colorArray"),u=i.length,n.each(t.getData("stringArray"),function(n,t){r[n]=i[t%u]}),r},getMaxValue:function(){var t=0,i=this.config.type.split(":")[0]=="stacked";return this.delegate.graph.eachNode(function(r){var f=r.getData("valueArray"),u=0;f&&(i?n.each(f,function(n){u+=+n}):u=Math.max.apply(null,f),t=t>u?t:u)}),t},setBarType:function(n){this.config.type=n;this.delegate.config.Node.type="barchart-"+n.split(":")[0]},normalizeDims:function(){var l=this.delegate.graph.getNode(this.delegate.root),e=0;l.eachAdjacency(function(){e++});var r=this.getMaxValue()||1,o=this.delegate.canvas.getSize(),t=this.config,u=t.Margin,s=u.left+u.right,h=u.top+u.bottom,i=t.orientation=="horizontal",a=(o[i?"height":"width"]-(i?h:s)-(e-1)*t.barsOffset)/e,v=t.animate,f=o[i?"width":"height"]-(i?s:h)-(!i&&t.showAggregates&&t.Label.size+t.labelOffset)-(t.showLabels&&t.Label.size+t.labelOffset),y=i?"height":"width",c=i?"width":"height";this.delegate.graph.eachNode(function(t){var i=0,u=[],e;n.each(t.getData("valueArray"),function(n){i+=+n;u.push(0)});t.setData(y,a);v?(t.setData(c,i*f/r,"end"),t.setData("dimArray",n.map(t.getData("valueArray"),function(n){return n*f/r}),"end"),e=t.getData("dimArray"),e||t.setData("dimArray",u)):(t.setData(c,i*f/r),t.setData("dimArray",n.map(t.getData("valueArray"),function(n){return n*f/r})))})}});r.PieChart={$extend:!0,animate:!0,offset:25,sliceOffset:0,labelOffset:3,type:"stacked",hoveredColor:"#9fd4ff",Events:{enable:!1,onClick:n.empty},Tips:{enable:!1,onShow:n.empty,onHide:n.empty},showLabels:!0,resizeLabels:!1,updateHeights:!1};e.Radial=new t({compute:function(t){var i=n.splat(t||["current","start","end"]),r;g.compute(this.graph,i,this.config);this.graph.computeLevels(this.root,0,"ignore");r=this.createLevelDistanceFunc();this.computeAngularWidths(i);this.computePositions(i,r)},computePositions:function(n,t){for(var f,i=n,e=this.graph,r=e.getNode(this.root),o=this.parent,h=this.config,u=0,s=i.length;u<s;u++)f=i[u],r.setPos(y(0,0),f),r.setData("span",Math.PI*2,f);r.angleSpan={begin:0,end:2*Math.PI};e.eachBFS(this.root,function(n){var b=n.angleSpan.end-n.angleSpan.begin,h=n.angleSpan.begin,k=t(n),a=0,u=[],e={},c,v,r,s,p,l,w,f;for(n.eachSubnode(function(n){var r,o,t,f;for(a+=n._treeAngularWidth,r=0,o=i.length;r<o;r++)t=i[r],f=n.getData("dim",t),e[t]=t in e?f>e[t]?f:e[t]:f;u.push(n)},"ignore"),o&&o.id==n.id&&u.length>0&&u[0].dist&&u.sort(function(n,t){return(n.dist>=t.dist)-(n.dist<=t.dist)}),c=0,v=u.length;c<v;c++)if(r=u[c],!r._flag){for(s=r._treeAngularWidth/a*b,p=h+s/2,l=0,w=i.length;l<w;l++)f=i[l],r.setPos(y(p,k),f),r.setData("span",s,f),r.setData("dim-quotient",r.getData("dim",f)/e[f],f);r.angleSpan={begin:h,end:h+s};h+=s}},"ignore")},setAngularWidthForNodes:function(n){this.graph.eachBFS(this.root,function(t,i){var r=t.getData("angularWidth",n[0])||5;t._angularWidth=r/i},"ignore")},setSubtreesAngularWidth:function(){var n=this;this.graph.eachNode(function(t){n.setSubtreeAngularWidth(t)},"ignore")},setSubtreeAngularWidth:function(n){var i=this,r=n._angularWidth,t=0;n.eachSubnode(function(n){i.setSubtreeAngularWidth(n);t+=n._treeAngularWidth},"ignore");n._treeAngularWidth=Math.max(r,t)},computeAngularWidths:function(n){this.setAngularWidthForNodes(n);this.setSubtreesAngularWidth()}});$jit.Sunburst=new t({Implements:[c,s,e.Radial],initialize:function(t){var f=$jit.Sunburst,u;this.controller=this.config=n.merge(r("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),{interpolation:"linear",levelDistance:100,Node:{type:"multipie",height:0},Edge:{type:"none"},Label:{textAlign:"start",textBaseline:"middle"}},t);u=this.config;u.useCanvas?(this.canvas=u.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(u.background&&(u.background=n.merge({type:"Circles"},u.background)),this.canvas=new h(this,u),this.config.labelContainer=(typeof u.injectInto=="string"?u.injectInto:u.injectInto.id)+"-label");this.graphOptions={klass:o,Node:{selected:!1,exist:!0,drawn:!0}};this.graph=new i(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new f.Label[u.Label.type](this);this.fx=new f.Plot(this,f);this.op=new f.Op(this);this.json=null;this.root=null;this.rotated=null;this.busy=!1;this.initializeExtras()},createLevelDistanceFunc:function(){var n=this.config.levelDistance;return function(t){return(t._depth+1)*n}},refresh:function(){this.compute();this.plot()},reposition:function(){this.compute("end")},rotate:function(n,t,i){var r=n.getPos(i.property||"current").getp(!0).theta;this.rotated=n;this.rotateAngle(-r,t,i)},rotateAngle:function(t,i,r){var e=this,u=n.merge(this.config,r||{},{modes:["polar"]}),f=r.property||(i==="animate"?"end":"current");i==="animate"&&this.fx.animation.pause();this.graph.eachNode(function(n){var i=n.getPos(f);i.theta+=t;i.theta<0&&(i.theta+=Math.PI*2)});i=="animate"?this.fx.animate(u):i=="replot"&&(this.fx.plot(),this.busy=!1)},plot:function(){this.fx.plot()}});$jit.Sunburst.$extend=!0,function(r){r.Op=new t({Implements:i.Op});r.Plot=new t({Implements:i.Plot});r.Label={};r.Label.Native=new t({Implements:i.Label.Native,initialize:function(n){this.viz=n;this.label=n.config.Label;this.config=n.config},renderLabel:function(n,t,i){var h=t.getData("span"),r,f;if(!(h<Math.PI/2)||!(Math.tan(h)*this.config.levelDistance*t._depth<10)){if(r=n.getCtx(),f=r.measureText(t.name),t.id==this.viz.root)var e=-f.width/2,c=0,y=0,p=0;else{var l=5,p=i.levelDistance-l,o=t.pos.clone();o.rho+=l;var u=o.getp(!0),a=o.getc(!0),e=a.x,c=a.y,s=Math.PI,v=u.theta>s/2&&u.theta<3*s/2,y=v?u.theta+s:u.theta;v?(e-=Math.abs(Math.cos(u.theta)*f.width),c+=Math.sin(u.theta)*f.width):t.id==this.viz.root&&(e-=f.width/2)}r.save();r.translate(e,c);r.rotate(y);r.fillText(t.name,0,0);r.restore()}}});r.Label.SVG=new t({Implements:i.Label.SVG,initialize:function(n){this.viz=n},placeLabel:function(n,t,i){var o=t.pos.getc(!0),v=this.viz,y=this.viz.canvas,s=y.getSize(),h={x:Math.round(o.x+s.width/2),y:Math.round(o.y+s.height/2)},r,a;if(n.setAttribute("x",h.x),n.setAttribute("y",h.y),r=n.getBBox(),r){var e=n.getAttribute("x"),c=n.getAttribute("y"),u=t.pos.getp(!0),f=Math.PI,l=u.theta>f/2&&u.theta<3*f/2;l?(n.setAttribute("x",e-r.width),n.setAttribute("y",c-r.height)):t.id==v.root&&n.setAttribute("x",e-r.width/2);a=l?u.theta+f:u.theta;t._depth&&n.setAttribute("transform","rotate("+a*360/(2*f)+" "+e+" "+c+")")}i.onPlaceLabel(n,t)}});r.Label.HTML=new t({Implements:i.Label.HTML,initialize:function(n){this.viz=n},placeLabel:function(n,t,i){var r=t.pos.clone(),e=this.viz.canvas,o=t.getData("height"),h=(o||t._depth==0?o:this.viz.config.levelDistance)/2,s=e.getSize(),u,f;r.rho+=h;r=r.getc(!0);u={x:Math.round(r.x+s.width/2),y:Math.round(r.y+s.height/2)};f=n.style;f.left=u.x+"px";f.top=u.y+"px";f.display=this.fitsInCanvas(u,e)?"":"none";i.onPlaceLabel(n,t)}});r.Plot.NodeTypes=new t({none:{render:n.empty,contains:n.lambda(!1),anglecontains:function(n,t){var f=n.getData("span")/2,e=n.pos.theta,r=e-f,u=e+f,i;return r<0&&(r+=Math.PI*2),i=Math.atan2(t.y,t.x),i<0&&(i+=Math.PI*2),r>u?i>r&&i<=Math.PI*2||i<u:i>r&&i<u}},pie:{render:function(n,t){var f=n.getData("span")/2,e=n.pos.theta,s=e-f,h=e+f,c=n.pos.getp(!0),r=new o(c.rho,s),l=r.getc(!0),u,i;r.theta=h;u=r.getc(!0);i=t.getCtx();i.beginPath();i.moveTo(0,0);i.lineTo(l.x,l.y);i.moveTo(0,0);i.lineTo(u.x,u.y);i.moveTo(0,0);i.arc(0,0,c.rho*n.getData("dim-quotient"),s,h,!1);i.fill()},contains:function(n,t){if(this.nodeTypes.none.anglecontains.call(this,n,t)){var i=Math.sqrt(t.x*t.x+t.y*t.y),r=this.config.levelDistance,u=n._depth;return i<=r*u}return!1}},multipie:{render:function(n,t){var a=n.getData("height"),s=a?a:this.config.levelDistance,v=n.getData("span")/2,y=n.pos.theta,u=y-v,f=y+v,e=n.pos.getp(!0),r=new o(e.rho,u),p=r.getc(!0),h,c,l,i;r.theta=f;h=r.getc(!0);r.rho+=s;c=r.getc(!0);r.theta=u;l=r.getc(!0);i=t.getCtx();i.moveTo(0,0);i.beginPath();i.arc(0,0,e.rho,u,f,!1);i.arc(0,0,e.rho+s,f,u,!0);i.moveTo(p.x,p.y);i.lineTo(l.x,l.y);i.moveTo(h.x,h.y);i.lineTo(c.x,c.y);i.fill();n.collapsed&&(i.save(),i.lineWidth=2,i.moveTo(0,0),i.beginPath(),i.arc(0,0,e.rho+s+5,f-.01,u+.01,!0),i.stroke(),i.restore())},contains:function(n,t){if(this.nodeTypes.none.anglecontains.call(this,n,t)){var i=Math.sqrt(t.x*t.x+t.y*t.y),r=n.getData("height"),e=r?r:this.config.levelDistance,u=this.config.levelDistance,f=n._depth;return i>=u*f&&i<=u*f+e}return!1}},"gradient-multipie":{render:function(t,i){var u=i.getCtx(),f=t.getData("height"),s=f?f:this.config.levelDistance,r=u.createRadialGradient(0,0,t.getPos().rho,0,0,t.getPos().rho+s),h=n.hexToRgb(t.getData("color")),e=[],o;n.each(h,function(n){e.push(parseInt(n*.5,10))});o=n.rgbToHex(e);r.addColorStop(0,o);r.addColorStop(1,t.getData("color"));u.fillStyle=r;this.nodeTypes.multipie.render.call(this,t,i)},contains:function(n,t){return this.nodeTypes.multipie.contains.call(this,n,t)}},"gradient-pie":{render:function(t,i){var u=i.getCtx(),r=u.createRadialGradient(0,0,0,0,0,t.getPos().rho),o=n.hexToRgb(t.getData("color")),f=[],e;n.each(o,function(n){f.push(parseInt(n*.5,10))});e=n.rgbToHex(f);r.addColorStop(1,e);r.addColorStop(0,t.getData("color"));u.fillStyle=r;this.nodeTypes.pie.render.call(this,t,i)},contains:function(n,t){return this.nodeTypes.pie.contains.call(this,n,t)}}});r.Plot.EdgeTypes=new t({none:n.empty,line:{render:function(n,t){var i=n.nodeFrom.pos.getc(!0),r=n.nodeTo.pos.getc(!0);this.edgeHelper.line.render(i,r,t)},contains:function(n,t){var i=n.nodeFrom.pos.getc(!0),r=n.nodeTo.pos.getc(!0);return this.edgeHelper.line.contains(i,r,t,this.edge.epsilon)}},arrow:{render:function(n,t){var r=n.nodeFrom.pos.getc(!0),u=n.nodeTo.pos.getc(!0),f=n.getData("dim"),i=n.data.$direction,e=i&&i.length>1&&i[0]!=n.nodeFrom.id;this.edgeHelper.arrow.render(r,u,f,e,t)},contains:function(n,t){var i=n.nodeFrom.pos.getc(!0),r=n.nodeTo.pos.getc(!0);return this.edgeHelper.arrow.contains(i,r,t,this.edge.epsilon)}},hyperline:{render:function(n,t){var r=n.nodeFrom.pos.getc(),u=n.nodeTo.pos.getc(),i=Math.max(r.norm(),u.norm());this.edgeHelper.hyperline.render(r.$scale(1/i),u.$scale(1/i),i,t)},contains:n.lambda(!1)}})}($jit.Sunburst);$jit.Sunburst.Plot.NodeTypes.implement({"piechart-stacked":{render:function(t,i){var ni=t.pos.getp(!0),k=t.getData("dimArray"),ot=t.getData("valueArray"),nt=t.getData("colorArray"),st=nt.length,rt=t.getData("stringArray"),ut=t.getData("span")/2,ft=t.pos.theta,s=ft-ut,c=ft+ut,u=new o,r=i.getCtx(),f={},ht=t.getData("gradient"),d=t.getData("border"),e=t.getData("config"),ct=e.showLabels,tt=e.resizeLabels,p=e.Label,v=e.sliceOffset*Math.cos((s+c)/2),y=e.sliceOffset*Math.sin((s+c)/2),a,w,wt,bt,kt,dt,gt,et,b,it;if(nt&&k&&rt){for(var l=0,lt=k.length,h=0,at=0;l<lt;l++)if(a=k[l],w=nt[l%st],!(a<=0)){if(r.fillStyle=r.strokeStyle=w,ht&&a){var g=r.createRadialGradient(v,y,h+e.sliceOffset,v,y,h+a+e.sliceOffset),vt=n.hexToRgb(w),yt=n.map(vt,function(n){return n*.8>>0}),pt=n.rgbToHex(yt);g.addColorStop(0,w);g.addColorStop(.5,w);g.addColorStop(1,pt);r.fillStyle=g}u.rho=h+e.sliceOffset;u.theta=s;wt=u.getc(!0);u.theta=c;bt=u.getc(!0);u.rho+=a;kt=u.getc(!0);u.theta=s;dt=u.getc(!0);r.beginPath();r.arc(v,y,h+.01,s,c,!1);r.arc(v,y,h+a+.01,c,s,!0);r.fill();d&&d.name==rt[l]&&(f.acum=h,f.dimValue=k[l],f.begin=s,f.end=c);h+=a||0;at+=ot[l]||0}d&&(r.save(),r.globalCompositeOperation="source-over",r.lineWidth=2,r.strokeStyle=d.color,gt=s<c?1:-1,r.beginPath(),r.arc(v,y,f.acum+.01+1,f.begin,f.end,!1),r.arc(v,y,f.acum+f.dimValue+.01-1,f.end,f.begin,!0),r.closePath(),r.stroke(),r.restore());ct&&p.type=="Native"&&(r.save(),r.fillStyle=r.strokeStyle=p.color,et=tt?t.getData("normalizedDim"):1,b=p.size*et>>0,b=b<+tt?+tt:b,r.font=p.style+" "+b+"px "+p.family,r.textBaseline="middle",r.textAlign="center",u.rho=h+e.labelOffset+e.sliceOffset,u.theta=t.pos.theta,it=u.getc(!0),r.fillText(t.name,it.x,it.y),r.restore())}},contains:function(n,t){var u,e;if(this.nodeTypes.none.anglecontains.call(this,n,t)){var r=Math.sqrt(t.x*t.x+t.y*t.y),s=this.config.levelDistance,h=n._depth,o=n.getData("config");if(r<=s*h+o.sliceOffset){u=n.getData("dimArray");for(var i=0,c=u.length,f=o.sliceOffset;i<c;i++){if(e=u[i],r>=f&&r<=f+e)return{name:n.getData("stringArray")[i],color:n.getData("colorArray")[i],value:n.getData("valueArray")[i],label:n.name};f+=e}}return!1}return!1}}});$jit.PieChart=new t({sb:null,colors:["#416D9C","#70A35E","#EBB056","#C74243","#83548B","#909291","#557EAA"],selected:{},busy:!1,initialize:function(t){this.controller=this.config=n.merge(r("Canvas","PieChart","Label"),{Label:{type:"Native"}},t);this.initializeViz()},initializeViz:function(){var n=this.config,t=this,u=n.type.split(":")[0],i=new $jit.Sunburst({injectInto:n.injectInto,width:n.width,height:n.height,useCanvas:n.useCanvas,withLabels:n.Label.type!="Native",Label:{type:n.Label.type},Node:{overridable:!0,type:"piechart-"+u,width:1,height:1},Edge:{type:"none"},Tips:{enable:n.Tips.enable,type:"Native",force:!0,onShow:function(t,i,r){var u=r;n.Tips.onShow(t,u,i)}},Events:{enable:!0,type:"Native",onClick:function(t,i,r){if(n.Events.enable){var u=i.getContains();n.Events.onClick(u,i,r)}},onMouseMove:function(i,r){if(n.hoveredColor)if(i){var u=r.getContains();t.select(i.id,u.name,u.index)}else t.select(!1,!1,!1)}},onCreateLabel:function(t,i){var u=n.Label,r;n.showLabels&&(r=t.style,r.fontSize=u.size+"px",r.fontFamily=u.family,r.color=u.color,r.textAlign="center",t.innerHTML=i.name)},onPlaceLabel:function(i,r){var y,u;if(n.showLabels){var c=r.pos.getp(!0),f=r.getData("dimArray"),l=r.getData("span")/2,a=r.pos.theta,b=a-l,k=a+l,e=new o,nt=n.showLabels,s=n.resizeLabels,d=n.Label;if(f){for(var h=0,g=f.length,v=0;h<g;h++)v+=f[h];y=s?r.getData("normalizedDim"):1;u=d.size*y>>0;u=u<+s?+s:u;i.style.fontSize=u+"px";e.rho=v+n.labelOffset+n.sliceOffset;e.theta=(b+k)/2;var c=e.getc(!0),p=t.canvas.getSize(),w={x:Math.round(c.x+p.width/2),y:Math.round(c.y+p.height/2)};i.style.left=w.x+"px";i.style.top=w.y+"px"}}}}),r=i.canvas.getSize(),f=Math.min;i.config.levelDistance=f(r.width,r.height)/2-n.offset-n.sliceOffset;this.delegate=i;this.canvas=this.delegate.canvas;this.canvas.getCtx().globalCompositeOperation="lighter"},loadJSON:function(t){for(var r,u,a,s=n.time(),h=[],f=this.delegate,c=n.splat(t.label),v=c.length,e=n.splat(t.color||this.colors),y=e.length,o=this.config,p=!!o.type.split(":")[1],w=o.animate,b=v==1,i=0,l=t.values,k=l.length;i<k;i++)r=l[i],u=n.splat(r.values),h.push({id:s+r.label,name:r.label,data:{value:u,$valueArray:u,$colorArray:b?n.splat(e[i%y]):e,$stringArray:c,$gradient:p,$config:o,$angularWidth:n.reduce(u,function(n,t){return n+t})},children:[]});a={id:s+"$root",name:"",data:{$type:"none",$width:1,$height:1},children:h};f.loadJSON(a);this.normalizeDims();f.refresh();w&&f.fx.animate({modes:["node-property:dimArray"],duration:1500})},updateJSON:function(t,i){if(!this.busy){this.busy=!0;var r=this.delegate,u=r.graph,f=t.values,e=this.config.animate,o=this;n.each(f,function(i){var r=u.getByName(i.label),f=n.splat(i.values);r&&(r.setData("valueArray",f),r.setData("angularWidth",n.reduce(f,function(n,t){return n+t})),t.label&&r.setData("stringArray",n.splat(t.label)))});this.normalizeDims();e?(r.compute("end"),r.fx.animate({modes:["node-property:dimArray:span","linear"],duration:1500,onComplete:function(){o.busy=!1;i&&i.onComplete()}})):r.refresh()}},select:function(n,t){if(this.config.hoveredColor){var i=this.selected;(i.id!=n||i.name!=t)&&(i.id=n,i.name=t,i.color=this.config.hoveredColor,this.delegate.graph.eachNode(function(t){n==t.id?t.setData("border",i):t.setData("border",!1)}),this.delegate.plot())}},getLegend:function(){var r={},t,i,u;return this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(n){t=n.nodeTo}),i=t.getData("colorArray"),u=i.length,n.each(t.getData("stringArray"),function(n,t){r[n]=i[t%u]}),r},getMaxValue:function(){var t=0;return this.delegate.graph.eachNode(function(i){var u=i.getData("valueArray"),r=0;n.each(u,function(n){r+=+n});t=t>r?t:r}),t},normalizeDims:function(){var u=this.delegate.graph.getNode(this.delegate.root),f=0;u.eachAdjacency(function(){f++});var i=this.getMaxValue()||1,r=this.config,e=r.animate,t=this.delegate.config.levelDistance;this.delegate.graph.eachNode(function(u){var s=0,f=[],o,h;n.each(u.getData("valueArray"),function(n){s+=+n;f.push(1)});o=f.length==1&&!r.updateHeights;e?(u.setData("dimArray",n.map(u.getData("valueArray"),function(n){return o?t:n*t/i}),"end"),h=u.getData("dimArray"),h||u.setData("dimArray",f)):u.setData("dimArray",n.map(u.getData("valueArray"),function(n){return o?t:n*t/i}));u.setData("normalizedDim",s/i)})}});e.TM={};e.TM.SliceAndDice=new t({compute:function(n){var t=this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root);this.controller.onBeforeCompute(t);var i=this.canvas.getSize(),f=this.config,r=i.width,u=i.height;this.graph.computeLevels(this.root,0,"ignore");t.getPos(n).setc(-r/2,-u/2);t.setData("width",r,n);t.setData("height",u+f.titleHeight,n);this.computePositions(t,t,this.layout.orientation,n);this.controller.onAfterCompute(t)},computePositions:function(n,t,i,r){var y=0,a,v,k;n.eachSubnode(function(n){y+=n.getData("area",r)});var u=this.config,g=u.offset,p=n.getData("width",r),w=Math.max(n.getData("height",r)-u.titleHeight,0),b=n==t?1:t.getData("area",r)/y,o,s,h,f,e,c,l,d=i=="h";d?(i="v",o=w,s=p*b,h="height",f="y",e="x",c=u.titleHeight,l=0):(i="h",o=w*b,s=p,h="width",f="x",e="y",c=0,l=u.titleHeight);a=t.getPos(r);t.setData("width",s,r);t.setData("height",o,r);v=0;k=this;t.eachSubnode(function(n){var u=n.getPos(r);u[f]=v+a[f]+c;u[e]=a[e]+l;k.computePositions(t,n,i,r);v+=n.getData(h,r)})}});e.TM.Area={compute:function(n){var t,o;n=n||"current";t=this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root);this.controller.onBeforeCompute(t);var u=this.config,f=this.canvas.getSize(),i=f.width,r=f.height,e=u.offset,s=i-e,h=r-e;this.graph.computeLevels(this.root,0,"ignore");t.getPos(n).setc(-i/2,-r/2);t.setData("width",i,n);t.setData("height",r,n);o={top:-r/2+u.titleHeight,left:-i/2,width:s,height:h-u.titleHeight};this.computePositions(t,o,n);this.controller.onAfterCompute(t)},computeDim:function(n,t,i,r,u,f){var s,e,o;if(n.length+t.length==1){s=n.length==1?n:t;this.layoutLast(s,i,r,f);return}if(n.length>=2&&t.length==0&&(t=[n.shift()]),n.length==0){t.length>0&&this.layoutRow(t,i,r,f);return}e=n[0];u(t,i)>=u([e].concat(t),i)?this.computeDim(n.slice(1),t.concat([e]),i,r,u,f):(o=this.layoutRow(t,i,r,f),this.computeDim(n,[],o.dim,o,u,f))},worstAspectRatio:function(n,t){var f,h,i,o,s;if(!n||n.length==0)return Number.MAX_VALUE;var e=0,r=0,u=Number.MAX_VALUE;for(f=0,h=n.length;f<h;f++)i=n[f]._area,e+=i,u=u<i?u:i,r=r>i?r:i;return o=t*t,s=e*e,Math.max(o*r/s,s/(o*u))},avgAspectRatio:function(n,t){var u,i,f,e,r;if(!n||n.length==0)return Number.MAX_VALUE;for(u=0,i=0,f=n.length;i<f;i++)e=n[i]._area,r=e/t,u+=t>r?t/r:r/t;return u/f},layoutLast:function(n,t,i,r){var u=n[0];u.getPos(r).setc(i.left,i.top);u.setData("width",i.width,r);u.setData("height",i.height,r)}};e.TM.Squarified=new t({Implements:e.TM.Area,computePositions:function(n,t,i){var e=this.config,o=Math.max,r,u,s;if(this.layout.orientation=t.width>=t.height?"h":"v",r=n.getSubnodes([1,1],"ignore"),r.length>0)for(this.processChildrenLayout(n,r,t,i),u=0,s=r.length;u<s;u++){var f=r[u],h=e.offset,l=o(f.getData("height",i)-h-e.titleHeight,0),a=o(f.getData("width",i)-h,0),c=f.getPos(i);t={width:a,height:l,top:c.y+e.titleHeight,left:c.x};this.computePositions(f,t,i)}},processChildrenLayout:function(n,t,i,r){for(var l=i.width*i.height,e=t.length,o=0,f=[],s,h,c,u=0;u<e;u++)f[u]=parseFloat(t[u].getData("area",r)),o+=f[u];for(u=0;u<e;u++)t[u]._area=l*f[u]/o;s=this.layout.horizontal()?i.height:i.width;t.sort(function(n,t){var i=t._area-n._area;return i?i:t.id==n.id?0:t.id<n.id?1:-1});h=[t[0]];c=t.slice(1);this.squarify(c,h,s,i,r)},squarify:function(n,t,i,r,u){this.computeDim(n,t,i,r,this.worstAspectRatio,u)},layoutRow:function(n,t,i,r){return this.layout.horizontal()?this.layoutV(n,t,i,r):this.layoutH(n,t,i,r)},layoutV:function(t,i,r,u){var l=0,a=function(n){return n},e,h,o,v,c,s,f;for(n.each(t,function(n){l+=n._area}),e=a(l/i),h=0,o=0,v=t.length;o<v;o++)c=a(t[o]._area/e),s=t[o],s.getPos(u).setc(r.left,r.top+h),s.setData("width",e,u),s.setData("height",c,u),h+=c;return f={height:r.height,width:r.width-e,top:r.top,left:r.left+e},f.dim=Math.min(f.width,f.height),f.dim!=f.height&&this.layout.change(),f},layoutH:function(t,i,r,u){var h=0,s,l,e,i,f;n.each(t,function(n){h+=n._area});var o=h/i,a=r.top,c=0;for(s=0,l=t.length;s<l;s++)e=t[s],i=e._area/o,e.getPos(u).setc(r.left+c,a),e.setData("width",i,u),e.setData("height",o,u),c+=i;return f={height:r.height-o,width:r.width,top:r.top+o,left:r.left},f.dim=Math.min(f.width,f.height),f.dim!=f.width&&this.layout.change(),f}});e.TM.Strip=new t({Implements:e.TM.Area,computePositions:function(n,t,i){var r=n.getSubnodes([1,1],"ignore"),e=this.config,o=Math.max,u,s;if(r.length>0)for(this.processChildrenLayout(n,r,t,i),u=0,s=r.length;u<s;u++){var f=r[u],h=e.offset,l=o(f.getData("height",i)-h-e.titleHeight,0),a=o(f.getData("width",i)-h,0),c=f.getPos(i);t={width:a,height:l,top:c.y+e.titleHeight,left:c.x};this.computePositions(f,t,i)}},processChildrenLayout:function(n,t,i,r){for(var s=i.width*i.height,e=t.length,o=0,f=[],u=0;u<e;u++)f[u]=+t[u].getData("area",r),o+=f[u];for(u=0;u<e;u++)t[u]._area=s*f[u]/o;var h=this.layout.horizontal()?i.width:i.height,c=[t[0]],l=t.slice(1);this.stripify(l,c,h,i,r)},stripify:function(n,t,i,r,u){this.computeDim(n,t,i,r,this.avgAspectRatio,u)},layoutRow:function(n,t,i,r){return this.layout.horizontal()?this.layoutH(n,t,i,r):this.layoutV(n,t,i,r)},layoutV:function(t,i,r,u){var c=0,f,h,o,l,e,s;for(n.each(t,function(n){c+=n._area}),f=c/i,h=0,o=0,l=t.length;o<l;o++)e=t[o],s=e._area/f,e.getPos(u).setc(r.left,r.top+(i-s-h)),e.setData("width",f,u),e.setData("height",s,u),h+=s;return{height:r.height,width:r.width-f,top:r.top,left:r.left+f,dim:i}},layoutH:function(t,i,r,u){var h=0,o,l,f,s;n.each(t,function(n){h+=n._area});var e=h/i,a=r.height-e,c=0;for(o=0,l=t.length;o<l;o++)f=t[o],s=f._area/e,f.getPos(u).setc(r.left+c,r.top+a),f.setData("width",s,u),f.setData("height",e,u),c+=s;return{height:r.height-e,width:r.width,top:r.top,left:r.left,dim:i}}});e.Icicle=new t({compute:function(n){var f;n=n||"current";var t=this.graph.getNode(this.root),o=this.config,h=this.canvas.getSize(),r=h.width,u=h.height,a=o.offset,l=o.constrained?o.levelsToShow:Number.MAX_VALUE;this.controller.onBeforeCompute(t);i.Util.computeLevels(this.graph,t.id,0,"ignore");f=0;i.Util.eachLevel(t,0,!1,function(n,t){t>f&&(f=t)});var s=this.graph.getNode(this.clickedNode&&this.clickedNode.id||t.id),e=Math.min(f,l-1),c=s._depth;this.layout.horizontal()?this.computeSubtree(s,-r/2,-u/2,r/(e+1),u,c,e,n):this.computeSubtree(s,-r/2,-u/2,r,u/(e+1),c,e,n)},computeSubtree:function(t,r,u,f,e,o,s,h){var l,y;t.getPos(h).setc(r,u);t.setData("width",f,h);t.setData("height",e,h);var a,v=0,c=i.Util.getSubnodes(t,[1,1],"ignore");if(c.length)for(n.each(c,function(n){v+=n.getData("dim")}),l=0,y=c.length;l<y;l++)this.layout.horizontal()?(a=e*c[l].getData("dim")/v,this.computeSubtree(c[l],r+f,u,f,a,o,s,h),u+=a):(a=f*c[l].getData("dim")/v,this.computeSubtree(c[l],r,u+e,a,e,o,s,h),r+=a)}});$jit.Icicle=new t({Implements:[c,s,e.Icicle],layout:{orientation:"h",vertical:function(){return this.orientation=="v"},horizontal:function(){return this.orientation=="h"},change:function(){this.orientation=this.vertical()?"h":"v"}},initialize:function(t){var e={animate:!1,orientation:"h",offset:2,levelsToShow:Number.MAX_VALUE,constrained:!1,Node:{type:"rectangle",overridable:!0},Edge:{type:"none"},Label:{type:"Native"},duration:700,fps:45},o=r("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),u;this.controller=this.config=n.merge(o,e,t);this.layout.orientation=this.config.orientation;u=this.config;u.useCanvas?(this.canvas=u.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(this.canvas=new h(this,u),this.config.labelContainer=(typeof u.injectInto=="string"?u.injectInto:u.injectInto.id)+"-label");this.graphOptions={klass:f,Node:{selected:!1,exist:!0,drawn:!0}};this.graph=new i(this.graphOptions,this.config.Node,this.config.Edge,this.config.Label);this.labels=new $jit.Icicle.Label[this.config.Label.type](this);this.fx=new $jit.Icicle.Plot(this,$jit.Icicle);this.op=new $jit.Icicle.Op(this);this.group=new $jit.Icicle.Group(this);this.clickedNode=null;this.initializeExtras()},refresh:function(){var t=this.config.Label.type,n;t!="Native"&&(n=this,this.graph.eachNode(function(t){n.labels.hideLabel(t,!1)}));this.compute();this.plot()},plot:function(){this.fx.plot(this.config)},enter:function(n){if(!this.busy){this.busy=!0;var t=this,r=this.config,u={onComplete:function(){r.request&&t.compute();r.animate?(t.graph.nodeList.setDataset(["current","end"],{alpha:[1,0]}),i.Util.eachSubgraph(n,function(n){n.setData("alpha",1,"end")},"ignore"),t.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){t.clickedNode=n;t.compute("end");t.fx.animate({modes:["linear","node-property:width:height"],duration:1e3,onComplete:function(){t.busy=!1;t.clickedNode=n}})}})):(t.clickedNode=n,t.busy=!1,t.refresh())}};r.request?this.requestNodes(clickedNode,u):u.onComplete()}},out:function(){if(!this.busy){var n=this,r=i.Util,u=this.config,f=this.graph,s=r.getParents(f.getNode(this.clickedNode&&this.clickedNode.id||this.root)),t=s[0],e=t,o=this.clickedNode;if(this.busy=!0,this.events.hoveredNode=!1,!t){this.busy=!1;return}callback={onComplete:function(){n.clickedNode=t;u.request?n.requestNodes(t,{onComplete:function(){n.compute();n.plot();n.busy=!1}}):(n.compute(),n.plot(),n.busy=!1)}};u.animate?(this.clickedNode=e,this.compute("end"),this.clickedNode=o,this.fx.animate({modes:["linear","node-property:width:height"],duration:1e3,onComplete:function(){n.clickedNode=e;f.nodeList.setDataset(["current","end"],{alpha:[0,1]});r.eachSubgraph(o,function(n){n.setData("alpha",1)},"ignore");n.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){callback.onComplete()}})}})):callback.onComplete()}},requestNodes:function(t,r){var u=n.merge(this.controller,r),e=this.config.constrained?this.config.levelsToShow:Number.MAX_VALUE,f,o;u.request?(f=[],o=t._depth,i.Util.eachLevel(t,0,e,function(n){n.drawn&&!i.Util.anySubnode(n)&&(f.push(n),n._level=n._depth-o,this.config.constrained&&(n._level=e-n._level))}),this.group.requestNodes(f,u)):u.onComplete()}});$jit.Icicle.Op=new t({Implements:i.Op});$jit.Icicle.Group=new t({initialize:function(n){this.viz=n;this.canvas=n.canvas;this.config=n.config},requestNodes:function(n,t){var o=0,u=n.length,s={},e=function(){t.onComplete()},f=this.viz,r;for(u==0&&e(),r=0;r<u;r++)s[n[r].id]=n[r],t.request(n[r].id,n[r]._level,{onComplete:function(n,t){t&&t.children&&(t.id=n,f.op.sum(t,{type:"nothing"}));++o==u&&(i.Util.computeLevels(f.graph,f.root,0),e())}})}});$jit.Icicle.Plot=new t({Implements:i.Plot,plot:function(t,i){t=t||this.viz.controller;var r=this.viz,f=r.graph,u=f.getNode(r.clickedNode&&r.clickedNode.id||r.root),e=u._depth;r.canvas.clear();this.plotTree(u,n.merge(t,{withLabels:!0,hideLabels:!1,plotSubtree:function(n,t){return!r.config.constrained||t._depth-e<r.config.levelsToShow}}),i)}});$jit.Icicle.Label={};$jit.Icicle.Label.Native=new t({Implements:i.Label.Native,renderLabel:function(n,t){var r=n.getCtx(),u=t.getData("width"),f=t.getData("height"),e=t.getLabelData("size"),o=r.measureText(t.name),i;f<e*1.5||u<o.width||(i=t.pos.getc(!0),r.fillText(t.name,i.x+u/2,i.y+f/2))}});$jit.Icicle.Label.SVG=new t({Implements:i.Label.SVG,initialize:function(n){this.viz=n},placeLabel:function(n,t,i){var r=t.pos.getc(!0),e=this.viz.canvas,u=e.getSize(),f={x:Math.round(r.x+u.width/2),y:Math.round(r.y+u.height/2)};n.setAttribute("x",f.x);n.setAttribute("y",f.y);i.onPlaceLabel(n,t)}});$jit.Icicle.Label.HTML=new t({Implements:i.Label.HTML,initialize:function(n){this.viz=n},placeLabel:function(n,t,i){var u=t.pos.getc(!0),o=this.viz.canvas,f=o.getSize(),e={x:Math.round(u.x+f.width/2),y:Math.round(u.y+f.height/2)},r=n.style;r.left=e.x+"px";r.top=e.y+"px";r.display="";i.onPlaceLabel(n,t)}});$jit.Icicle.Plot.NodeTypes=new t({none:{render:n.empty},rectangle:{render:function(t,i){var a=this.viz.config,r=a.offset,u=t.getData("width"),f=t.getData("height"),s=t.getData("border"),o=t.pos.getc(!0),h=o.x+r/2,c=o.y+r/2,e=i.getCtx();if(!(u-r<2)&&!(f-r<2)){if(a.cushion){var v=t.getData("color"),l=e.createRadialGradient(h+(u-r)/2,c+(f-r)/2,1,h+(u-r)/2,c+(f-r)/2,u<f?f:u),y=n.rgbToHex(n.map(n.hexToRgb(v),function(n){return n*.3>>0}));l.addColorStop(0,v);l.addColorStop(1,y);e.fillStyle=l}s&&(e.strokeStyle=s,e.lineWidth=3);e.fillRect(h,c,Math.max(0,u-r),Math.max(0,f-r));s&&e.strokeRect(o.x,o.y,u,f)}},contains:function(n,t){if(this.viz.clickedNode&&!$jit.Graph.Util.isDescendantOf(n,this.viz.clickedNode.id))return!1;var i=n.pos.getc(!0),r=n.getData("width"),u=n.getData("height");return this.nodeHelper.rectangle.contains({x:i.x+r/2,y:i.y+u/2},t,r,u)}}});$jit.Icicle.Plot.EdgeTypes=new t({none:n.empty});e.ForceDirected=new t({getOptions:function(){var t=this.canvas.getSize(),n=t.width,i=t.height,r=0;this.graph.eachNode(function(){r++});var u=n*i/r,f=Math.sqrt(u),e=this.config.levelDistance;return{width:n,height:i,tstart:n*.1,nodef:function(n){return u/(n||1)},edgef:function(n){return f*(n-e)}}},compute:function(t,i){var r=n.splat(t||["current","start","end"]),u=this.getOptions();g.compute(this.graph,r,this.config);this.graph.computeLevels(this.root,0,"ignore");this.graph.eachNode(function(t){n.each(r,function(i){var e=t.getPos(i);e.equals(f.KER)&&(e.x=u.width/5*(Math.random()-.5),e.y=u.height/5*(Math.random()-.5));t.disp={};n.each(r,function(n){t.disp[n]=a(0,0)})})});this.computePositions(r,u,i)},computePositions:function(n,t,i){var r=this.config.iterations,u=0,f=this;if(i)(function e(){for(var s=i.iter,o=0;o<s;o++)if(t.t=t.tstart,r&&(t.t*=1-u++/(r-1)),f.computePositionStep(n,t),r&&u>=r){i.onComplete();return}i.onStep(Math.round(u/(r-1)*100));setTimeout(e,1)})();else for(;u<r;u++)t.t=t.tstart*(1-u/(r-1)),this.computePositionStep(n,t)},computePositionStep:function(t,i){var u=this.graph,f=Math.min,o=Math.max,r=a(0,0),e;u.eachNode(function(f){n.each(t,function(n){f.disp[n].x=0;f.disp[n].y=0});u.eachNode(function(u){u.id!=f.id&&n.each(t,function(n){var e=f.getPos(n),o=u.getPos(n),t;r.x=e.x-o.x;r.y=e.y-o.y;t=r.norm()||1;f.disp[n].$add(r.$scale(i.nodef(t)/t))})})});e=!!u.getNode(this.root).visited;u.eachNode(function(u){u.eachAdjacency(function(f){var o=f.nodeTo;!!o.visited===e&&n.each(t,function(n){var f=u.getPos(n),e=o.getPos(n),t;r.x=f.x-e.x;r.y=f.y-e.y;t=r.norm()||1;u.disp[n].$add(r.$scale(-i.edgef(t)/t));o.disp[n].$add(r.$scale(-1))})});u.visited=!e});var s=i.t,h=i.width/2,c=i.height/2;u.eachNode(function(i){n.each(t,function(n){var t=i.disp[n],r=t.norm()||1,n=i.getPos(n);n.$add(a(t.x*f(Math.abs(t.x),s)/r,t.y*f(Math.abs(t.y),s)/r));n.x=f(h,o(-h,n.x));n.y=f(c,o(-c,n.y))})})}});$jit.ForceDirected=new t({Implements:[c,s,e.ForceDirected],initialize:function(t){var e=$jit.ForceDirected,u;this.controller=this.config=n.merge(r("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),{iterations:50,levelDistance:50},t);u=this.config;u.useCanvas?(this.canvas=u.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(u.background&&(u.background=n.merge({type:"Circles"},u.background)),this.canvas=new h(this,u),this.config.labelContainer=(typeof u.injectInto=="string"?u.injectInto:u.injectInto.id)+"-label");this.graphOptions={klass:f,Node:{selected:!1,exist:!0,drawn:!0}};this.graph=new i(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new e.Label[u.Label.type](this);this.fx=new e.Plot(this,e);this.op=new e.Op(this);this.json=null;this.busy=!1;this.initializeExtras()},refresh:function(){this.compute();this.plot()},reposition:function(){this.compute("end")},computeIncremental:function(t){t=n.merge({iter:20,property:"end",onStep:n.empty,onComplete:n.empty},t||{});this.config.onBeforeCompute(this.graph.getNode(this.root));this.compute(t.property,t)},plot:function(){this.fx.plot()},animate:function(t){this.fx.animate(n.merge({modes:["linear"]},t||{}))}});$jit.ForceDirected.$extend=!0,function(r){r.Op=new t({Implements:i.Op});r.Plot=new t({Implements:i.Plot});r.Label={};r.Label.Native=new t({Implements:i.Label.Native});r.Label.SVG=new t({Implements:i.Label.SVG,initialize:function(n){this.viz=n},placeLabel:function(n,t,i){var u=t.pos.getc(!0),r=this.viz.canvas,o=r.translateOffsetX,s=r.translateOffsetY,h=r.scaleOffsetX,c=r.scaleOffsetY,f=r.getSize(),e={x:Math.round(u.x*h+o+f.width/2),y:Math.round(u.y*c+s+f.height/2)};n.setAttribute("x",e.x);n.setAttribute("y",e.y);i.onPlaceLabel(n,t)}});r.Label.HTML=new t({Implements:i.Label.HTML,initialize:function(n){this.viz=n},placeLabel:function(n,t,i){var e=t.pos.getc(!0),r=this.viz.canvas,s=r.translateOffsetX,h=r.translateOffsetY,c=r.scaleOffsetX,l=r.scaleOffsetY,o=r.getSize(),u={x:Math.round(e.x*c+s+o.width/2),y:Math.round(e.y*l+h+o.height/2)},f=n.style;f.left=u.x+"px";f.top=u.y+"px";f.display=this.fitsInCanvas(u,r)?"":"none";i.onPlaceLabel(n,t)}});r.Plot.NodeTypes=new t({none:{render:n.empty,contains:n.lambda(!1)},circle:{render:function(n,t){var i=n.pos.getc(!0),r=n.getData("dim");this.nodeHelper.circle.render("fill",i,r,t)},contains:function(n,t){var i=n.pos.getc(!0),r=n.getData("dim");return this.nodeHelper.circle.contains(i,t,r)}},ellipse:{render:function(n,t){var i=n.pos.getc(!0),r=n.getData("width"),u=n.getData("height");this.nodeHelper.ellipse.render("fill",i,r,u,t)},contains:function(n,t){var i=n.pos.getc(!0),r=n.getData("width"),u=n.getData("height");return this.nodeHelper.ellipse.contains(i,t,r,u)}},square:{render:function(n,t){var i=n.pos.getc(!0),r=n.getData("dim");this.nodeHelper.square.render("fill",i,r,t)},contains:function(n,t){var i=n.pos.getc(!0),r=n.getData("dim");return this.nodeHelper.square.contains(i,t,r)}},rectangle:{render:function(n,t){var i=n.pos.getc(!0),r=n.getData("width"),u=n.getData("height");this.nodeHelper.rectangle.render("fill",i,r,u,t)},contains:function(n,t){var i=n.pos.getc(!0),r=n.getData("width"),u=n.getData("height");return this.nodeHelper.rectangle.contains(i,t,r,u)}},triangle:{render:function(n,t){var i=n.pos.getc(!0),r=n.getData("dim");this.nodeHelper.triangle.render("fill",i,r,t)},contains:function(n,t){var i=n.pos.getc(!0),r=n.getData("dim");return this.nodeHelper.triangle.contains(i,t,r)}},star:{render:function(n,t){var i=n.pos.getc(!0),r=n.getData("dim");this.nodeHelper.star.render("fill",i,r,t)},contains:function(n,t){var i=n.pos.getc(!0),r=n.getData("dim");return this.nodeHelper.star.contains(i,t,r)}}});r.Plot.EdgeTypes=new t({none:n.empty,line:{render:function(n,t){var i=n.nodeFrom.pos.getc(!0),r=n.nodeTo.pos.getc(!0);this.edgeHelper.line.render(i,r,t)},contains:function(n,t){var i=n.nodeFrom.pos.getc(!0),r=n.nodeTo.pos.getc(!0);return this.edgeHelper.line.contains(i,r,t,this.edge.epsilon)}},arrow:{render:function(n,t){var r=n.nodeFrom.pos.getc(!0),u=n.nodeTo.pos.getc(!0),f=n.getData("dim"),i=n.data.$direction,e=i&&i.length>1&&i[0]!=n.nodeFrom.id;this.edgeHelper.arrow.render(r,u,f,e,t)},contains:function(n,t){var i=n.nodeFrom.pos.getc(!0),r=n.nodeTo.pos.getc(!0);return this.edgeHelper.arrow.contains(i,r,t,this.edge.epsilon)}}})}($jit.ForceDirected);$jit.TM={};u=$jit.TM;$jit.TM.$extend=!0;u.Base={layout:{orientation:"h",vertical:function(){return this.orientation=="v"},horizontal:function(){return this.orientation=="h"},change:function(){this.orientation=this.vertical()?"h":"v"}},initialize:function(t){var e;this.controller=this.config=n.merge(r("Canvas","Node","Edge","Fx","Controller","Tips","NodeStyles","Events","Navigation","Label"),{orientation:"h",titleHeight:13,offset:2,levelsToShow:0,constrained:!1,animate:!1,Node:{type:"rectangle",overridable:!0,width:3,height:3,color:"#444"},Label:{textAlign:"center",textBaseline:"top"},Edge:{type:"none"},duration:700,fps:45},t);this.layout.orientation=this.config.orientation;e=this.config;e.useCanvas?(this.canvas=e.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(e.background&&(e.background=n.merge({type:"Circles"},e.background)),this.canvas=new h(this,e),this.config.labelContainer=(typeof e.injectInto=="string"?e.injectInto:e.injectInto.id)+"-label");this.graphOptions={klass:f,Node:{selected:!1,exist:!0,drawn:!0}};this.graph=new i(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new u.Label[e.Label.type](this);this.fx=new u.Plot(this);this.op=new u.Op(this);this.group=new u.Group(this);this.geom=new u.Geom(this);this.clickedNode=null;this.busy=!1;this.initializeExtras()},refresh:function(){var i,t;this.busy||(this.busy=!0,t=this,this.config.animate?(this.compute("end"),this.config.levelsToShow>0&&this.geom.setRightLevelToShow(this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root)),this.fx.animate(n.merge(this.config,{modes:["linear","node-property:width:height"],onComplete:function(){t.busy=!1}}))):(i=this.config.Label.type,i!="Native"&&(t=this,this.graph.eachNode(function(n){t.labels.hideLabel(n,!1)})),this.busy=!1,this.compute(),this.config.levelsToShow>0&&this.geom.setRightLevelToShow(this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root)),this.plot()))},plot:function(){this.fx.plot()},leaf:function(n){return n.getSubnodes([1,1],"ignore").length==0},enter:function(n){if(!this.busy){this.busy=!0;var t=this,i=this.config,f=this.graph,r=n,e=this.clickedNode,u={onComplete:function(){i.levelsToShow>0&&t.geom.setRightLevelToShow(n);(i.levelsToShow>0||i.request)&&t.compute();i.animate?(f.nodeList.setData("alpha",0,"end"),n.eachSubgraph(function(n){n.setData("alpha",1,"end")},"ignore"),t.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){t.clickedNode=r;t.compute("end");t.clickedNode=e;t.fx.animate({modes:["linear","node-property:width:height"],duration:1e3,onComplete:function(){t.busy=!1;t.clickedNode=r}})}})):(t.busy=!1,t.clickedNode=n,t.refresh())}};i.request?this.requestNodes(r,u):u.onComplete()}},out:function(){if(!this.busy){this.busy=!0;this.events.hoveredNode=!1;var n=this,i=this.config,r=this.graph,e=r.getNode(this.clickedNode&&this.clickedNode.id||this.root).getParents(),t=e[0],u=t,f=this.clickedNode;if(!t){this.busy=!1;return}callback={onComplete:function(){n.clickedNode=t;i.request?n.requestNodes(t,{onComplete:function(){n.compute();n.plot();n.busy=!1}}):(n.compute(),n.plot(),n.busy=!1)}};i.levelsToShow>0&&this.geom.setRightLevelToShow(t);i.animate?(this.clickedNode=u,this.compute("end"),this.clickedNode=f,this.fx.animate({modes:["linear","node-property:width:height"],duration:1e3,onComplete:function(){n.clickedNode=u;r.eachNode(function(n){n.setDataset(["current","end"],{alpha:[0,1]})},"ignore");f.eachSubgraph(function(n){n.setData("alpha",1)},"ignore");n.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){callback.onComplete()}})}})):callback.onComplete()}},requestNodes:function(t,i){var r=n.merge(this.controller,i),f=this.config.levelsToShow,u,e;r.request?(u=[],e=t._depth,t.eachLevel(0,f,function(n){var t=f-(n._depth-e);n.drawn&&!n.anySubnode()&&t>0&&(u.push(n),n._level=t)}),this.group.requestNodes(u,r)):r.onComplete()},reposition:function(){this.compute("end")}};u.Op=new t({Implements:i.Op,initialize:function(n){this.viz=n}});u.Geom=new t({Implements:i.Geom,getRightLevelToShow:function(){return this.viz.config.levelsToShow},setRightLevelToShow:function(n){var t=this.getRightLevelToShow(),i=this.viz.labels;n.eachLevel(0,t+1,function(r){var u=r._depth-n._depth;u>t?(r.drawn=!1,r.exist=!1,r.ignore=!0,i.hideLabel(r,!1)):(r.drawn=!0,r.exist=!0,delete r.ignore)});n.drawn=!0;delete n.ignore}});u.Group=new t({initialize:function(n){this.viz=n;this.canvas=n.canvas;this.config=n.config},requestNodes:function(n,t){var e=0,r=n.length,o={},f=function(){t.onComplete()},u=this.viz,i;for(r==0&&f(),i=0;i<r;i++)o[n[i].id]=n[i],t.request(n[i].id,n[i]._level,{onComplete:function(n,t){t&&t.children&&(t.id=n,u.op.sum(t,{type:"nothing"}));++e==r&&(u.graph.computeLevels(u.root,0),f())}})}});u.Plot=new t({Implements:i.Plot,initialize:function(n){this.viz=n;this.config=n.config;this.node=this.config.Node;this.edge=this.config.Edge;this.animation=new v;this.nodeTypes=new u.Plot.NodeTypes;this.edgeTypes=new u.Plot.EdgeTypes;this.labels=n.labels},plot:function(t,i){var r=this.viz,u=r.graph;r.canvas.clear();this.plotTree(u.getNode(r.clickedNode&&r.clickedNode.id||r.root),n.merge(r.config,t||{},{withLabels:!0,hideLabels:!1,plotSubtree:function(n){return n.anySubnode("exist")}}),i)}});u.Label={};u.Label.Native=new t({Implements:i.Label.Native,initialize:function(n){this.config=n.config;this.leaf=n.leaf},renderLabel:function(n,t){if(this.leaf(t)||this.config.titleHeight){var i=t.pos.getc(!0),u=n.getCtx(),r=t.getData("width"),o=t.getData("height"),f=i.x+r/2,e=i.y;u.fillText(t.name,f,e,r)}}});u.Label.SVG=new t({Implements:i.Label.SVG,initialize:function(n){this.viz=n;this.leaf=n.leaf;this.config=n.config},placeLabel:function(n,t,i){var u=t.pos.getc(!0),r=this.viz.canvas,o=r.translateOffsetX,s=r.translateOffsetY,h=r.scaleOffsetX,c=r.scaleOffsetY,f=r.getSize(),e={x:Math.round(u.x*h+o+f.width/2),y:Math.round(u.y*c+s+f.height/2)};n.setAttribute("x",e.x);n.setAttribute("y",e.y);this.leaf(t)||this.config.titleHeight||(n.style.display="none");i.onPlaceLabel(n,t)}});u.Label.HTML=new t({Implements:i.Label.HTML,initialize:function(n){this.viz=n;this.leaf=n.leaf;this.config=n.config},placeLabel:function(n,t,i){var f=t.pos.getc(!0),u=this.viz.canvas,c=u.translateOffsetX,l=u.translateOffsetY,e=u.scaleOffsetX,o=u.scaleOffsetY,s=u.getSize(),h={x:Math.round(f.x*e+c+s.width/2),y:Math.round(f.y*o+l+s.height/2)},r=n.style;r.left=h.x+"px";r.top=h.y+"px";r.width=t.getData("width")*e+"px";r.height=t.getData("height")*o+"px";r.zIndex=t._depth*100;r.display="";this.leaf(t)||this.config.titleHeight||(n.style.display="none");i.onPlaceLabel(n,t)}});u.Plot.NodeTypes=new t({none:{render:n.empty},rectangle:{render:function(t,i){var p=this.viz.leaf(t),l=this.config,r=l.offset,v=l.titleHeight,o=t.pos.getc(!0),f=t.getData("width"),e=t.getData("height"),s=t.getData("border"),u=i.getCtx(),h=o.x+r/2,c=o.y+r/2;if(!(f<=r)&&!(e<=r))if(p){if(l.cushion){var a=u.createRadialGradient(h+(f-r)/2,c+(e-r)/2,1,h+(f-r)/2,c+(e-r)/2,f<e?e:f),y=t.getData("color"),w=n.rgbToHex(n.map(n.hexToRgb(y),function(n){return n*.2>>0}));a.addColorStop(0,y);a.addColorStop(1,w);u.fillStyle=a}u.fillRect(h,c,f-r,e-r);s&&(u.save(),u.strokeStyle=s,u.strokeRect(h,c,f-r,e-r),u.restore())}else v>0&&(u.fillRect(o.x+r/2,o.y+r/2,f-r,v-r),s&&(u.save(),u.strokeStyle=s,u.strokeRect(o.x+r/2,o.y+r/2,f-r,e-r),u.restore()))},contains:function(n,t){if(this.viz.clickedNode&&!n.isDescendantOf(this.viz.clickedNode.id)||n.ignore)return!1;var i=n.pos.getc(!0),r=n.getData("width"),f=this.viz.leaf(n),u=f?n.getData("height"):this.config.titleHeight;return this.nodeHelper.rectangle.contains({x:i.x+r/2,y:i.y+u/2},t,r,u)}}});u.Plot.EdgeTypes=new t({none:n.empty});u.SliceAndDice=new t({Implements:[c,s,u.Base,e.TM.SliceAndDice]});u.Squarified=new t({Implements:[c,s,u.Base,e.TM.Squarified]});u.Strip=new t({Implements:[c,s,u.Base,e.TM.Strip]});$jit.RGraph=new t({Implements:[c,s,e.Radial],initialize:function(t){var f=$jit.RGraph,u;this.controller=this.config=n.merge(r("Canvas","Node","Edge","Fx","Controller","Tips","NodeStyles","Events","Navigation","Label"),{interpolation:"linear",levelDistance:100},t);u=this.config;u.useCanvas?(this.canvas=u.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(u.background&&(u.background=n.merge({type:"Circles"},u.background)),this.canvas=new h(this,u),this.config.labelContainer=(typeof u.injectInto=="string"?u.injectInto:u.injectInto.id)+"-label");this.graphOptions={klass:o,Node:{selected:!1,exist:!0,drawn:!0}};this.graph=new i(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new f.Label[u.Label.type](this);this.fx=new f.Plot(this,f);this.op=new f.Op(this);this.json=null;this.root=null;this.busy=!1;this.parent=!1;this.initializeExtras()},createLevelDistanceFunc:function(){var n=this.config.levelDistance;return function(t){return(t._depth+1)*n}},refresh:function(){this.compute();this.plot()},reposition:function(){this.compute("end")},plot:function(){this.fx.plot()},getNodeAndParentAngle:function(n){var t=!1,r=this.graph.getNode(n),u=r.getParents(),i=u.length>0?u[0]:!1;if(i){var e=i.pos.getc(),o=r.pos.getc(),f=e.add(o.scale(-1));t=Math.atan2(f.y,f.x);t<0&&(t+=2*Math.PI)}return{parent:i,theta:t}},tagChildren:function(n,t){var i,f,r,u,e;if(n.angleSpan){for(i=[],n.eachAdjacency(function(n){i.push(n.nodeTo)},"ignore"),f=i.length,r=0;r<f&&t!=i[r].id;r++);for(u=(r+1)%f,e=0;t!=i[u].id;u=(u+1)%f)i[u].dist=e++}},onClick:function(t,i){var u,r,f,e;if(this.root!=t&&!this.busy){this.busy=!0;this.root=t;u=this;this.controller.onBeforeCompute(this.graph.getNode(t));r=this.getNodeAndParentAngle(t);this.tagChildren(r.parent,t);this.parent=r.parent;this.compute("end");f=r.theta-r.parent.endPos.theta;this.graph.eachNode(function(n){n.endPos.set(n.endPos.getp().add(y(f,0)))});e=this.config.interpolation;i=n.merge({onComplete:n.empty},i||{});this.fx.animate(n.merge({hideLabels:!0,modes:[e]},i,{onComplete:function(){u.busy=!1;i.onComplete()}}))}}});$jit.RGraph.$extend=!0,function(r){r.Op=new t({Implements:i.Op});r.Plot=new t({Implements:i.Plot});r.Label={};r.Label.Native=new t({Implements:i.Label.Native});r.Label.SVG=new t({Implements:i.Label.SVG,initialize:function(n){this.viz=n},placeLabel:function(n,t,i){var u=t.pos.getc(!0),r=this.viz.canvas,o=r.translateOffsetX,s=r.translateOffsetY,h=r.scaleOffsetX,c=r.scaleOffsetY,f=r.getSize(),e={x:Math.round(u.x*h+o+f.width/2),y:Math.round(u.y*c+s+f.height/2)};n.setAttribute("x",e.x);n.setAttribute("y",e.y);i.onPlaceLabel(n,t)}});r.Label.HTML=new t({Implements:i.Label.HTML,initialize:function(n){this.viz=n},placeLabel:function(n,t,i){var e=t.pos.getc(!0),r=this.viz.canvas,s=r.translateOffsetX,h=r.translateOffsetY,c=r.scaleOffsetX,l=r.scaleOffsetY,o=r.getSize(),u={x:Math.round(e.x*c+s+o.width/2),y:Math.round(e.y*l+h+o.height/2)},f=n.style;f.left=u.x+"px";f.top=u.y+"px";f.display=this.fitsInCanvas(u,r)?"":"none";i.onPlaceLabel(n,t)}});r.Plot.NodeTypes=new t({none:{render:n.empty,contains:n.lambda(!1)},circle:{render:function(n,t){var i=n.pos.getc(!0),r=n.getData("dim");this.nodeHelper.circle.render("fill",i,r,t)},contains:function(n,t){var i=n.pos.getc(!0),r=n.getData("dim");return this.nodeHelper.circle.contains(i,t,r)}},ellipse:{render:function(n,t){var i=n.pos.getc(!0),r=n.getData("width"),u=n.getData("height");this.nodeHelper.ellipse.render("fill",i,r,u,t)},contains:function(n,t){var i=n.pos.getc(!0),r=n.getData("width"),u=n.getData("height");return this.nodeHelper.ellipse.contains(i,t,r,u)}},square:{render:function(n,t){var i=n.pos.getc(!0),r=n.getData("dim");this.nodeHelper.square.render("fill",i,r,t)},contains:function(n,t){var i=n.pos.getc(!0),r=n.getData("dim");return this.nodeHelper.square.contains(i,t,r)}},rectangle:{render:function(n,t){var i=n.pos.getc(!0),r=n.getData("width"),u=n.getData("height");this.nodeHelper.rectangle.render("fill",i,r,u,t)},contains:function(n,t){var i=n.pos.getc(!0),r=n.getData("width"),u=n.getData("height");return this.nodeHelper.rectangle.contains(i,t,r,u)}},triangle:{render:function(n,t){var i=n.pos.getc(!0),r=n.getData("dim");this.nodeHelper.triangle.render("fill",i,r,t)},contains:function(n,t){var i=n.pos.getc(!0),r=n.getData("dim");return this.nodeHelper.triangle.contains(i,t,r)}},star:{render:function(n,t){var i=n.pos.getc(!0),r=n.getData("dim");this.nodeHelper.star.render("fill",i,r,t)},contains:function(n,t){var i=n.pos.getc(!0),r=n.getData("dim");return this.nodeHelper.star.contains(i,t,r)}}});r.Plot.EdgeTypes=new t({none:n.empty,line:{render:function(n,t){var i=n.nodeFrom.pos.getc(!0),r=n.nodeTo.pos.getc(!0);this.edgeHelper.line.render(i,r,t)},contains:function(n,t){var i=n.nodeFrom.pos.getc(!0),r=n.nodeTo.pos.getc(!0);return this.edgeHelper.line.contains(i,r,t,this.edge.epsilon)}},arrow:{render:function(n,t){var r=n.nodeFrom.pos.getc(!0),u=n.nodeTo.pos.getc(!0),f=n.getData("dim"),i=n.data.$direction,e=i&&i.length>1&&i[0]!=n.nodeFrom.id;this.edgeHelper.arrow.render(r,u,f,e,t)},contains:function(n,t){var i=n.nodeFrom.pos.getc(!0),r=n.nodeTo.pos.getc(!0);return this.edgeHelper.arrow.contains(i,r,t,this.edge.epsilon)}}})}($jit.RGraph);f.prototype.moebiusTransformation=function(n){var i=this.add(n),t=n.$conjugate().$prod(this);return t.x++,i.$div(t)};i.Util.moebiusTransformation=function(n,t,i,r,u){this.eachNode(n,function(n){for(var f,e,u=0;u<i.length;u++)f=t[u].scale(-1),e=r?r:i[u],n.getPos(i[u]).set(n.getPos(e).getc().moebiusTransformation(f))},u)};$jit.Hypertree=new t({Implements:[c,s,e.Radial],initialize:function(t){var f=$jit.Hypertree,u;this.controller=this.config=n.merge(r("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),{radius:"auto",offset:0,Edge:{type:"hyperline"},duration:1500,fps:35},t);u=this.config;u.useCanvas?(this.canvas=u.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(u.background&&(u.background=n.merge({type:"Circles"},u.background)),this.canvas=new h(this,u),this.config.labelContainer=(typeof u.injectInto=="string"?u.injectInto:u.injectInto.id)+"-label");this.graphOptions={klass:o,Node:{selected:!1,exist:!0,drawn:!0}};this.graph=new i(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new f.Label[u.Label.type](this);this.fx=new f.Plot(this,f);this.op=new f.Op(this);this.json=null;this.root=null;this.busy=!1;this.initializeExtras()},createLevelDistanceFunc:function(){var u=this.getRadius(),t=0,f=Math.max,e=this.config,i,n,r;for(this.graph.eachNode(function(n){t=f(n._depth,t)},"ignore"),t++,i=function(n){return function(t){t.scale=u;for(var i=t._depth+1,r=0,f=Math.pow;i;)r+=f(n,i--);return r-e.offset}},n=.51;n<=1;n+=.01)if(r=(1-Math.pow(n,t))/(1-n),r>=2)return i(n-.01);return i(.75)},getRadius:function(){var t=this.config.radius,n;return t!=="auto"?t:(n=this.canvas.getSize(),Math.min(n.width,n.height)/2)},refresh:function(n){n?(this.reposition(),this.graph.eachNode(function(n){n.startPos.rho=n.pos.rho=n.endPos.rho;n.startPos.theta=n.pos.theta=n.endPos.theta})):this.compute();this.plot()},reposition:function(){this.compute("end");var n=this.graph.getNode(this.root).pos.getc().scale(-1);i.Util.moebiusTransformation(this.graph,[n],["end"],"end","ignore");this.graph.eachNode(function(n){n.ignore&&(n.endPos.rho=n.pos.rho,n.endPos.theta=n.pos.theta)})},plot:function(){this.fx.plot()},onClick:function(n,t){var i=this.graph.getNode(n).pos.getc(!0);this.move(i,t)},move:function(t,i){var r=a(t.x,t.y),u,f;if(this.busy===!1&&r.norm()<1){this.busy=!0;u=this.graph.getClosestNodeToPos(r);f=this;this.graph.computeLevels(u.id,0);this.controller.onBeforeCompute(u);i=n.merge({onComplete:n.empty},i||{});this.fx.animate(n.merge({modes:["moebius"],hideLabels:!0},i,{onComplete:function(){f.busy=!1;i.onComplete()}}),r)}}});$jit.Hypertree.$extend=!0,function(r){r.Op=new t({Implements:i.Op});r.Plot=new t({Implements:i.Plot});r.Label={};r.Label.Native=new t({Implements:i.Label.Native,initialize:function(n){this.viz=n},renderLabel:function(n,t){var u=n.getCtx(),i=t.pos.getc(!0),r=this.viz.getRadius();u.fillText(t.name,i.x*r,i.y*r)}});r.Label.SVG=new t({Implements:i.Label.SVG,initialize:function(n){this.viz=n},placeLabel:function(n,t,i){var u=t.pos.getc(!0),r=this.viz.canvas,s=r.translateOffsetX,h=r.translateOffsetY,c=r.scaleOffsetX,l=r.scaleOffsetY,f=r.getSize(),e=this.viz.getRadius(),o={x:Math.round(u.x*c*e+s+f.width/2),y:Math.round(u.y*l*e+h+f.height/2)};n.setAttribute("x",o.x);n.setAttribute("y",o.y);i.onPlaceLabel(n,t)}});r.Label.HTML=new t({Implements:i.Label.HTML,initialize:function(n){this.viz=n},placeLabel:function(n,t,i){var e=t.pos.getc(!0),r=this.viz.canvas,h=r.translateOffsetX,c=r.translateOffsetY,l=r.scaleOffsetX,a=r.scaleOffsetY,o=r.getSize(),s=this.viz.getRadius(),u={x:Math.round(e.x*l*s+h+o.width/2),y:Math.round(e.y*a*s+c+o.height/2)},f=n.style;f.left=u.x+"px";f.top=u.y+"px";f.display=this.fitsInCanvas(u,r)?"":"none";i.onPlaceLabel(n,t)}});r.Plot.NodeTypes=new t({none:{render:n.empty,contains:n.lambda(!1)},circle:{render:function(n,t){var u=this.node,i=n.getData("dim"),r=n.pos.getc();i=u.transform?i*(1-r.squaredNorm()):i;r.$scale(n.scale);i>.2&&this.nodeHelper.circle.render("fill",r,i,t)},contains:function(n,t){var i=n.getData("dim"),r=n.pos.getc().$scale(n.scale);return this.nodeHelper.circle.contains(r,t,i)}},ellipse:{render:function(n,t){var i=n.pos.getc().$scale(n.scale),r=n.getData("width"),u=n.getData("height");this.nodeHelper.ellipse.render("fill",i,r,u,t)},contains:function(n,t){var i=n.getData("width"),r=n.getData("height"),u=n.pos.getc().$scale(n.scale);return this.nodeHelper.circle.contains(u,t,i,r)}},square:{render:function(n,t){var u=this.node,i=n.getData("dim"),r=n.pos.getc();i=u.transform?i*(1-r.squaredNorm()):i;r.$scale(n.scale);i>.2&&this.nodeHelper.square.render("fill",r,i,t)},contains:function(n,t){var i=n.getData("dim"),r=n.pos.getc().$scale(n.scale);return this.nodeHelper.square.contains(r,t,i)}},rectangle:{render:function(n,t){var f=this.node,i=n.getData("width"),r=n.getData("height"),u=n.pos.getc();i=f.transform?i*(1-u.squaredNorm()):i;r=f.transform?r*(1-u.squaredNorm()):r;u.$scale(n.scale);i>.2&&r>.2&&this.nodeHelper.rectangle.render("fill",u,i,r,t)},contains:function(n,t){var i=n.getData("width"),r=n.getData("height"),u=n.pos.getc().$scale(n.scale);return this.nodeHelper.rectangle.contains(u,t,i,r)}},triangle:{render:function(n,t){var u=this.node,i=n.getData("dim"),r=n.pos.getc();i=u.transform?i*(1-r.squaredNorm()):i;r.$scale(n.scale);i>.2&&this.nodeHelper.triangle.render("fill",r,i,t)},contains:function(n,t){var i=n.getData("dim"),r=n.pos.getc().$scale(n.scale);return this.nodeHelper.triangle.contains(r,t,i)}},star:{render:function(n,t){var u=this.node,i=n.getData("dim"),r=n.pos.getc();i=u.transform?i*(1-r.squaredNorm()):i;r.$scale(n.scale);i>.2&&this.nodeHelper.star.render("fill",r,i,t)},contains:function(n,t){var i=n.getData("dim"),r=n.pos.getc().$scale(n.scale);return this.nodeHelper.star.contains(r,t,i)}}});r.Plot.EdgeTypes=new t({none:n.empty,line:{render:function(n,t){var r=n.nodeFrom.pos.getc(!0),u=n.nodeTo.pos.getc(!0),i=n.nodeFrom.scale;this.edgeHelper.line.render({x:r.x*i,y:r.y*i},{x:u.x*i,y:u.y*i},t)},contains:function(n,t){var r=n.nodeFrom.pos.getc(!0),u=n.nodeTo.pos.getc(!0),i=n.nodeFrom.scale;this.edgeHelper.line.contains({x:r.x*i,y:r.y*i},{x:u.x*i,y:u.y*i},t,this.edge.epsilon)}},arrow:{render:function(n,t){var u=n.nodeFrom.pos.getc(!0),f=n.nodeTo.pos.getc(!0),i=n.nodeFrom.scale,e=n.getData("dim"),r=n.data.$direction,o=r&&r.length>1&&r[0]!=n.nodeFrom.id;this.edgeHelper.arrow.render({x:u.x*i,y:u.y*i},{x:f.x*i,y:f.y*i},e,o,t)},contains:function(n,t){var r=n.nodeFrom.pos.getc(!0),u=n.nodeTo.pos.getc(!0),i=n.nodeFrom.scale;this.edgeHelper.arrow.contains({x:r.x*i,y:r.y*i},{x:u.x*i,y:u.y*i},t,this.edge.epsilon)}},hyperline:{render:function(n,t){var i=n.nodeFrom.pos.getc(),r=n.nodeTo.pos.getc(),u=this.viz.getRadius();this.edgeHelper.hyperline.render(i,r,u,t)},contains:n.lambda(!1)}})}($jit.Hypertree)})();
/*
//# sourceMappingURL=jit.min.js.map
*/